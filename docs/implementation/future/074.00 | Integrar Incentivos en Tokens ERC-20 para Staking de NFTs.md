# ✅ Paso 74: Integrar Incentivos en Tokens ERC-20 para Staking de NFTs

Ahora agregaremos incentivos en tokens ERC-20, permitiendo que los usuarios ganen recompensas en tokens por mantener sus NFTs en staking. Cuanto más tiempo esté un NFT en staking, mayor será la cantidad de tokens ERC-20 que gana el usuario.
✅ Recompensas en Tokens ERC-20 → Los usuarios ganan tokens por mantener NFTs en staking.
✅ Sistema de Yield Farming → Más tiempo en staking = más recompensas.
✅ Web3.js + Stimulus.js → Para interactuar con el sistema de recompensas en la UI.
✅ Smart Contract en Solidity → Para calcular y distribuir recompensas.
📌 Commit 74.1: Crear Token ERC-20 para Recompensas
🔹 Mensaje de commit:
feat(nft-staking-rewards): agrega smart contract para token de recompensas ERC-20
🔹 Contenido del commit:
Definir RewardToken.sol en contracts/RewardToken.sol
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;
import "@openzeppelin/contracts/token/ERC20/ERC20.sol";
import "@openzeppelin/contracts/access/Ownable.sol";
contract RewardToken is ERC20, Ownable {
    constructor() ERC20("Governance Reward", "GOVR") {
        _mint(msg.sender, 1_000_000 * 10 ** decimals());
    }
    function mint(address recipient, uint256 amount) external onlyOwner {
        _mint(recipient, amount);
    }
}
Compilar y Desplegar Contrato
npx hardhat compile
npx hardhat run scripts/deploy.js --network goerli
✅ Guardar la dirección del contrato para el backend.
🔹 Añadir archivos al commit:
git add .
git commit -m "feat(nft-staking-rewards): agrega smart contract para token de recompensas ERC-20"
📌 Commit 74.2: Modificar Smart Contract de Staking para Recompensas
🔹 Mensaje de commit:
feat(nft-staking-rewards): integra recompensas en tokens ERC-20 en el staking de NFTs
🔹 Contenido del commit:
Modificar NFTStaking.sol para Recompensas
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;
import "@openzeppelin/contracts/token/ERC721/IERC721.sol";
import "@openzeppelin/contracts/token/ERC20/IERC20.sol";
import "@openzeppelin/contracts/access/Ownable.sol";
contract NFTStaking is Ownable {
    IERC721 public nftContract;
    IERC20 public rewardToken;
    mapping(uint256 => address) public stakedNFTs;
    mapping(uint256 => uint256) public stakingTime;
    uint256 public rewardRate = 10 * 10 ** 18; // 10 GOVR tokens por mes de staking
    event NFTStaked(address indexed user, uint256 tokenId, uint256 timestamp);
    event NFTUnstaked(address indexed user, uint256 tokenId, uint256 rewardAmount);
    constructor(IERC721 _nftContract, IERC20 _rewardToken) {
        nftContract = _nftContract;
        rewardToken = _rewardToken;
    }
    function stakeNFT(uint256 tokenId) external {
        require(nftContract.ownerOf(tokenId) == msg.sender, "No eres dueño del NFT");
        nftContract.transferFrom(msg.sender, address(this), tokenId);
        stakedNFTs[tokenId] = msg.sender;
        stakingTime[tokenId] = block.timestamp;
        emit NFTStaked(msg.sender, tokenId, block.timestamp);
    }
    function unstakeNFT(uint256 tokenId) external {
        require(stakedNFTs[tokenId] == msg.sender, "No eres dueño del NFT staked");
        uint256 stakingDuration = (block.timestamp - stakingTime[tokenId]) / 30 days;
        uint256 rewardAmount = stakingDuration * rewardRate;
        nftContract.transferFrom(address(this), msg.sender, tokenId);
        delete stakedNFTs[tokenId];
        delete stakingTime[tokenId];
        if (rewardAmount > 0) {
            rewardToken.mint(msg.sender, rewardAmount);
        }
        emit NFTUnstaked(msg.sender, tokenId, rewardAmount);
    }
}
🔹 Añadir archivos al commit:
git add .
git commit -m "feat(nft-staking-rewards): integra recompensas en tokens ERC-20 en el staking de NFTs"
📌 Commit 74.3: Integrar Reclamo de Recompensas en la UI con Web3.js
🔹 Mensaje de commit:
feat(nft-staking-rewards): agrega UI para reclamar recompensas de staking de NFTs
🔹 Contenido del commit:
Modificar app/javascript/controllers/reward_claim_controller.js
import { Controller } from "@hotwired/stimulus";
import Web3 from "web3";
export default class extends Controller {
  static targets = ["tokenId"];
  async unstakeNFT() {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    const web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    const tokenId = this.tokenIdTarget.value;
    const contract = new web3.eth.Contract(
      [
        { name: "unstakeNFT", type: "function", inputs: [{ name: "tokenId", type: "uint256" }] }
      ],
      "0xYourNFTStakingContractAddress"
    );
    await contract.methods.unstakeNFT(tokenId).send({ from: window.ethereum.selectedAddress });
    alert("NFT retirado del staking y recompensas reclamadas");
  }
}
Modificar app/views/reward_claim/index.html.erb
<h2>Reclamar Recompensas de Staking</h2>
<label>ID del NFT:</label>
<input type="text" data-reward-claim-target="tokenId">
<button data-controller="reward-claim" data-action="click->reward-claim#unstakeNFT">
  Reclamar Recompensas
</button>
🔹 Añadir archivos al commit:
git add .
git commit -m "feat(nft-staking-rewards): agrega UI para reclamar recompensas de staking de NFTs"
📝 Explicación y Código Generado
Ejemplo de Reclamar Recompensas en API
curl -X POST "http://localhost:3000/reward_claim/unstake" \
  -H "Content-Type: application/json" \
  -d '{ "tokenId": 1 }'
✅ El NFT es retirado del staking y el usuario recibe sus tokens ERC-20 de recompensa.
Ejemplo de Consulta de Balance de Tokens de Recompensa
https://goerli.etherscan.io/token/0xYourRewardTokenAddress?a=0xUserWallet
✅ Los usuarios pueden ver su balance de tokens de recompensa en Etherscan.
Ejemplo de Recompensa Acumulada en la Blockchain
    Si un usuario deja su NFT en staking por 6 meses, recibirá:
        6 * 10 GOVR = 60 GOVR tokens
    Si retira su NFT antes de 1 mes, no recibe recompensas.
