# ‚úÖ Paso 67: Integrar Panel de Administraci√≥n para DAOs con Aragon Client

Ahora agregaremos un panel de administraci√≥n con Aragon Client, permitiendo que los miembros de la DAO gestionen pagos, contratos y permisos directamente desde una UI descentralizada.
‚úÖ Aragon Client ‚Üí Interfaz para gestionar contratos de la DAO.
‚úÖ Aragon Permissions (ACL) ‚Üí Control granular sobre roles en la DAO.
‚úÖ Aragon Voting App ‚Üí Permitir votaciones para aprobar pagos.
‚úÖ Web3.js + Stimulus.js ‚Üí Para interacci√≥n con contratos en frontend.
‚úÖ Smart Contract en Solidity ‚Üí Para manejar la l√≥gica de gobernanza.
üìå Commit 67.1: Crear Smart Contract de Gobernanza para Aragon DAO
üîπ Mensaje de commit:
feat(aragon-admin): agrega smart contract de gobernanza para gestionar pagos en DAOs con Aragon
üîπ Contenido del commit:
Definir AragonDAO.sol en contracts/AragonDAO.sol
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;
import "@aragon/os/contracts/apps/AragonApp.sol";
import "@openzeppelin/contracts/token/ERC20/IERC20.sol";
contract AragonDAO is AragonApp {
    IERC20 public token;
    address public treasury;
    bytes32 public constant APPROVE_PAYMENT_ROLE = keccak256("APPROVE_PAYMENT_ROLE");
    struct Proposal {
        address recipient;
        uint256 amount;
        bool approved;
    }
    mapping(uint256 => Proposal) public proposals;
    uint256 public proposalCount;
    event PaymentProposed(uint256 proposalId, address recipient, uint256 amount);
    event PaymentApproved(uint256 proposalId);
    function initialize(IERC20 _token, address _treasury) public onlyInit {
        initialized();
        token = _token;
        treasury = _treasury;
    }
    function proposePayment(address recipient, uint256 amount) external auth(APPROVE_PAYMENT_ROLE) returns (uint256) {
        proposalCount++;
        proposals[proposalCount] = Proposal(recipient, amount, false);
        emit PaymentProposed(proposalCount, recipient, amount);
        return proposalCount;
    }
    function approvePayment(uint256 proposalId) external auth(APPROVE_PAYMENT_ROLE) {
        require(!proposals[proposalId].approved, "Pago ya aprobado");
        proposals[proposalId].approved = true;
        token.transferFrom(treasury, proposals[proposalId].recipient, proposals[proposalId].amount);
        emit PaymentApproved(proposalId);
    }
}
Compilar y Desplegar Contrato
npx hardhat compile
npx hardhat run scripts/deploy.js --network goerli
‚úÖ Guardar la direcci√≥n del contrato para el backend.
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(aragon-admin): agrega smart contract de gobernanza para gestionar pagos en DAOs con Aragon"
üìå Commit 67.2: Integrar Propuesta de Pagos en DAOs con Web3.js
üîπ Mensaje de commit:
feat(aragon-admin): agrega propuesta de pagos en DAOs usando Web3.js
üîπ Contenido del commit:
Modificar app/javascript/controllers/aragon_dao_controller.js
import { Controller } from "@hotwired/stimulus";
import Web3 from "web3";
export default class extends Controller {
  static targets = ["recipient", "amount"];
  async proposePayment() {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    const web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    const recipient = this.recipientTarget.value;
    const amount = this.amountTarget.value;
    const contract = new web3.eth.Contract(
      [
        { name: "proposePayment", type: "function", inputs: [{ name: "recipient", type: "address" }, { name: "amount", type: "uint256" }] }
      ],
      "0xYourAragonDAOContractAddress"
    );
    await contract.methods.proposePayment(recipient, amount).send({ from: window.ethereum.selectedAddress });
    alert("Propuesta de pago enviada a la DAO");
  }
}
Modificar app/views/aragon_dao/index.html.erb
<h2>Proponer Pago en DAO</h2>
<label>Direcci√≥n del Receptor:</label>
<input type="text" data-aragon-dao-target="recipient">
<label>Monto:</label>
<input type="text" data-aragon-dao-target="amount">
<button data-controller="aragon-dao" data-action="click->aragon-dao#proposePayment">
  Proponer Pago en DAO
</button>
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(aragon-admin): agrega propuesta de pagos en DAOs usando Web3.js"
üìå Commit 67.3: Implementar Votaci√≥n en DAOs con Aragon Voting App
üîπ Mensaje de commit:
feat(aragon-admin): integra votaci√≥n de pagos en DAOs con Aragon Voting App
üîπ Contenido del commit:
Modificar app/javascript/controllers/aragon_voting_controller.js
import { Controller } from "@hotwired/stimulus";
import Web3 from "web3";
export default class extends Controller {
  static targets = ["proposalId"];
  async voteOnProposal() {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    const web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    const proposalId = this.proposalIdTarget.value;
    const contract = new web3.eth.Contract(
      [
        { name: "approvePayment", type: "function", inputs: [{ name: "proposalId", type: "uint256" }] }
      ],
      "0xYourAragonDAOContractAddress"
    );
    await contract.methods.approvePayment(proposalId).send({ from: window.ethereum.selectedAddress });
    alert("Pago aprobado por la DAO");
  }
}
Modificar app/views/aragon_dao/vote.html.erb
<h2>Votar en DAO para Aprobar Pago</h2>
<label>ID de Propuesta:</label>
<input type="text" data-aragon-voting-target="proposalId">
<button data-controller="aragon-voting" data-action="click->aragon-voting#voteOnProposal">
  Votar en DAO
</button>
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(aragon-admin): integra votaci√≥n de pagos en DAOs con Aragon Voting App"
üìù Explicaci√≥n y C√≥digo Generado
Ejemplo de Proponer Pago en DAO en API
curl -X POST "http://localhost:3000/aragon_dao/propose" \
  -H "Content-Type: application/json" \
  -d '{ "recipient": "0xUserWallet", "amount": 1000 }'
‚úÖ Respuesta esperada:
{ "message": "Propuesta de pago enviada a la DAO" }
Ejemplo de Votaci√≥n en DAO en API
curl -X POST "http://localhost:3000/aragon_dao/vote" \
  -H "Content-Type: application/json" \
  -d '{ "proposalId": 1 }'
‚úÖ El pago es aprobado y se transfiere el monto al receptor.
Ejemplo de Verificaci√≥n de Votaci√≥n en Aragon Client
https://client.aragon.org/#/yourdao.eth
‚úÖ Los usuarios pueden visualizar y votar en propuestas de pagos.
