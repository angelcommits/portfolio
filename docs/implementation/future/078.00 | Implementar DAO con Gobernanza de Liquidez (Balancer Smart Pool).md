# ‚úÖ Paso 78: Implementar DAO con Gobernanza de Liquidez (Balancer Smart Pool)

Ahora agregaremos gobernanza de liquidez, permitiendo que los proveedores de liquidez en GOVR tengan poder de voto en la DAO mediante Balancer Smart Pools. Esto permitir√° que quienes aporten liquidez tengan mayor influencia en las decisiones de la DAO.
‚úÖ Balancer Smart Pool ‚Üí Pool de liquidez con gobernanza en la DAO.
‚úÖ LP Tokens con Poder de Voto ‚Üí Los LP tokens representan votos en la DAO.
‚úÖ Web3.js + Stimulus.js ‚Üí Para ver y delegar votos seg√∫n liquidez aportada.
‚úÖ Smart Contract en Solidity ‚Üí Para gestionar la gobernanza basada en liquidez.
üìå Commit 78.1: Crear Smart Contract para Gobernanza con Liquidez (Balancer)
üîπ Mensaje de commit:
feat(liquidity-governance): agrega smart contract para gobernanza basada en LP tokens con Balancer
üîπ Contenido del commit:
Definir LiquidityGovernance.sol en contracts/LiquidityGovernance.sol
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;
import "@openzeppelin/contracts/token/ERC20/IERC20.sol";
import "@balancer-labs/v2-pool-utils/contracts/BasePool.sol";
import "@openzeppelin/contracts/access/Ownable.sol";
contract LiquidityGovernance is Ownable {
    IERC20 public lpToken;
    mapping(address => uint256) public votingPower;
    event VotingPowerUpdated(address indexed user, uint256 power);
    constructor(IERC20 _lpToken) {
        lpToken = _lpToken;
    }
    function updateVotingPower(address user) external {
        uint256 lpBalance = lpToken.balanceOf(user);
        votingPower[user] = lpBalance;
        emit VotingPowerUpdated(user, lpBalance);
    }
    function getVotingPower(address user) external view returns (uint256) {
        return votingPower[user];
    }
}
Compilar y Desplegar Contrato
npx hardhat compile
npx hardhat run scripts/deploy.js --network goerli
‚úÖ Guardar la direcci√≥n del contrato para el backend.
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(liquidity-governance): agrega smart contract para gobernanza basada en LP tokens con Balancer"
üìå Commit 78.2: Integrar UI para Consultar Poder de Voto Basado en Liquidez
üîπ Mensaje de commit:
feat(liquidity-governance): integra UI para consultar poder de voto basado en LP tokens
üîπ Contenido del commit:
Modificar app/javascript/controllers/voting_power_controller.js
import { Controller } from "@hotwired/stimulus";
import Web3 from "web3";
export default class extends Controller {
  static targets = ["power"];
  async getVotingPower() {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    const web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    const contract = new web3.eth.Contract(
      [
        { name: "getVotingPower", type: "function", inputs: [{ name: "user", type: "address" }], outputs: [{ type: "uint256" }] }
      ],
      "0xYourLiquidityGovernanceContractAddress"
    );
    const power = await contract.methods.getVotingPower(window.ethereum.selectedAddress).call();
    this.powerTarget.innerText = `Poder de voto basado en liquidez: ${power}`;
  }
}
Modificar app/views/liquidity_governance/index.html.erb
<h2>Consultar Poder de Voto Basado en Liquidez</h2>
<p data-voting-power-target="power">Poder de voto: --</p>
<button data-controller="voting-power" data-action="click->voting-power#getVotingPower">
  Verificar Poder de Voto
</button>
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(liquidity-governance): integra UI para consultar poder de voto basado en LP tokens"
üìå Commit 78.3: Implementar Delegaci√≥n de Voto Basado en LP Tokens
üîπ Mensaje de commit:
feat(liquidity-governance): agrega delegaci√≥n de voto en DAO basada en LP tokens
üîπ Contenido del commit:
Modificar LiquidityGovernance.sol para Delegaci√≥n de Voto
mapping(address => address) public voteDelegation;
event VoteDelegated(address from, address to);
function delegateVote(address delegatee) external {
    require(votingPower[msg.sender] > 0, "No tienes poder de voto");
    voteDelegation[msg.sender] = delegatee;
    emit VoteDelegated(msg.sender, delegatee);
}
function getDelegatedVote(address user) external view returns (address) {
    return voteDelegation[user];
}
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(liquidity-governance): agrega delegaci√≥n de voto en DAO basada en LP tokens"
üìå Commit 78.4: Integrar UI para Delegar Voto Basado en Liquidez
üîπ Mensaje de commit:
feat(liquidity-governance): agrega UI para delegar votos basados en LP tokens en DAOs
üîπ Contenido del commit:
Modificar app/javascript/controllers/vote_delegation_controller.js
import { Controller } from "@hotwired/stimulus";
import Web3 from "web3";
export default class extends Controller {
  static targets = ["delegatee"];
  async delegateVote() {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    const web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    const delegatee = this.delegateeTarget.value;
    const contract = new web3.eth.Contract(
      [
        { name: "delegateVote", type: "function", inputs: [{ name: "delegatee", type: "address" }] }
      ],
      "0xYourLiquidityGovernanceContractAddress"
    );
    await contract.methods.delegateVote(delegatee).send({ from: window.ethereum.selectedAddress });
    alert("Voto delegado con √©xito");
  }
}
Modificar app/views/liquidity_governance/delegate.html.erb
<h2>Delegar Voto Basado en Liquidez</h2>
<label>Direcci√≥n del Delegado:</label>
<input type="text" data-vote-delegation-target="delegatee">
<button data-controller="vote-delegation" data-action="click->vote-delegation#delegateVote">
  Delegar Voto
</button>
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(liquidity-governance): agrega UI para delegar votos basados en LP tokens en DAOs"
üìù Explicaci√≥n y C√≥digo Generado
Ejemplo de Consulta de Poder de Voto en API
curl -X GET "http://localhost:3000/liquidity_governance/power?user=0xUserWallet"
‚úÖ Respuesta esperada:
{ "user": "0xUserWallet", "voting_power": 150 }
    El usuario tiene 150 LP tokens, por lo que su poder de voto es 150.
Ejemplo de Delegaci√≥n de Voto en API
curl -X POST "http://localhost:3000/liquidity_governance/delegate" \
  -H "Content-Type: application/json" \
  -d '{ "delegatee": "0xDelegateWallet" }'
‚úÖ El voto del usuario ha sido delegado al representante.
Ejemplo de Verificaci√≥n de Delegaci√≥n en API
curl -X GET "http://localhost:3000/liquidity_governance/get_delegate?user=0xUserWallet"
‚úÖ El usuario ha delegado su voto a otro miembro de la DAO.
