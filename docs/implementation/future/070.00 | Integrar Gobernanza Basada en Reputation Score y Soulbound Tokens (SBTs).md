# ‚úÖ Paso 70: Integrar Gobernanza Basada en Reputation Score y Soulbound Tokens (SBTs)

Ahora implementaremos gobernanza basada en Reputation Score y Soulbound Tokens (SBTs), permitiendo que solo usuarios con cierta reputaci√≥n puedan votar en decisiones importantes.
‚úÖ Soulbound Tokens (SBTs) ‚Üí Tokens intransferibles que representan reputaci√≥n en la DAO.
‚úÖ Reputation Score ‚Üí Los votos valen m√°s seg√∫n el nivel de reputaci√≥n del usuario.
‚úÖ Web3.js + Stimulus.js ‚Üí Interfaz para ver y reclamar reputaci√≥n.
‚úÖ Smart Contract en Solidity ‚Üí Para acu√±ar y gestionar SBTs y reputaci√≥n.
üìå Commit 70.1: Crear Smart Contract para Soulbound Tokens y Reputation Score
üîπ Mensaje de commit:
feat(sbt-governance): agrega smart contract para SBTs y reputaci√≥n en DAO
üîπ Contenido del commit:
Definir ReputationSBT.sol en contracts/ReputationSBT.sol
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;
import "@openzeppelin/contracts/token/ERC721/extensions/ERC721Enumerable.sol";
import "@openzeppelin/contracts/access/Ownable.sol";
contract ReputationSBT is ERC721Enumerable, Ownable {
    mapping(address => uint256) public reputationScore;
    mapping(address => bool) public hasSBT;
    event SBTMinted(address indexed user, uint256 tokenId);
    event ReputationUpdated(address indexed user, uint256 score);
    constructor() ERC721("Reputation SBT", "RSBT") {}
    function mintSBT(address user) external onlyOwner {
        require(!hasSBT[user], "El usuario ya tiene un SBT");
        uint256 tokenId = totalSupply() + 1;
        _mint(user, tokenId);
        hasSBT[user] = true;
        emit SBTMinted(user, tokenId);
    }
    function updateReputation(address user, uint256 score) external onlyOwner {
        require(hasSBT[user], "El usuario no tiene un SBT");
        reputationScore[user] = score;
        emit ReputationUpdated(user, score);
    }
}
Compilar y Desplegar Contrato
npx hardhat compile
npx hardhat run scripts/deploy.js --network goerli
‚úÖ Guardar la direcci√≥n del contrato para el backend.
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(sbt-governance): agrega smart contract para SBTs y reputaci√≥n en DAO"
üìå Commit 70.2: Integrar Reclamo de SBTs en Frontend con Web3.js
üîπ Mensaje de commit:
feat(sbt-governance): integra reclamo de Soulbound Tokens en DAOs usando Web3.js
üîπ Contenido del commit:
Modificar app/javascript/controllers/sbt_controller.js
import { Controller } from "@hotwired/stimulus";
import Web3 from "web3";
export default class extends Controller {
  async claimSBT() {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    const web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    const contract = new web3.eth.Contract(
      [
        { name: "mintSBT", type: "function", inputs: [{ name: "user", type: "address" }] }
      ],
      "0xYourSBTContractAddress"
    );
    await contract.methods.mintSBT(window.ethereum.selectedAddress).send({ from: window.ethereum.selectedAddress });
    alert("Soulbound Token reclamado con √©xito");
  }
}
Modificar app/views/sbt/index.html.erb
<h2>Reclamar Soulbound Token</h2>
<button data-controller="sbt" data-action="click->sbt#claimSBT">
  Reclamar SBT
</button>
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(sbt-governance): integra reclamo de Soulbound Tokens en DAOs usando Web3.js"
üìå Commit 70.3: Implementar Verificaci√≥n de Reputation Score en Votaciones
üîπ Mensaje de commit:
feat(sbt-governance): agrega verificaci√≥n de Reputation Score en votaciones de DAO
üîπ Contenido del commit:
Modificar AragonVoice.sol para Usar Reputation Score
function vote(uint256 proposalId, bool voteYes) external {
    require(!proposals[proposalId].voted[msg.sender], "Ya votaste");
    require(reputationScore[msg.sender] >= 10, "Reputaci√≥n insuficiente para votar");
    proposals[proposalId].voted[msg.sender] = true;
    if (voteYes) {
        proposals[proposalId].yesVotes += reputationScore[msg.sender];
    } else {
        proposals[proposalId].noVotes += reputationScore[msg.sender];
    }
    emit Voted(proposalId, msg.sender, voteYes);
}
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(sbt-governance): agrega verificaci√≥n de Reputation Score en votaciones de DAO"
üìå Commit 70.4: Integrar UI para Consultar Reputation Score
üîπ Mensaje de commit:
feat(sbt-governance): agrega UI para consultar Reputation Score en DAOs usando Web3.js
üîπ Contenido del commit:
Modificar app/javascript/controllers/reputation_controller.js
import { Controller } from "@hotwired/stimulus";
import Web3 from "web3";
export default class extends Controller {
  static targets = ["score"];
  async getReputation() {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    const web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    const contract = new web3.eth.Contract(
      [
        { name: "reputationScore", type: "function", inputs: [{ name: "user", type: "address" }], outputs: [{ type: "uint256" }] }
      ],
      "0xYourSBTContractAddress"
    );
    const reputation = await contract.methods.reputationScore(window.ethereum.selectedAddress).call();
    this.scoreTarget.innerText = `Tu reputaci√≥n: ${reputation}`;
  }
}
Modificar app/views/reputation/index.html.erb
<h2>Consultar Reputation Score</h2>
<p data-reputation-target="score">Tu reputaci√≥n: --</p>
<button data-controller="reputation" data-action="click->reputation#getReputation">
  Verificar Reputaci√≥n
</button>
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(sbt-governance): agrega UI para consultar Reputation Score en DAOs usando Web3.js"
üìù Explicaci√≥n y C√≥digo Generado
Ejemplo de Reclamar SBT en API
curl -X POST "http://localhost:3000/sbt/claim" \
  -H "Content-Type: application/json" \
  -d '{ "user": "0xUserWallet" }'
‚úÖ Respuesta esperada:
{ "message": "SBT reclamado con √©xito" }
Ejemplo de Consultar Reputation Score en API
curl -X GET "http://localhost:3000/reputation?user=0xUserWallet"
‚úÖ Si el usuario tiene SBT y reputaci√≥n:
{ "user": "0xUserWallet", "reputation": 42 }
‚ùå Si el usuario no tiene reputaci√≥n:
{ "user": "0xUserWallet", "reputation": 0 }
Ejemplo de Participaci√≥n en Gobernanza Basada en Reputaci√≥n
https://voice.aragon.org/#/yourdao.eth
‚úÖ Los usuarios con reputaci√≥n suficiente pueden votar.
