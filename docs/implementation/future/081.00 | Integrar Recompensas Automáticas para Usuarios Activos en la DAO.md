# ‚úÖ Paso 81: Integrar Recompensas Autom√°ticas para Usuarios Activos en la DAO

Ahora agregaremos recompensas autom√°ticas para usuarios activos, incentivando la participaci√≥n en la gobernanza de la DAO.
‚úÖ Recompensas en GOVR ‚Üí Los miembros reciben tokens por participar activamente.
‚úÖ M√©tricas de Participaci√≥n ‚Üí Se calculan interacciones como votaciones, propuestas y delegaciones.
‚úÖ Distribuci√≥n Descentralizada ‚Üí Un smart contract administra y emite recompensas.
‚úÖ Web3.js + Stimulus.js ‚Üí Para que los usuarios puedan ver y reclamar sus recompensas.
üìå Commit 81.1: Crear Smart Contract para Recompensas Autom√°ticas en la DAO
üîπ Mensaje de commit:
feat(dao-rewards): agrega smart contract para recompensas autom√°ticas en la DAO
üîπ Contenido del commit:
Definir DAORewards.sol en contracts/DAORewards.sol
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;
import "@openzeppelin/contracts/token/ERC20/IERC20.sol";
import "@openzeppelin/contracts/access/Ownable.sol";
contract DAORewards is Ownable {
    IERC20 public govrToken;
    mapping(address => uint256) public rewards;
    mapping(address => uint256) public participationScore;
    event RewardDistributed(address indexed user, uint256 amount);
    event ParticipationUpdated(address indexed user, uint256 score);
    constructor(IERC20 _govrToken) {
        govrToken = _govrToken;
    }
    function updateParticipation(address user, uint256 score) external onlyOwner {
        participationScore[user] += score;
        emit ParticipationUpdated(user, participationScore[user]);
    }
    function distributeRewards() external onlyOwner {
        uint256 totalScore = 0;
        address; // Simulaci√≥n de una lista de usuarios
        for (uint256 i = 0; i < users.length; i++) {
            totalScore += participationScore[users[i]];
        }
        require(totalScore > 0, "No hay participaci√≥n");
        for (uint256 i = 0; i < users.length; i++) {
            uint256 rewardAmount = (participationScore[users[i]] * govrToken.balanceOf(address(this))) / totalScore;
            rewards[users[i]] += rewardAmount;
            emit RewardDistributed(users[i], rewardAmount);
        }
    }
    function claimRewards() external {
        uint256 amount = rewards[msg.sender];
        require(amount > 0, "No tienes recompensas disponibles");
        rewards[msg.sender] = 0;
        govrToken.transfer(msg.sender, amount);
    }
}
Compilar y Desplegar Contrato
npx hardhat compile
npx hardhat run scripts/deploy.js --network goerli
‚úÖ Guardar la direcci√≥n del contrato para la UI.
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(dao-rewards): agrega smart contract para recompensas autom√°ticas en la DAO"
üìå Commit 81.2: Integrar UI para Consultar y Reclamar Recompensas
üîπ Mensaje de commit:
feat(dao-rewards): integra UI para ver y reclamar recompensas en la DAO
üîπ Contenido del commit:
Modificar app/javascript/controllers/dao_rewards_controller.js
import { Controller } from "@hotwired/stimulus";
import Web3 from "web3";
export default class extends Controller {
  static targets = ["rewards"];
  async checkRewards() {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    const web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    const contract = new web3.eth.Contract(
      [
        { name: "rewards", type: "function", inputs: [{ name: "user", type: "address" }], outputs: [{ type: "uint256" }] }
      ],
      "0xYourDAORewardsContractAddress"
    );
    const rewards = await contract.methods.rewards(window.ethereum.selectedAddress).call();
    this.rewardsTarget.innerText = `Tus recompensas: ${rewards} GOVR`;
  }
  async claimRewards() {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    const web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    const contract = new web3.eth.Contract(
      [{ name: "claimRewards", type: "function", inputs: [] }],
      "0xYourDAORewardsContractAddress"
    );
    await contract.methods.claimRewards().send({ from: window.ethereum.selectedAddress });
    alert("Recompensas reclamadas con √©xito");
  }
}
Modificar app/views/dao_rewards/index.html.erb
<h2>Ver y Reclamar Recompensas</h2>
<p data-dao-rewards-target="rewards">Tus recompensas: -- GOVR</p>
<button data-controller="dao-rewards" data-action="click->dao-rewards#checkRewards">
  Consultar Recompensas
</button>
<button data-controller="dao-rewards" data-action="click->dao-rewards#claimRewards">
  Reclamar Recompensas
</button>
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(dao-rewards): integra UI para ver y reclamar recompensas en la DAO"
üìù Explicaci√≥n y C√≥digo Generado
Ejemplo de Actualizar Participaci√≥n en API
curl -X POST "http://localhost:3000/dao_rewards/update_participation" \
  -H "Content-Type: application/json" \
  -d '{ "user": "0xUserWallet", "score": 50 }'
‚úÖ El usuario gana 50 puntos de participaci√≥n.
Ejemplo de Distribuir Recompensas en API
curl -X POST "http://localhost:3000/dao_rewards/distribute"
‚úÖ Se reparten recompensas proporcionalmente.
Ejemplo de Consultar Recompensas en API
curl -X GET "http://localhost:3000/dao_rewards/check?user=0xUserWallet"
‚úÖ El usuario ve sus recompensas disponibles.
Ejemplo de Reclamar Recompensas en API
curl -X POST "http://localhost:3000/dao_rewards/claim"
‚úÖ El usuario recibe sus tokens GOVR directamente en su wallet.
