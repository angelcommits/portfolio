# ✅ Paso 107: Integrar Cross-Chain Messaging con LayerZero

Ahora agregaremos LayerZero, permitiendo que la DAO comunique información y transacciones entre múltiples blockchains, como Ethereum, Polygon y Avalanche.
✅ Interoperabilidad Multi-Chain → Permite enviar mensajes y activos entre blockchains.
✅ Ultra-Light Nodes (ULN) → Seguridad sin necesidad de full nodes en cada cadena.
✅ Web3.js + Stimulus.js → Para interactuar con LayerZero desde la UI.
✅ Smart Contracts en Solidity → Para manejar la comunicación entre blockchains.
📌 Commit 107.1: Configurar LayerZero para la DAO
🔹 Mensaje de commit:
feat(layerzero-config): configura LayerZero para comunicación cross-chain en la DAO
🔹 Contenido del commit:
1️⃣ Registrar la DAO en LayerZero
    Definir cadenas compatibles (Ethereum, Polygon, Arbitrum, etc.).
    Obtener IDs de red de LayerZero para cada blockchain.
2️⃣ Añadir Configuración en config/layerzero.yml
layerzero:
  enabled: true
  endpoints:
    ethereum: 101
    polygon: 109
    arbitrum: 110
  default_chain: "ethereum"
🔹 Añadir archivos al commit:
git add .
git commit -m "feat(layerzero-config): configura LayerZero para comunicación cross-chain en la DAO"
📌 Commit 107.2: Implementar Smart Contract de Comunicación Cross-Chain
🔹 Mensaje de commit:
feat(layerzero-smartcontract): agrega smart contract para mensajería cross-chain con LayerZero
🔹 Contenido del commit:
Definir CrossChainMessenger.sol en contracts/CrossChainMessenger.sol
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;
import "@layerzerolabs/solidity-examples/contracts/lzApp/NonblockingLzApp.sol";
contract CrossChainMessenger is NonblockingLzApp {
    event MessageReceived(uint16 srcChainId, string message);
    constructor(address _endpoint) NonblockingLzApp(_endpoint) {}
    function sendMessage(uint16 _dstChainId, string calldata _message) external payable {
        bytes memory payload = abi.encode(_message);
        _lzSend(_dstChainId, payload, payable(msg.sender), address(0x0), bytes(""), msg.value);
    }
    function _nonblockingLzReceive(uint16 _srcChainId, bytes memory _payload) internal override {
        string memory message = abi.decode(_payload, (string));
        emit MessageReceived(_srcChainId, message);
    }
}
🔹 Añadir archivos al commit:
git add .
git commit -m "feat(layerzero-smartcontract): agrega smart contract para mensajería cross-chain con LayerZero"
📌 Commit 107.3: Integrar UI para Enviar y Recibir Mensajes Cross-Chain
🔹 Mensaje de commit:
feat(layerzero-ui): agrega UI para gestionar mensajería cross-chain en la DAO con LayerZero
🔹 Contenido del commit:
Modificar app/javascript/controllers/layerzero_controller.js
import { Controller } from "@hotwired/stimulus";
import Web3 from "web3";
export default class extends Controller {
  static targets = ["destinationChain", "message"];
  async sendMessage() {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    const web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    const destinationChain = parseInt(this.destinationChainTarget.value, 10);
    const message = this.messageTarget.value;
    const contract = new web3.eth.Contract(
      [{ name: "sendMessage", type: "function", inputs: [{ name: "_dstChainId", type: "uint16" }, { name: "_message", type: "string" }] }],
      "0xYourCrossChainMessengerContractAddress"
    );
    await contract.methods.sendMessage(destinationChain, message).send({
      from: window.ethereum.selectedAddress,
      value: Web3.utils.toWei("0.1", "ether"), // Pago por el bridge
    });
    alert("Mensaje enviado cross-chain");
  }
}
Modificar app/views/layerzero/index.html.erb
<h2>Mensajería Cross-Chain con LayerZero</h2>
<label>Seleccionar Red de Destino:</label>
<select data-layerzero-target="destinationChain">
  <option value="101">Ethereum</option>
  <option value="109">Polygon</option>
  <option value="110">Arbitrum</option>
</select>
<label>Mensaje:</label>
<input type="text" data-layerzero-target="message">
<button data-controller="layerzero" data-action="click->layerzero#sendMessage">
  Enviar Mensaje
</button>
🔹 Añadir archivos al commit:
git add .
git commit -m "feat(layerzero-ui): agrega UI para gestionar mensajería cross-chain en la DAO con LayerZero"
📝 Explicación y Código Generado
Ejemplo de Envío de Mensaje Cross-Chain en API
curl -X POST "http://localhost:3000/layerzero/send" \
  -H "Content-Type: application/json" \
  -d '{ "destination_chain": 109, "message": "Hola desde Ethereum!" }'
✅ Envía un mensaje desde Ethereum a Polygon.
Ejemplo de Recepción de Mensajes Cross-Chain en API
curl -X GET "http://localhost:3000/layerzero/messages"
✅ Consulta los mensajes recibidos en la DAO desde otras blockchains.
Ejemplo de Panel de LayerZero en Web
https://layerzero.network/
✅ Los miembros de la DAO pueden ver el estado de las transacciones cross-chain.
