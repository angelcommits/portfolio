# âœ… Paso 107: Integrar Cross-Chain Messaging con LayerZero

Ahora agregaremos LayerZero, permitiendo que la DAO comunique informaciÃ³n y transacciones entre mÃºltiples blockchains, como Ethereum, Polygon y Avalanche.
âœ… Interoperabilidad Multi-Chain â†’ Permite enviar mensajes y activos entre blockchains.
âœ… Ultra-Light Nodes (ULN) â†’ Seguridad sin necesidad de full nodes en cada cadena.
âœ… Web3.js + Stimulus.js â†’ Para interactuar con LayerZero desde la UI.
âœ… Smart Contracts en Solidity â†’ Para manejar la comunicaciÃ³n entre blockchains.
ğŸ“Œ Commit 107.1: Configurar LayerZero para la DAO
ğŸ”¹ Mensaje de commit:
feat(layerzero-config): configura LayerZero para comunicaciÃ³n cross-chain en la DAO
ğŸ”¹ Contenido del commit:
1ï¸âƒ£ Registrar la DAO en LayerZero
    Definir cadenas compatibles (Ethereum, Polygon, Arbitrum, etc.).
    Obtener IDs de red de LayerZero para cada blockchain.
2ï¸âƒ£ AÃ±adir ConfiguraciÃ³n en config/layerzero.yml
layerzero:
  enabled: true
  endpoints:
    ethereum: 101
    polygon: 109
    arbitrum: 110
  default_chain: "ethereum"
ğŸ”¹ AÃ±adir archivos al commit:
git add .
git commit -m "feat(layerzero-config): configura LayerZero para comunicaciÃ³n cross-chain en la DAO"
ğŸ“Œ Commit 107.2: Implementar Smart Contract de ComunicaciÃ³n Cross-Chain
ğŸ”¹ Mensaje de commit:
feat(layerzero-smartcontract): agrega smart contract para mensajerÃ­a cross-chain con LayerZero
ğŸ”¹ Contenido del commit:
Definir CrossChainMessenger.sol en contracts/CrossChainMessenger.sol
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;
import "@layerzerolabs/solidity-examples/contracts/lzApp/NonblockingLzApp.sol";
contract CrossChainMessenger is NonblockingLzApp {
    event MessageReceived(uint16 srcChainId, string message);
    constructor(address _endpoint) NonblockingLzApp(_endpoint) {}
    function sendMessage(uint16 _dstChainId, string calldata _message) external payable {
        bytes memory payload = abi.encode(_message);
        _lzSend(_dstChainId, payload, payable(msg.sender), address(0x0), bytes(""), msg.value);
    }
    function _nonblockingLzReceive(uint16 _srcChainId, bytes memory _payload) internal override {
        string memory message = abi.decode(_payload, (string));
        emit MessageReceived(_srcChainId, message);
    }
}
ğŸ”¹ AÃ±adir archivos al commit:
git add .
git commit -m "feat(layerzero-smartcontract): agrega smart contract para mensajerÃ­a cross-chain con LayerZero"
ğŸ“Œ Commit 107.3: Integrar UI para Enviar y Recibir Mensajes Cross-Chain
ğŸ”¹ Mensaje de commit:
feat(layerzero-ui): agrega UI para gestionar mensajerÃ­a cross-chain en la DAO con LayerZero
ğŸ”¹ Contenido del commit:
Modificar app/javascript/controllers/layerzero_controller.js
import { Controller } from "@hotwired/stimulus";
import Web3 from "web3";
export default class extends Controller {
  static targets = ["destinationChain", "message"];
  async sendMessage() {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    const web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    const destinationChain = parseInt(this.destinationChainTarget.value, 10);
    const message = this.messageTarget.value;
    const contract = new web3.eth.Contract(
      [{ name: "sendMessage", type: "function", inputs: [{ name: "_dstChainId", type: "uint16" }, { name: "_message", type: "string" }] }],
      "0xYourCrossChainMessengerContractAddress"
    );
    await contract.methods.sendMessage(destinationChain, message).send({
      from: window.ethereum.selectedAddress,
      value: Web3.utils.toWei("0.1", "ether"), // Pago por el bridge
    });
    alert("Mensaje enviado cross-chain");
  }
}
Modificar app/views/layerzero/index.html.erb
<h2>MensajerÃ­a Cross-Chain con LayerZero</h2>
<label>Seleccionar Red de Destino:</label>
<select data-layerzero-target="destinationChain">
  <option value="101">Ethereum</option>
  <option value="109">Polygon</option>
  <option value="110">Arbitrum</option>
</select>
<label>Mensaje:</label>
<input type="text" data-layerzero-target="message">
<button data-controller="layerzero" data-action="click->layerzero#sendMessage">
  Enviar Mensaje
</button>
ğŸ”¹ AÃ±adir archivos al commit:
git add .
git commit -m "feat(layerzero-ui): agrega UI para gestionar mensajerÃ­a cross-chain en la DAO con LayerZero"
ğŸ“ ExplicaciÃ³n y CÃ³digo Generado
Ejemplo de EnvÃ­o de Mensaje Cross-Chain en API
curl -X POST "http://localhost:3000/layerzero/send" \
  -H "Content-Type: application/json" \
  -d '{ "destination_chain": 109, "message": "Hola desde Ethereum!" }'
âœ… EnvÃ­a un mensaje desde Ethereum a Polygon.
Ejemplo de RecepciÃ³n de Mensajes Cross-Chain en API
curl -X GET "http://localhost:3000/layerzero/messages"
âœ… Consulta los mensajes recibidos en la DAO desde otras blockchains.
Ejemplo de Panel de LayerZero en Web
https://layerzero.network/
âœ… Los miembros de la DAO pueden ver el estado de las transacciones cross-chain.
