# ‚úÖ Paso 79: Integrar Distribuci√≥n de Recompensas en DAOs Basada en Contribuci√≥n de Liquidez

Ahora agregaremos distribuci√≥n de recompensas en la DAO basada en liquidez, permitiendo que los proveedores de liquidez obtengan ingresos pasivos a partir de las comisiones generadas por el pool.
‚úÖ Recompensas Proporcionales ‚Üí Los ingresos de la DAO se distribuyen seg√∫n la liquidez aportada.
‚úÖ Automatizaci√≥n con Smart Contract ‚Üí Los pagos se realizan de forma descentralizada.
‚úÖ Web3.js + Stimulus.js ‚Üí Para visualizar y reclamar recompensas desde la UI.
‚úÖ Solidity Smart Contract ‚Üí Para calcular y distribuir pagos.
üìå Commit 79.1: Crear Smart Contract para Distribuir Recompensas en Base a Liquidez
üîπ Mensaje de commit:
feat(liquidity-rewards): agrega smart contract para distribuci√≥n de recompensas en DAOs basadas en liquidez
üîπ Contenido del commit:
Definir LiquidityRewards.sol en contracts/LiquidityRewards.sol
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;
import "@openzeppelin/contracts/token/ERC20/IERC20.sol";
import "@openzeppelin/contracts/access/Ownable.sol";
contract LiquidityRewards is Ownable {
    IERC20 public rewardToken;
    IERC20 public lpToken;
    mapping(address => uint256) public rewards;
    uint256 public totalLiquidity;
    event RewardsDistributed(uint256 totalAmount);
    event RewardClaimed(address indexed user, uint256 amount);
    constructor(IERC20 _rewardToken, IERC20 _lpToken) {
        rewardToken = _rewardToken;
        lpToken = _lpToken;
    }
    function distributeRewards(uint256 amount) external onlyOwner {
        require(amount > 0, "Monto debe ser mayor a 0");
        require(rewardToken.balanceOf(address(this)) >= amount, "Fondos insuficientes");
        uint256 totalSupply = lpToken.totalSupply();
        require(totalSupply > 0, "No hay liquidez en el pool");
        for (uint256 i = 0; i < totalSupply; i++) {
            address user = lpToken.ownerOf(i);
            uint256 userBalance = lpToken.balanceOf(user);
            rewards[user] += (amount * userBalance) / totalSupply;
        }
        emit RewardsDistributed(amount);
    }
    function claimRewards() external {
        uint256 amount = rewards[msg.sender];
        require(amount > 0, "No tienes recompensas disponibles");
        rewards[msg.sender] = 0;
        rewardToken.transfer(msg.sender, amount);
        emit RewardClaimed(msg.sender, amount);
    }
    function getUserRewards(address user) external view returns (uint256) {
        return rewards[user];
    }
}
Compilar y Desplegar Contrato
npx hardhat compile
npx hardhat run scripts/deploy.js --network goerli
‚úÖ Guardar la direcci√≥n del contrato para el backend.
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(liquidity-rewards): agrega smart contract para distribuci√≥n de recompensas en DAOs basadas en liquidez"
üìå Commit 79.2: Integrar UI para Ver y Reclamar Recompensas
üîπ Mensaje de commit:
feat(liquidity-rewards): integra UI para ver y reclamar recompensas de liquidez en DAOs
üîπ Contenido del commit:
Modificar app/javascript/controllers/liquidity_rewards_controller.js
import { Controller } from "@hotwired/stimulus";
import Web3 from "web3";
export default class extends Controller {
  static targets = ["rewards"];
  async checkRewards() {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    const web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    const contract = new web3.eth.Contract(
      [
        { name: "getUserRewards", type: "function", inputs: [{ name: "user", type: "address" }], outputs: [{ type: "uint256" }] }
      ],
      "0xYourLiquidityRewardsContractAddress"
    );
    const rewards = await contract.methods.getUserRewards(window.ethereum.selectedAddress).call();
    this.rewardsTarget.innerText = `Tus recompensas: ${rewards} GOVR`;
  }
  async claimRewards() {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    const web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    const contract = new web3.eth.Contract(
      [{ name: "claimRewards", type: "function", inputs: [] }],
      "0xYourLiquidityRewardsContractAddress"
    );
    await contract.methods.claimRewards().send({ from: window.ethereum.selectedAddress });
    alert("Recompensas reclamadas con √©xito");
  }
}
Modificar app/views/liquidity_rewards/index.html.erb
<h2>Ver y Reclamar Recompensas</h2>
<p data-liquidity-rewards-target="rewards">Tus recompensas: -- GOVR</p>
<button data-controller="liquidity-rewards" data-action="click->liquidity-rewards#checkRewards">
  Consultar Recompensas
</button>
<button data-controller="liquidity-rewards" data-action="click->liquidity-rewards#claimRewards">
  Reclamar Recompensas
</button>
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(liquidity-rewards): integra UI para ver y reclamar recompensas de liquidez en DAOs"
üìù Explicaci√≥n y C√≥digo Generado
Ejemplo de Distribuir Recompensas en API
curl -X POST "http://localhost:3000/liquidity_rewards/distribute" \
  -H "Content-Type: application/json" \
  -d '{ "amount": 1000 }'
‚úÖ Se distribuyen 1000 GOVR proporcionalmente entre los proveedores de liquidez.
Ejemplo de Consultar Recompensas en API
curl -X GET "http://localhost:3000/liquidity_rewards/check?user=0xUserWallet"
‚úÖ El usuario recibe su balance de recompensas.
Ejemplo de Reclamar Recompensas en API
curl -X POST "http://localhost:3000/liquidity_rewards/claim"
‚úÖ El usuario recibe sus tokens GOVR directamente en su wallet.
Ejemplo de Consulta de Balance en Etherscan
https://goerli.etherscan.io/token/0xYourGOVRTokenAddress?a=0xUserWallet
‚úÖ El usuario puede ver sus recompensas en su wallet.
