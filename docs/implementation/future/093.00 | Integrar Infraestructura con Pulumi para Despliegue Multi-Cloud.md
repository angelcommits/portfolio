# ✅ Paso 93: Integrar Infraestructura con Pulumi para Despliegue Multi-Cloud

Ahora agregaremos Pulumi con Ruby, permitiendo que la DAO despliegue su infraestructura en AWS, GCP o Azure usando código como infraestructura (IaC).
✅ Infraestructura como Código (IaC) → Automatización del despliegue en múltiples nubes.
✅ Pulumi con Ruby → Escribimos infraestructura en Ruby en lugar de YAML o HCL.
✅ Soporte Multi-Cloud → AWS, GCP, Azure, DigitalOcean, Kubernetes.
✅ Gestión de Recursos → Se definen servidores, bases de datos y almacenamiento con código.
📌 Commit 93.1: Configurar Pulumi con Ruby para Despliegue en AWS
🔹 Mensaje de commit:
feat(pulumi-aws): agrega configuración inicial de Pulumi con Ruby para despliegue en AWS
🔹 Contenido del commit:
Instalar Pulumi y Configurar Proyecto
brew install pulumi
pulumi new aws-ruby --dir pulumi-infra
Modificar pulumi-infra/Pulumi.yaml
name: dao-infra
runtime: ruby
description: "Infraestructura para la DAO en AWS con Pulumi"
config:
  aws:region: us-east-1
Definir pulumi-infra/main.rb para Crear Servidor EC2
require 'pulumi'
require 'pulumi/aws'
Pulumi.export("aws_region", Pulumi.config.require("aws:region"))
sg = Aws::Ec2::SecurityGroup.new("web-sg",
  description: "Habilita tráfico HTTP y SSH",
  ingress: [
    { protocol: "tcp", from_port: 80, to_port: 80, cidr_blocks: ["0.0.0.0/0"] },
    { protocol: "tcp", from_port: 22, to_port: 22, cidr_blocks: ["0.0.0.0/0"] }
  ]
)
instance = Aws::Ec2::Instance.new("dao-instance",
  instance_type: "t2.micro",
  ami: "ami-0c55b159cbfafe1f0", # Amazon Linux 2 AMI
  security_groups: [sg.name]
)
Pulumi.export("instance_ip", instance.public_ip)
🔹 Añadir archivos al commit:
git add .
git commit -m "feat(pulumi-aws): agrega configuración inicial de Pulumi con Ruby para despliegue en AWS"
📌 Commit 93.2: Configurar Pulumi para Kubernetes en GCP
🔹 Mensaje de commit:
feat(pulumi-gcp): agrega configuración para despliegue de Kubernetes en GCP con Pulumi
🔹 Contenido del commit:
Definir pulumi-infra/gcp.rb para Crear Cluster en GKE
require 'pulumi'
require 'pulumi/gcp'
Pulumi.export("gcp_project", Pulumi.config.require("gcp:project"))
cluster = Gcp::Container::Cluster.new("dao-cluster",
  initial_node_count: 3,
  node_config: {
    machine_type: "n1-standard-1",
    disk_size_gb: 20
  }
)
Pulumi.export("cluster_name", cluster.name)
🔹 Añadir archivos al commit:
git add .
git commit -m "feat(pulumi-gcp): agrega configuración para despliegue de Kubernetes en GCP con Pulumi"
📌 Commit 93.3: Desplegar Base de Datos en Azure con Pulumi
🔹 Mensaje de commit:
feat(pulumi-azure): agrega configuración para desplegar base de datos en Azure con Pulumi
🔹 Contenido del commit:
Definir pulumi-infra/azure.rb para Crear PostgreSQL en Azure
require 'pulumi'
require 'pulumi/azure'
Pulumi.export("azure_region", Pulumi.config.require("azure:region"))
db_server = Azure::Postgresql::Server.new("dao-db",
  location: Pulumi.config.require("azure:region"),
  administrator_login: "adminuser",
  administrator_login_password: "SecurePassword123!",
  sku_name: "B_Gen5_2",
  storage_mb: 5120,
  version: "11"
)
Pulumi.export("db_server_name", db_server.name)
🔹 Añadir archivos al commit:
git add .
git commit -m "feat(pulumi-azure): agrega configuración para desplegar base de datos en Azure con Pulumi"
📝 Explicación y Código Generado
Ejemplo de Despliegue en AWS
cd pulumi-infra
pulumi up
✅ Se crea una instancia EC2 y se muestra la IP pública.
Ejemplo de Despliegue en GCP
pulumi stack select gcp
pulumi up
✅ Se crea un clúster Kubernetes en Google Cloud.
Ejemplo de Despliegue en Azure
pulumi stack select azure
pulumi up
✅ Se crea un servidor PostgreSQL en Azure.
Ejemplo de Ver Infraestructura en Pulumi Web
https://app.pulumi.com/
✅ Los administradores pueden ver y gestionar el estado de la infraestructura.
