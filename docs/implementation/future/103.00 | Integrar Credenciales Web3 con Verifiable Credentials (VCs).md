# ✅ Paso 103: Integrar Credenciales Web3 con Verifiable Credentials (VCs)

Ahora agregaremos Verifiable Credentials (VCs), permitiendo que la DAO otorgue certificados digitales verificables a sus miembros para demostrar experiencia, contribuciones y reputación.
✅ Identidad Soberana (DID + VCs) → Los usuarios reciben credenciales verificables sin depender de terceros.
✅ Credenciales Firmadas y Verificables → Basadas en estándares de W3C.
✅ Almacenamiento en IPFS o Ceramic → Las credenciales son accesibles pero seguras.
✅ Web3.js + Stimulus.js → Para solicitar y verificar credenciales en la UI.
📌 Commit 103.1: Configurar Soporte para Verifiable Credentials en la DAO
🔹 Mensaje de commit:
feat(verifiable-credentials): configura soporte para emisión de credenciales verificables en la DAO
🔹 Contenido del commit:
1️⃣ Registrar la DAO como Emisor de VCs en Veramo
    Crear DID (Decentralized Identifier) para la DAO.
    Definir esquemas de credenciales (Ejemplo: "Miembro DAO", "Colaborador", "Experto en Solidity").
2️⃣ Añadir Configuración en config/verifiable_credentials.yml
verifiable_credentials:
  issuer_did: "did:web:dao.example.org"
  credential_types:
    - "DAO Member"
    - "Core Contributor"
    - "Smart Contract Auditor"
  storage: "ceramic" # Alternativamente IPFS o Arweave
🔹 Añadir archivos al commit:
git add .
git commit -m "feat(verifiable-credentials): configura soporte para emisión de credenciales verificables en la DAO"
📌 Commit 103.2: Implementar Emisión y Verificación de Credenciales
🔹 Mensaje de commit:
feat(vc-issuance): agrega emisión y verificación de credenciales verificables en la DAO
🔹 Contenido del commit:
Definir VerifiableCredentialService.rb en app/services/verifiable_credential_service.rb
require "json"
require "didkit"
class VerifiableCredentialService
  ISSUER_DID = ENV["DAO_ISSUER_DID"]
  def self.issue_credential(subject_did, credential_type, claim)
    vc = {
      "@context": ["https://www.w3.org/2018/credentials/v1"],
      "id": "urn:uuid:#{SecureRandom.uuid}",
      "type": ["VerifiableCredential", credential_type],
      "issuer": ISSUER_DID,
      "issuanceDate": Time.now.utc.iso8601,
      "credentialSubject": {
        "id": subject_did,
        "claim": claim
      }
    }
    signed_vc = DIDKit::VC.issue(JSON.generate(vc), ENV["DAO_ISSUER_KEY"])
    signed_vc
  end
  def self.verify_credential(vc)
    DIDKit::VC.verify(vc)
  end
end
🔹 Añadir archivos al commit:
git add .
git commit -m "feat(vc-issuance): agrega emisión y verificación de credenciales verificables en la DAO"
📌 Commit 103.3: Integrar UI para Solicitar y Validar Credenciales
🔹 Mensaje de commit:
feat(vc-ui): agrega UI para solicitar y validar credenciales verificables en la DAO
🔹 Contenido del commit:
Modificar app/javascript/controllers/vc_controller.js
import { Controller } from "@hotwired/stimulus";
export default class extends Controller {
  static targets = ["subjectDid", "credentialType", "claim", "result"];
  async requestCredential() {
    const response = await fetch("/verifiable_credentials/issue", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        subject_did: this.subjectDidTarget.value,
        credential_type: this.credentialTypeTarget.value,
        claim: this.claimTarget.value
      })
    });
    const data = await response.json();
    this.resultTarget.innerText = JSON.stringify(data, null, 2);
  }
  async verifyCredential() {
    const vc = this.resultTarget.innerText;
    const response = await fetch("/verifiable_credentials/verify", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ vc })
    });
    const data = await response.json();
    this.resultTarget.innerText = `Verificación: ${data.valid ? "✅ Válido" : "❌ Inválido"}`;
  }
}
Modificar app/views/verifiable_credentials/index.html.erb
<h2>Solicitar Credencial Verificable</h2>
<label>DID del Solicitante:</label>
<input type="text" data-vc-target="subjectDid">
<label>Tipo de Credencial:</label>
<select data-vc-target="credentialType">
  <option value="DAO Member">Miembro DAO</option>
  <option value="Core Contributor">Contribuyente Core</option>
  <option value="Smart Contract Auditor">Auditor de Smart Contracts</option>
</select>
<label>Reclamo:</label>
<input type="text" data-vc-target="claim">
<button data-controller="vc" data-action="click->vc#requestCredential">
  Emitir Credencial
</button>
<br><br>
<h2>Validar Credencial</h2>
<button data-controller="vc" data-action="click->vc#verifyCredential">
  Verificar Credencial
</button>
<pre data-vc-target="result">Sin credencial generada</pre>
🔹 Añadir archivos al commit:
git add .
git commit -m "feat(vc-ui): agrega UI para solicitar y validar credenciales verificables en la DAO"
📝 Explicación y Código Generado
Ejemplo de Emisión de Credencial en API
curl -X POST "http://localhost:3000/verifiable_credentials/issue" \
  -H "Content-Type: application/json" \
  -d '{ "subject_did": "did:ethr:0xUserWallet", "credential_type": "DAO Member", "claim": "Miembro activo de la DAO" }'
✅ El usuario recibe una credencial verificable de "Miembro DAO".
Ejemplo de Verificación de Credencial en API
curl -X POST "http://localhost:3000/verifiable_credentials/verify" \
  -H "Content-Type: application/json" \
  -d '{ "vc": "json_de_la_credencial" }'
✅ Valida si la credencial fue emitida por la DAO.
Ejemplo de Panel de Identidad Web3 en Veramo
https://veramo.io/
✅ Los miembros de la DAO pueden gestionar y compartir sus credenciales descentralizadas.
