# ‚úÖ Paso 109: Integrar Seguros para la DAO con Nexus Mutual

Ahora agregaremos Nexus Mutual, permitiendo que la DAO proteja sus fondos contra exploits y fallos en smart contracts usando seguros descentralizados.
‚úÖ Cobertura contra Fallos en Smart Contracts ‚Üí Protege la DAO contra exploits y hacks.
‚úÖ Seguros Param√©tricos ‚Üí Paga autom√°ticamente en caso de vulnerabilidad comprobada.
‚úÖ Web3.js + Stimulus.js ‚Üí Para gestionar p√≥lizas de seguro desde la UI.
‚úÖ Smart Contracts en Solidity ‚Üí Para administrar compra de seguros y reclamaciones.
üìå Commit 109.1: Configurar Nexus Mutual para Seguros de la DAO
üîπ Mensaje de commit:
feat(nexus-mutual-config): configura Nexus Mutual para protecci√≥n de fondos en la DAO
üîπ Contenido del commit:
1Ô∏è‚É£ Registrar la DAO en Nexus Mutual
    Seleccionar protocolos y contratos a asegurar.
    Definir las coberturas necesarias (Ejemplo: protecci√≥n contra fallos en Aave y Lido).
2Ô∏è‚É£ A√±adir Configuraci√≥n en config/nexus_mutual.yml
nexus_mutual:
  enabled: true
  cover_policies:
    - protocol: "Aave"
      cover_amount: 10000 # USD
      duration: "90 d√≠as"
    - protocol: "Lido"
      cover_amount: 5000 # USD
      duration: "60 d√≠as"
  dao_wallet: "0xDAO_Treasury"
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(nexus-mutual-config): configura Nexus Mutual para protecci√≥n de fondos en la DAO"
üìå Commit 109.2: Implementar Smart Contract de Compra y Gesti√≥n de Seguros
üîπ Mensaje de commit:
feat(nexus-mutual-contract): agrega smart contract para gestionar seguros con Nexus Mutual en la DAO
üîπ Contenido del commit:
Definir NexusInsurance.sol en contracts/NexusInsurance.sol
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;
import "@openzeppelin/contracts/access/Ownable.sol";
interface INexusMutual {
    function buyCover(
        address coveredContractAddress,
        uint256 coverAmount,
        uint256 coverPeriod
    ) external payable;
}
contract NexusInsurance is Ownable {
    INexusMutual public nexusMutual;
    address public treasury;
    event InsurancePurchased(address indexed contractAddress, uint256 amount, uint256 period);
    constructor(INexusMutual _nexusMutual, address _treasury) {
        nexusMutual = _nexusMutual;
        treasury = _treasury;
    }
    function buyInsurance(address contractToCover, uint256 amount, uint256 period) external onlyOwner {
        require(amount > 0, "El monto de cobertura debe ser mayor a 0");
        nexusMutual.buyCover{value: amount}(contractToCover, amount, period);
        emit InsurancePurchased(contractToCover, amount, period);
    }
}
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(nexus-mutual-contract): agrega smart contract para gestionar seguros con Nexus Mutual en la DAO"
üìå Commit 109.3: Integrar UI para Comprar y Gestionar Seguros
üîπ Mensaje de commit:
feat(nexus-mutual-ui): agrega UI para contratar y gestionar seguros en la DAO con Nexus Mutual
üîπ Contenido del commit:
Modificar app/javascript/controllers/nexus_controller.js
import { Controller } from "@hotwired/stimulus";
import Web3 from "web3";
export default class extends Controller {
  static targets = ["contractAddress", "coverAmount", "duration"];
  async buyInsurance() {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    const web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    const contractAddress = this.contractAddressTarget.value;
    const coverAmount = Web3.utils.toWei(this.coverAmountTarget.value, "ether");
    const duration = parseInt(this.durationTarget.value, 10);
    const contract = new web3.eth.Contract(
      [{ name: "buyInsurance", type: "function", inputs: [{ name: "contractToCover", type: "address" }, { name: "amount", type: "uint256" }, { name: "period", type: "uint256" }] }],
      "0xYourNexusInsuranceContractAddress"
    );
    await contract.methods.buyInsurance(contractAddress, coverAmount, duration).send({
      from: window.ethereum.selectedAddress,
      value: coverAmount,
    });
    alert("Seguro comprado con √©xito");
  }
}
Modificar app/views/nexus/index.html.erb
<h2>Contratar Seguro con Nexus Mutual</h2>
<label>Direcci√≥n del Contrato a Asegurar:</label>
<input type="text" data-nexus-target="contractAddress">
<label>Monto de Cobertura (ETH):</label>
<input type="text" data-nexus-target="coverAmount">
<label>Duraci√≥n (d√≠as):</label>
<input type="text" data-nexus-target="duration">
<button data-controller="nexus" data-action="click->nexus#buyInsurance">
  Comprar Seguro
</button>
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(nexus-mutual-ui): agrega UI para contratar y gestionar seguros en la DAO con Nexus Mutual"
üìù Explicaci√≥n y C√≥digo Generado
Ejemplo de Compra de Seguro en API
curl -X POST "http://localhost:3000/nexus/buy" \
  -H "Content-Type: application/json" \
  -d '{ "contract_address": "0xAaveContract", "cover_amount": 5, "duration": 90 }'
‚úÖ Se compra un seguro de 5 ETH para el contrato de Aave por 90 d√≠as.
Ejemplo de Verificaci√≥n de P√≥liza en API
curl -X GET "http://localhost:3000/nexus/check_policy?contract_address=0xAaveContract"
‚úÖ Consulta si hay un seguro activo para un contrato espec√≠fico.
Ejemplo de Panel de Nexus Mutual en Web
https://nexusmutual.io/
‚úÖ Los miembros de la DAO pueden ver y gestionar sus p√≥lizas de seguro.
