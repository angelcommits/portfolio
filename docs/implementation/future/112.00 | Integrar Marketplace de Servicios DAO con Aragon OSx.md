# ‚úÖ Paso 112: Integrar Marketplace de Servicios DAO con Aragon OSx

Ahora agregaremos Aragon OSx, permitiendo que la DAO cree y gestione marketplaces descentralizados para contratar y pagar servicios dentro de la comunidad.
‚úÖ Contratos Inteligentes para Marketplaces ‚Üí Permite que la DAO administre pagos y contratos de servicio.
‚úÖ DAO Modular con Aragon OSx ‚Üí Facilita la gesti√≥n de permisos y votaciones en la DAO.
‚úÖ Pagos en Criptomonedas ‚Üí Soporte para ETH, USDC y tokens de gobernanza de la DAO.
‚úÖ Web3.js + Stimulus.js ‚Üí Para integrar la UI con la blockchain y Aragon.
‚úÖ Smart Contracts en Solidity ‚Üí Para manejar publicaciones de servicios, pagos y disputas.
üìå Commit 112.1: Configurar Aragon OSx para el Marketplace DAO
üîπ Mensaje de commit:
feat(aragon-marketplace-config): configura Aragon OSx para la gesti√≥n de un marketplace descentralizado en la DAO
üîπ Contenido del commit:
1Ô∏è‚É£ Registrar la DAO en Aragon OSx
    Configurar la DAO en Aragon con permisos espec√≠ficos.
    Habilitar la creaci√≥n de contratos de servicio para la comunidad.
2Ô∏è‚É£ A√±adir Configuraci√≥n en config/aragon.yml
aragon:
  enabled: true
  dao_address: "0xYourDAOAddress"
  treasury_address: "0xYourDAOTreasury"
  marketplace:
    currency: "USDC"
    service_fee: 2.5 # Comisi√≥n en %
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(aragon-marketplace-config): configura Aragon OSx para la gesti√≥n de un marketplace descentralizado en la DAO"
üìå Commit 112.2: Implementar Smart Contract para Marketplace de Servicios
üîπ Mensaje de commit:
feat(aragon-marketplace-contract): agrega smart contract para la gesti√≥n de servicios y pagos en la DAO con Aragon OSx
üîπ Contenido del commit:
Definir Marketplace.sol en contracts/Marketplace.sol
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;
import "@openzeppelin/contracts/access/Ownable.sol";
import "@openzeppelin/contracts/token/ERC20/IERC20.sol";
contract Marketplace is Ownable {
    IERC20 public usdc;
    address public treasury;
    uint256 public serviceFee;
    struct Service {
        address provider;
        string description;
        uint256 price;
        bool completed;
    }
    mapping(uint256 => Service) public services;
    uint256 public serviceCounter;
    event ServiceListed(uint256 serviceId, address indexed provider, uint256 price);
    event ServiceCompleted(uint256 serviceId, address indexed buyer);
    constructor(IERC20 _usdc, address _treasury, uint256 _serviceFee) {
        usdc = _usdc;
        treasury = _treasury;
        serviceFee = _serviceFee;
    }
    function listService(string memory description, uint256 price) external {
        require(price > 0, "El precio debe ser mayor a 0");
        services[serviceCounter] = Service(msg.sender, description, price, false);
        emit ServiceListed(serviceCounter, msg.sender, price);
        serviceCounter++;
    }
    function buyService(uint256 serviceId) external {
        Service storage service = services[serviceId];
        require(!service.completed, "Servicio ya completado");
        uint256 fee = (service.price * serviceFee) / 100;
        uint256 providerPayment = service.price - fee;
        require(usdc.transferFrom(msg.sender, treasury, fee), "Error al transferir la tarifa");
        require(usdc.transferFrom(msg.sender, service.provider, providerPayment), "Error al pagar al proveedor");
        service.completed = true;
        emit ServiceCompleted(serviceId, msg.sender);
    }
}
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(aragon-marketplace-contract): agrega smart contract para la gesti√≥n de servicios y pagos en la DAO con Aragon OSx"
üìå Commit 112.3: Integrar UI para Publicar y Comprar Servicios
üîπ Mensaje de commit:
feat(aragon-marketplace-ui): agrega UI para listar y comprar servicios en la DAO con Aragon OSx
üîπ Contenido del commit:
Modificar app/javascript/controllers/marketplace_controller.js
import { Controller } from "@hotwired/stimulus";
import Web3 from "web3";
export default class extends Controller {
  static targets = ["description", "price", "serviceId"];
  async listService() {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    const web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    const description = this.descriptionTarget.value;
    const price = Web3.utils.toWei(this.priceTarget.value, "ether");
    const contract = new web3.eth.Contract(
      [{ name: "listService", type: "function", inputs: [{ name: "description", type: "string" }, { name: "price", type: "uint256" }] }],
      "0xYourMarketplaceContractAddress"
    );
    await contract.methods.listService(description, price).send({
      from: window.ethereum.selectedAddress,
    });
    alert("Servicio listado con √©xito");
  }
  async buyService() {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    const web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    const serviceId = parseInt(this.serviceIdTarget.value, 10);
    const contract = new web3.eth.Contract(
      [{ name: "buyService", type: "function", inputs: [{ name: "serviceId", type: "uint256" }] }],
      "0xYourMarketplaceContractAddress"
    );
    await contract.methods.buyService(serviceId).send({
      from: window.ethereum.selectedAddress,
    });
    alert("Servicio comprado con √©xito");
  }
}
Modificar app/views/marketplace/index.html.erb
<h2>Publicar Servicio</h2>
<label>Descripci√≥n:</label>
<input type="text" data-marketplace-target="description">
<label>Precio (USDC):</label>
<input type="text" data-marketplace-target="price">
<button data-controller="marketplace" data-action="click->marketplace#listService">
  Publicar Servicio
</button>
<h2>Comprar Servicio</h2>
<label>ID del Servicio:</label>
<input type="text" data-marketplace-target="serviceId">
<button data-controller="marketplace" data-action="click->marketplace#buyService">
  Comprar Servicio
</button>
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(aragon-marketplace-ui): agrega UI para listar y comprar servicios en la DAO con Aragon OSx"
üìù Explicaci√≥n y C√≥digo Generado
Ejemplo de Publicaci√≥n de Servicio en API
curl -X POST "http://localhost:3000/marketplace/list" \
  -H "Content-Type: application/json" \
  -d '{ "description": "Desarrollo de smart contracts", "price": 500 }'
‚úÖ El servicio se publica en el marketplace de la DAO.
Ejemplo de Compra de Servicio en API
curl -X POST "http://localhost:3000/marketplace/buy" \
  -H "Content-Type: application/json" \
  -d '{ "service_id": 1 }'
‚úÖ Se ejecuta la transacci√≥n para pagar al proveedor del servicio.
Ejemplo de Panel de Marketplace en Aragon
https://app.aragon.org/
‚úÖ Los miembros de la DAO pueden ver y gestionar el marketplace.
