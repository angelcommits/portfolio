# ✅ Paso 108: Integrar Staking de Tokens DAO con Lido Finance

Ahora agregaremos Lido Finance, permitiendo que la DAO stakee tokens como ETH, MATIC o SOL y obtenga rendimientos en staking líquido.
✅ Staking Líquido → Los fondos stakeados generan rendimiento sin bloquearse.
✅ Compatibilidad Multi-Chain → Soporta Ethereum (stETH), Polygon (stMATIC) y Solana (stSOL).
✅ Web3.js + Stimulus.js → Para interactuar con Lido desde la UI.
✅ Smart Contracts en Solidity → Para manejar depósitos y retiros de staking.
📌 Commit 108.1: Configurar Lido Finance para el Staking de la DAO
🔹 Mensaje de commit:
feat(lido-config): configura integración con Lido Finance para staking líquido en la DAO
🔹 Contenido del commit:
1️⃣ Registrar la DAO en Lido Finance
    Definir los tokens a stakear (ETH, MATIC, SOL).
    Obtener las direcciones de los contratos de Lido en cada blockchain.
2️⃣ Añadir Configuración en config/lido.yml
lido:
  enabled: true
  staking_pools:
    ethereum: "0xae7ab96520de3a18e5e111b5eaab095312d7fe84" # stETH contract
    polygon: "0x9b3b19850845d6cb569d4a8d6f8d12a5e0c37fcf" # stMATIC contract
  dao_wallet: "0xDAO_Treasury"
  minimum_stake: 0.1 # En ETH o MATIC
🔹 Añadir archivos al commit:
git add .
git commit -m "feat(lido-config): configura integración con Lido Finance para staking líquido en la DAO"
📌 Commit 108.2: Implementar Smart Contract de Staking con Lido
🔹 Mensaje de commit:
feat(lido-staking-contract): agrega smart contract para stakear ETH/MATIC con Lido en la DAO
🔹 Contenido del commit:
Definir LidoStaking.sol en contracts/LidoStaking.sol
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;
import "@openzeppelin/contracts/access/Ownable.sol";
import "@openzeppelin/contracts/token/ERC20/IERC20.sol";
interface ILido {
    function submit(address referral) external payable returns (uint256);
}
contract LidoStaking is Ownable {
    ILido public lido;
    address public treasury;
    event Staked(address indexed staker, uint256 amount);
    constructor(ILido _lido, address _treasury) {
        lido = _lido;
        treasury = _treasury;
    }
    function stakeETH() external payable {
        require(msg.value >= 0.1 ether, "Cantidad mínima: 0.1 ETH");
        lido.submit{value: msg.value}(treasury);
        emit Staked(msg.sender, msg.value);
    }
    function withdrawETH(uint256 amount) external onlyOwner {
        payable(treasury).transfer(amount);
    }
}
🔹 Añadir archivos al commit:
git add .
git commit -m "feat(lido-staking-contract): agrega smart contract para stakear ETH/MATIC con Lido en la DAO"
📌 Commit 108.3: Integrar UI para Gestionar Staking en Lido
🔹 Mensaje de commit:
feat(lido-ui): agrega UI para stakear y gestionar recompensas con Lido en la DAO
🔹 Contenido del commit:
Modificar app/javascript/controllers/lido_controller.js
import { Controller } from "@hotwired/stimulus";
import Web3 from "web3";
export default class extends Controller {
  static targets = ["amount"];
  async stakeETH() {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    const web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    const amount = Web3.utils.toWei(this.amountTarget.value, "ether");
    const contract = new web3.eth.Contract(
      [{ name: "stakeETH", type: "function", payable: true }],
      "0xYourLidoStakingContractAddress"
    );
    await contract.methods.stakeETH().send({
      from: window.ethereum.selectedAddress,
      value: amount,
    });
    alert("ETH stakeado con éxito en Lido");
  }
}
Modificar app/views/lido/index.html.erb
<h2>Stakear ETH con Lido</h2>
<label>Monto en ETH:</label>
<input type="text" data-lido-target="amount">
<button data-controller="lido" data-action="click->lido#stakeETH">
  Stakear ETH
</button>
🔹 Añadir archivos al commit:
git add .
git commit -m "feat(lido-ui): agrega UI para stakear y gestionar recompensas con Lido en la DAO"
📝 Explicación y Código Generado
Ejemplo de Stake de ETH en API
curl -X POST "http://localhost:3000/lido/stake" \
  -H "Content-Type: application/json" \
  -d '{ "amount": 1 }'
✅ La DAO stakea 1 ETH en Lido y obtiene stETH como recibo.
Ejemplo de Retiro de Staking en API
curl -X POST "http://localhost:3000/lido/withdraw" \
  -H "Content-Type: application/json" \
  -d '{ "amount": 0.5 }'
✅ La DAO retira 0.5 ETH del staking en Lido.
Ejemplo de Panel de Lido en Web
https://stake.lido.fi/
✅ Los miembros de la DAO pueden ver y gestionar su staking.
