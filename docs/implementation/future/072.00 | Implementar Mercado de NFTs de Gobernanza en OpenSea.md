# ‚úÖ Paso 72: Implementar Mercado de NFTs de Gobernanza en OpenSea

Ahora agregaremos un mercado de NFTs en OpenSea, permitiendo que los NFTs de gobernanza puedan comprarse y venderse. Esto facilitar√° la adquisici√≥n de poder de voto en la DAO y permitir√° la transferencia de derechos de gobernanza.
‚úÖ Soporte para OpenSea Marketplace ‚Üí Los NFTs de gobernanza podr√°n venderse y comprarse.
‚úÖ Estandarizaci√≥n ERC-721 Metadata ‚Üí Para que OpenSea pueda indexar los NFTs correctamente.
‚úÖ Web3.js + Stimulus.js ‚Üí Para listar, comprar y transferir NFTs desde la UI.
‚úÖ Smart Contract en Solidity ‚Üí Para manejar la venta y compra de NFTs de gobernanza.
üìå Commit 72.1: Agregar Metadatos ERC-721 para OpenSea en Smart Contract
üîπ Mensaje de commit:
feat(nft-marketplace): agrega metadatos ERC-721 para listar NFTs en OpenSea
üîπ Contenido del commit:
Modificar GovernanceNFT.sol para Soporte OpenSea
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;
import "@openzeppelin/contracts/token/ERC721/extensions/ERC721Enumerable.sol";
import "@openzeppelin/contracts/access/Ownable.sol";
contract GovernanceNFT is ERC721Enumerable, Ownable {
    uint256 public nextTokenId;
    mapping(uint256 => uint256) public votingPower;
    string public baseURI;
    event NFTMinted(address indexed user, uint256 tokenId, uint256 power);
    event VotingPowerUpdated(uint256 tokenId, uint256 power);
    constructor(string memory _baseURI) ERC721("Governance NFT", "GOVNFT") {
        baseURI = _baseURI;
    }
    function mintNFT(address user, uint256 power) external onlyOwner {
        uint256 tokenId = nextTokenId++;
        _mint(user, tokenId);
        votingPower[tokenId] = power;
        emit NFTMinted(user, tokenId, power);
    }
    function updateVotingPower(uint256 tokenId, uint256 power) external onlyOwner {
        require(_exists(tokenId), "NFT no existe");
        votingPower[tokenId] = power;
        emit VotingPowerUpdated(tokenId, power);
    }
    function tokenURI(uint256 tokenId) public view override returns (string memory) {
        require(_exists(tokenId), "Token no existe");
        return string(abi.encodePacked(baseURI, Strings.toString(tokenId), ".json"));
    }
}
Compilar y Desplegar Contrato
npx hardhat compile
npx hardhat run scripts/deploy.js --network goerli
‚úÖ Guardar la direcci√≥n del contrato para el backend.
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(nft-marketplace): agrega metadatos ERC-721 para listar NFTs en OpenSea"
üìå Commit 72.2: Integrar Listado de NFTs en OpenSea en la UI
üîπ Mensaje de commit:
feat(nft-marketplace): integra listado de NFTs en OpenSea en la UI con Web3.js
üîπ Contenido del commit:
Modificar app/javascript/controllers/nft_marketplace_controller.js
import { Controller } from "@hotwired/stimulus";
export default class extends Controller {
  static targets = ["openseaUrl"];
  connect() {
    const contractAddress = "0xYourGovernanceNFTContractAddress";
    this.openseaUrlTarget.href = `https://testnets.opensea.io/assets/goerli/${contractAddress}`;
    this.openseaUrlTarget.innerText = "Ver NFTs en OpenSea";
  }
}
Modificar app/views/nft_marketplace/index.html.erb
<h2>Mercado de NFTs de Gobernanza</h2>
<a data-controller="nft-marketplace" data-nft-marketplace-target="openseaUrl" target="_blank"></a>
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(nft-marketplace): integra listado de NFTs en OpenSea en la UI con Web3.js"
üìå Commit 72.3: Implementar Transferencia de NFTs entre Usuarios
üîπ Mensaje de commit:
feat(nft-marketplace): agrega soporte para transferencia de NFTs de gobernanza entre usuarios
üîπ Contenido del commit:
Modificar app/javascript/controllers/nft_transfer_controller.js
import { Controller } from "@hotwired/stimulus";
import Web3 from "web3";
export default class extends Controller {
  static targets = ["tokenId", "recipient"];
  async transferNFT() {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    const web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    const tokenId = this.tokenIdTarget.value;
    const recipient = this.recipientTarget.value;
    const contract = new web3.eth.Contract(
      [
        { name: "safeTransferFrom", type: "function", inputs: [{ name: "from", type: "address" }, { name: "to", type: "address" }, { name: "tokenId", type: "uint256" }] }
      ],
      "0xYourGovernanceNFTContractAddress"
    );
    await contract.methods.safeTransferFrom(window.ethereum.selectedAddress, recipient, tokenId).send({ from: window.ethereum.selectedAddress });
    alert("NFT transferido con √©xito");
  }
}
Modificar app/views/nft_marketplace/transfer.html.erb
<h2>Transferir NFT de Gobernanza</h2>
<label>ID del NFT:</label>
<input type="text" data-nft-transfer-target="tokenId">
<label>Direcci√≥n del Receptor:</label>
<input type="text" data-nft-transfer-target="recipient">
<button data-controller="nft-transfer" data-action="click->nft-transfer#transferNFT">
  Transferir NFT
</button>
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(nft-marketplace): agrega soporte para transferencia de NFTs de gobernanza entre usuarios"
üìù Explicaci√≥n y C√≥digo Generado
Ejemplo de Ver NFTs en OpenSea
https://testnets.opensea.io/assets/goerli/0xYourGovernanceNFTContractAddress
‚úÖ Los NFTs de gobernanza aparecen listados en OpenSea.
Ejemplo de Transferencia de NFT en API
curl -X POST "http://localhost:3000/nft_marketplace/transfer" \
  -H "Content-Type: application/json" \
  -d '{ "tokenId": 1, "recipient": "0xRecipientWallet" }'
‚úÖ El NFT se transfiere al nuevo usuario.
Ejemplo de Compra de NFT en OpenSea
    El usuario puede hacer clic en "Comprar" en OpenSea y adquirir un NFT de gobernanza.
    Una vez adquirido, podr√° usarlo para votar en la DAO.
