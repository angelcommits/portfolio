# ‚úÖ Paso 119: Integrar Tokenizaci√≥n de Activos DAO con ERC-6551 (Account Abstraction)

Ahora agregaremos ERC-6551, permitiendo que la DAO gestione activos y cuentas de forma m√°s flexible mediante wallets vinculadas a NFTs.
‚úÖ Wallets Asociadas a NFTs ‚Üí Cada NFT puede tener su propia cuenta y firmar transacciones.
‚úÖ Gesti√≥n de Activos Descentralizada ‚Üí Permite a la DAO asignar activos a NFTs espec√≠ficos.
‚úÖ Interoperabilidad con DeFi ‚Üí Los NFTs pueden interactuar con protocolos financieros.
‚úÖ Web3.js + Stimulus.js ‚Üí Para administrar wallets ERC-6551 desde la UI.
‚úÖ Smart Contracts en Solidity ‚Üí Para desplegar y gestionar wallets vinculadas a NFTs.
üìå Commit 119.1: Configurar ERC-6551 para la DAO
üîπ Mensaje de commit:
feat(erc6551-config): configura ERC-6551 para tokenizaci√≥n y gesti√≥n de activos en la DAO
üîπ Contenido del commit:
1Ô∏è‚É£ Registrar la DAO en ERC-6551 Registry
    Configurar el contrato factory para crear wallets ERC-6551.
    Definir tipos de NFTs compatibles con ERC-6551.
2Ô∏è‚É£ A√±adir Configuraci√≥n en config/erc6551.yml
erc6551:
  enabled: true
  registry_address: "0xYourERC6551Registry"
  dao_nft_contract: "0xYourDAONFTContract"
  account_implementation: "0xYourERC6551Implementation"
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(erc6551-config): configura ERC-6551 para tokenizaci√≥n y gesti√≥n de activos en la DAO"
üìå Commit 119.2: Implementar Smart Contract de Wallets Vinculadas a NFTs
üîπ Mensaje de commit:
feat(erc6551-smartcontract): agrega smart contract para gestionar wallets vinculadas a NFTs en la DAO con ERC-6551
üîπ Contenido del commit:
Definir ERC6551Account.sol en contracts/ERC6551Account.sol
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;
import "@openzeppelin/contracts/access/Ownable.sol";
import "@openzeppelin/contracts/token/ERC721/IERC721.sol";
contract ERC6551Account {
    address public owner;
    IERC721 public nftContract;
    uint256 public tokenId;
    event TransactionExecuted(address indexed target, uint256 value, bytes data);
    modifier onlyOwner() {
        require(msg.sender == owner, "No autorizado");
        _;
    }
    constructor(address _nftContract, uint256 _tokenId) {
        nftContract = IERC721(_nftContract);
        tokenId = _tokenId;
        owner = nftContract.ownerOf(_tokenId);
    }
    function executeTransaction(address target, uint256 value, bytes calldata data) external onlyOwner {
        (bool success, ) = target.call{value: value}(data);
        require(success, "Transacci√≥n fallida");
        emit TransactionExecuted(target, value, data);
    }
    receive() external payable {}
}
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(erc6551-smartcontract): agrega smart contract para gestionar wallets vinculadas a NFTs en la DAO con ERC-6551"
üìå Commit 119.3: Integrar UI para Crear y Gestionar Wallets ERC-6551
üîπ Mensaje de commit:
feat(erc6551-ui): agrega UI para desplegar y gestionar wallets ERC-6551 vinculadas a NFTs en la DAO
üîπ Contenido del commit:
Modificar app/javascript/controllers/erc6551_controller.js
import { Controller } from "@hotwired/stimulus";
import Web3 from "web3";
export default class extends Controller {
  static targets = ["nftId", "recipient", "amount", "txData"];
  async createWallet() {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    const web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    const nftId = this.nftIdTarget.value;
    const contract = new web3.eth.Contract(
      [{ name: "createAccount", type: "function", inputs: [{ name: "nftId", type: "uint256" }] }],
      "0xYourERC6551Registry"
    );
    await contract.methods.createAccount(nftId).send({
      from: window.ethereum.selectedAddress,
    });
    alert("Wallet ERC-6551 creada con √©xito");
  }
  async executeTransaction() {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    const web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    const recipient = this.recipientTarget.value;
    const amount = Web3.utils.toWei(this.amountTarget.value, "ether");
    const txData = this.txDataTarget.value;
    const contract = new web3.eth.Contract(
      [{ name: "executeTransaction", type: "function", inputs: [{ name: "target", type: "address" }, { name: "value", type: "uint256" }, { name: "data", type: "bytes" }] }],
      "0xYourERC6551Account"
    );
    await contract.methods.executeTransaction(recipient, amount, txData).send({
      from: window.ethereum.selectedAddress,
    });
    alert("Transacci√≥n ejecutada con √©xito");
  }
}
Modificar app/views/erc6551/index.html.erb
<h2>Gesti√≥n de Wallets ERC-6551 en la DAO</h2>
<h3>Crear Wallet para un NFT</h3>
<label>ID del NFT:</label>
<input type="text" data-erc6551-target="nftId">
<button data-controller="erc6551" data-action="click->erc6551#createWallet">
  Crear Wallet ERC-6551
</button>
<h3>Ejecutar Transacci√≥n desde un NFT</h3>
<label>Direcci√≥n de Destino:</label>
<input type="text" data-erc6551-target="recipient">
<label>Monto (ETH):</label>
<input type="text" data-erc6551-target="amount">
<label>Datos de la Transacci√≥n:</label>
<input type="text" data-erc6551-target="txData">
<button data-controller="erc6551" data-action="click->erc6551#executeTransaction">
  Ejecutar Transacci√≥n
</button>
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(erc6551-ui): agrega UI para desplegar y gestionar wallets ERC-6551 vinculadas a NFTs en la DAO"
üìù Explicaci√≥n y C√≥digo Generado
Ejemplo de Creaci√≥n de Wallet ERC-6551 en API
curl -X POST "http://localhost:3000/erc6551/create_wallet" \
  -H "Content-Type: application/json" \
  -d '{ "nft_id": 42 }'
‚úÖ Crea una wallet ERC-6551 asociada al NFT #42.
Ejemplo de Ejecuci√≥n de Transacci√≥n en API
curl -X POST "http://localhost:3000/erc6551/execute_transaction" \
  -H "Content-Type: application/json" \
  -d '{ "recipient": "0xWalletAddress", "amount": 0.5, "data": "0x" }'
‚úÖ Env√≠a 0.5 ETH desde una wallet ERC-6551.
Ejemplo de Panel de Gesti√≥n de Wallets ERC-6551
https://eips.ethereum.org/EIPS/eip-6551
‚úÖ Los miembros de la DAO pueden administrar wallets vinculadas a NFTs.
