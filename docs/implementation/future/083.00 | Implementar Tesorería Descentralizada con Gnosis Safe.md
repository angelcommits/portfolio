# âœ… Paso 83: Implementar TesorerÃ­a Descentralizada con Gnosis Safe

Ahora agregaremos Gnosis Safe, permitiendo que la DAO tenga un sistema seguro de tesorerÃ­a multi-firma para gestionar fondos y realizar pagos descentralizados.
âœ… Cartera Multi-Firma â†’ La DAO podrÃ¡ gestionar fondos con mÃºltiples aprobaciones.
âœ… Seguridad Descentralizada â†’ Se requiere consenso de los firmantes para ejecutar transacciones.
âœ… Web3.js + Stimulus.js â†’ Para interactuar con la tesorerÃ­a desde la UI.
âœ… IntegraciÃ³n con Snapshot â†’ Para ejecutar pagos aprobados en gobernanza.
ğŸ“Œ Commit 83.1: Configurar Gnosis Safe para la DAO
ğŸ”¹ Mensaje de commit:
feat(gnosis-safe): configura tesorerÃ­a descentralizada para la DAO con Gnosis Safe
ğŸ”¹ Contenido del commit:
1ï¸âƒ£ Crear un Safe en Gnosis Safe
    Agregar direcciÃ³n de la DAO.
    Configurar firmantes y reglas de aprobaciÃ³n.
    Definir activos gestionados (ETH, GOVR, etc.).
2ï¸âƒ£ AÃ±adir ConfiguraciÃ³n en config/gnosis_safe.yml
gnosis_safe:
  address: "0xYourGnosisSafeAddress"
  threshold: 2  # NÃºmero de firmas necesarias
  owners:
    - "0xOwner1Address"
    - "0xOwner2Address"
    - "0xOwner3Address"
ğŸ”¹ AÃ±adir archivos al commit:
git add .
git commit -m "feat(gnosis-safe): configura tesorerÃ­a descentralizada para la DAO con Gnosis Safe"
ğŸ“Œ Commit 83.2: Integrar CreaciÃ³n de Transacciones en la TesorerÃ­a desde la UI
ğŸ”¹ Mensaje de commit:
feat(gnosis-safe): integra UI para crear transacciones en la tesorerÃ­a de la DAO
ğŸ”¹ Contenido del commit:
Modificar app/javascript/controllers/gnosis_safe_controller.js
import { Controller } from "@hotwired/stimulus";
import Web3 from "web3";
export default class extends Controller {
  static targets = ["to", "amount"];
  async createTransaction() {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    const web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    const to = this.toTarget.value;
    const amount = Web3.utils.toWei(this.amountTarget.value, "ether");
    const tx = {
      to: to,
      value: amount,
      data: "0x"
    };
    await fetch(`https://safe-transaction.gnosis.io/api/v1/safes/0xYourGnosisSafeAddress/multisig-transactions/`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(tx)
    });
    alert("TransacciÃ³n creada en Gnosis Safe");
  }
}
Modificar app/views/gnosis_safe/index.html.erb
<h2>Crear TransacciÃ³n en Gnosis Safe</h2>
<label>DirecciÃ³n del Destinatario:</label>
<input type="text" data-gnosis-safe-target="to">
<label>Monto en ETH:</label>
<input type="text" data-gnosis-safe-target="amount">
<button data-controller="gnosis-safe" data-action="click->gnosis-safe#createTransaction">
  Crear TransacciÃ³n
</button>
ğŸ”¹ AÃ±adir archivos al commit:
git add .
git commit -m "feat(gnosis-safe): integra UI para crear transacciones en la tesorerÃ­a de la DAO"
ğŸ“Œ Commit 83.3: Implementar Firma de Transacciones Multi-Firma desde la UI
ğŸ”¹ Mensaje de commit:
feat(gnosis-safe): agrega UI para firmar transacciones en la tesorerÃ­a de la DAO
ğŸ”¹ Contenido del commit:
Modificar app/javascript/controllers/gnosis_sign_controller.js
import { Controller } from "@hotwired/stimulus";
import Web3 from "web3";
export default class extends Controller {
  static targets = ["transactionId"];
  async signTransaction() {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    await window.ethereum.request({ method: "eth_requestAccounts" });
    const transactionId = this.transactionIdTarget.value;
    await fetch(`https://safe-transaction.gnosis.io/api/v1/multisig-transactions/${transactionId}/confirmations/`, {
      method: "POST",
      headers: { "Content-Type": "application/json" }
    });
    alert("TransacciÃ³n firmada en Gnosis Safe");
  }
}
Modificar app/views/gnosis_safe/sign.html.erb
<h2>Firmar TransacciÃ³n en Gnosis Safe</h2>
<label>ID de la TransacciÃ³n:</label>
<input type="text" data-gnosis-sign-target="transactionId">
<button data-controller="gnosis-sign" data-action="click->gnosis-sign#signTransaction">
  Firmar TransacciÃ³n
</button>
ğŸ”¹ AÃ±adir archivos al commit:
git add .
git commit -m "feat(gnosis-safe): agrega UI para firmar transacciones en la tesorerÃ­a de la DAO"
ğŸ“ ExplicaciÃ³n y CÃ³digo Generado
Ejemplo de CreaciÃ³n de TransacciÃ³n en API
curl -X POST "https://safe-transaction.gnosis.io/api/v1/safes/0xYourGnosisSafeAddress/multisig-transactions/" \
  -H "Content-Type: application/json" \
  -d '{ "to": "0xRecipient", "value": "1000000000000000000", "data": "0x" }'
âœ… La transacciÃ³n se crea en Gnosis Safe y espera firmas.
Ejemplo de Firma de TransacciÃ³n en API
curl -X POST "https://safe-transaction.gnosis.io/api/v1/multisig-transactions/0xTxHash/confirmations/" \
  -H "Content-Type: application/json"
âœ… Se firma la transacciÃ³n, y cuando alcanza el umbral, se ejecuta.
Ejemplo de Panel de Gnosis Safe en Web
https://app.safe.global/home?safe=eth:0xYourGnosisSafeAddress
âœ… Los miembros de la DAO pueden ver y firmar transacciones desde Gnosis Safe.
