# ‚úÖ Paso 87: Implementar Alertas y Notificaciones en la DAO (Push Protocol)

Ahora agregaremos Push Protocol (antes EPNS), permitiendo que la DAO env√≠e notificaciones descentralizadas a los miembros cuando haya nuevas propuestas, votaciones o pagos.
‚úÖ Notificaciones Push On-Chain ‚Üí Mensajes seguros e inmutables en Ethereum.
‚úÖ Push API + Web3.js ‚Üí Integraci√≥n directa con la DAO para eventos clave.
‚úÖ Soporte para Wallets y Apps ‚Üí Las notificaciones llegan a MetaMask, Rainbow, etc.
‚úÖ Web3.js + Stimulus.js ‚Üí Para suscribirse y recibir notificaciones en la UI.
üìå Commit 87.1: Configurar Canal de Notificaciones en Push Protocol
üîπ Mensaje de commit:
feat(push-protocol): configura canal de notificaciones para la DAO con Push Protocol
üîπ Contenido del commit:
1Ô∏è‚É£ Crear Canal en Push Protocol
    Configurar nombre e √≠cono del canal.
    Agregar direcci√≥n del contrato de la DAO.
    Definir eventos que generar√°n notificaciones.
2Ô∏è‚É£ A√±adir Configuraci√≥n del Canal en config/push_protocol.yml
push_protocol:
  channel: "0xYourPushChannelAddress"
  events:
    - "Nueva propuesta en la DAO"
    - "Votaci√≥n abierta"
    - "Pago realizado"
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(push-protocol): configura canal de notificaciones para la DAO con Push Protocol"
üìå Commit 87.2: Integrar Env√≠o de Notificaciones desde Smart Contracts
üîπ Mensaje de commit:
feat(push-protocol): agrega emisi√≥n de notificaciones desde contratos de gobernanza
üîπ Contenido del commit:
Modificar TallyGovernor.sol para Enviar Notificaciones
import "@epnsproject/contracts/Push.sol";
contract TallyGovernor {
    PushProtocol public push;
    constructor(address _pushProtocol) {
        push = PushProtocol(_pushProtocol);
    }
    function propose(string memory description) public {
        uint256 proposalId = proposals.length;
        proposals.push(Proposal(description, false));
        push.sendNotification(
            "Nueva propuesta en la DAO",
            description
        );
    }
    function executeProposal(uint256 proposalId) public {
        require(!proposals[proposalId].executed, "Propuesta ya ejecutada");
        proposals[proposalId].executed = true;
        push.sendNotification(
            "Propuesta ejecutada",
            string(abi.encodePacked("La propuesta #", uintToStr(proposalId), " ha sido aprobada y ejecutada."))
        );
    }
}
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(push-protocol): agrega emisi√≥n de notificaciones desde contratos de gobernanza"
üìå Commit 87.3: Integrar UI para Suscribirse a Notificaciones
üîπ Mensaje de commit:
feat(push-protocol): agrega UI para suscribirse y recibir notificaciones de la DAO
üîπ Contenido del commit:
Modificar app/javascript/controllers/push_notifications_controller.js
import { Controller } from "@hotwired/stimulus";
import Web3 from "web3";
export default class extends Controller {
  async subscribe() {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    const web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    await fetch("https://backend.push.org/api/v1/channels/subscribe", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        channel: "0xYourPushChannelAddress",
        user: window.ethereum.selectedAddress
      })
    });
    alert("Suscripci√≥n completada. Recibir√°s notificaciones en tu wallet.");
  }
}
Modificar app/views/push_notifications/index.html.erb
<h2>Suscribirse a Notificaciones de la DAO</h2>
<button data-controller="push-notifications" data-action="click->push-notifications#subscribe">
  Suscribirse a Notificaciones
</button>
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(push-protocol): agrega UI para suscribirse y recibir notificaciones de la DAO"
üìù Explicaci√≥n y C√≥digo Generado
Ejemplo de Enviar Notificaci√≥n en API
curl -X POST "https://backend.push.org/api/v1/channels/send" \
  -H "Content-Type: application/json" \
  -d '{ "channel": "0xYourPushChannelAddress", "title": "Nueva Propuesta", "message": "Vota en la nueva propuesta #12" }'
‚úÖ Los miembros de la DAO reciben una alerta en sus wallets.
Ejemplo de Suscripci√≥n a Notificaciones en API
curl -X POST "https://backend.push.org/api/v1/channels/subscribe" \
  -H "Content-Type: application/json" \
  -d '{ "channel": "0xYourPushChannelAddress", "user": "0xUserWallet" }'
‚úÖ El usuario queda registrado y recibe alertas autom√°ticamente.
Ejemplo de Panel de Notificaciones en Web
https://app.push.org/
‚úÖ Los usuarios pueden ver el historial de alertas de la DAO.
