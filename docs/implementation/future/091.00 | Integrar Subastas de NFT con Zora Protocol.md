# ‚úÖ Paso 91: Integrar Subastas de NFT con Zora Protocol

Ahora agregaremos Zora Protocol, permitiendo que la DAO pueda crear subastas de NFT como mecanismo de recaudaci√≥n de fondos y participaci√≥n en la comunidad.
‚úÖ Subastas Descentralizadas ‚Üí Los usuarios pueden pujar sin intermediarios.
‚úÖ NFTs con Derechos de Gobernanza ‚Üí Los NFTs pueden otorgar beneficios en la DAO.
‚úÖ Web3.js + Stimulus.js ‚Üí Para gestionar subastas desde la UI.
‚úÖ Smart Contract en Solidity ‚Üí Para manejar las subastas en la blockchain.
üìå Commit 91.1: Crear Smart Contract de Subastas con Zora Protocol
üîπ Mensaje de commit:
feat(nft-auctions): agrega smart contract para subastas de NFT en la DAO con Zora Protocol
üîπ Contenido del commit:
Definir NFTAuction.sol en contracts/NFTAuction.sol
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;
import "@openzeppelin/contracts/token/ERC721/IERC721.sol";
import "@openzeppelin/contracts/access/Ownable.sol";
contract NFTAuction is Ownable {
    struct Auction {
        address seller;
        uint256 startingPrice;
        uint256 highestBid;
        address highestBidder;
        bool active;
    }
    IERC721 public nft;
    mapping(uint256 => Auction) public auctions;
    event AuctionCreated(uint256 tokenId, uint256 startingPrice);
    event NewBid(uint256 tokenId, address bidder, uint256 bidAmount);
    event AuctionEnded(uint256 tokenId, address winner, uint256 winningBid);
    constructor(IERC721 _nft) {
        nft = _nft;
    }
    function createAuction(uint256 tokenId, uint256 startingPrice) external {
        require(nft.ownerOf(tokenId) == msg.sender, "No eres el due√±o del NFT");
        require(!auctions[tokenId].active, "La subasta ya est√° activa");
        auctions[tokenId] = Auction(msg.sender, startingPrice, 0, address(0), true);
        emit AuctionCreated(tokenId, startingPrice);
    }
    function bid(uint256 tokenId) external payable {
        Auction storage auction = auctions[tokenId];
        require(auction.active, "Subasta no activa");
        require(msg.value > auction.highestBid, "La oferta debe ser mayor");
        if (auction.highestBid > 0) {
            payable(auction.highestBidder).transfer(auction.highestBid);
        }
        auction.highestBid = msg.value;
        auction.highestBidder = msg.sender;
        emit NewBid(tokenId, msg.sender, msg.value);
    }
    function endAuction(uint256 tokenId) external {
        Auction storage auction = auctions[tokenId];
        require(msg.sender == auction.seller, "Solo el creador puede finalizarla");
        require(auction.active, "Subasta ya finalizada");
        auction.active = false;
        nft.transferFrom(auction.seller, auction.highestBidder, tokenId);
        payable(auction.seller).transfer(auction.highestBid);
        emit AuctionEnded(tokenId, auction.highestBidder, auction.highestBid);
    }
}
Compilar y Desplegar Contrato
npx hardhat compile
npx hardhat run scripts/deploy.js --network goerli
‚úÖ Guardar la direcci√≥n del contrato para la integraci√≥n en la UI.
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(nft-auctions): agrega smart contract para subastas de NFT en la DAO con Zora Protocol"
üìå Commit 91.2: Integrar UI para Crear y Gestionar Subastas de NFT
üîπ Mensaje de commit:
feat(nft-auctions): agrega UI para crear y pujar en subastas de NFT en la DAO con Zora
üîπ Contenido del commit:
Modificar app/javascript/controllers/nft_auction_controller.js
import { Controller } from "@hotwired/stimulus";
import Web3 from "web3";
export default class extends Controller {
  static targets = ["tokenId", "startingPrice", "bidAmount"];
  async createAuction() {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    const web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    const tokenId = this.tokenIdTarget.value;
    const startingPrice = Web3.utils.toWei(this.startingPriceTarget.value, "ether");
    const contract = new web3.eth.Contract(
      [{ name: "createAuction", type: "function", inputs: [{ name: "tokenId", type: "uint256" }, { name: "startingPrice", type: "uint256" }] }],
      "0xYourNFTAuctionContractAddress"
    );
    await contract.methods.createAuction(tokenId, startingPrice).send({ from: window.ethereum.selectedAddress });
    alert("Subasta creada en Zora");
  }
  async placeBid() {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    const web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    const tokenId = this.tokenIdTarget.value;
    const bidAmount = Web3.utils.toWei(this.bidAmountTarget.value, "ether");
    const contract = new web3.eth.Contract(
      [{ name: "bid", type: "function", inputs: [{ name: "tokenId", type: "uint256" }] }],
      "0xYourNFTAuctionContractAddress"
    );
    await contract.methods.bid(tokenId).send({ from: window.ethereum.selectedAddress, value: bidAmount });
    alert("Puja realizada con √©xito");
  }
}
Modificar app/views/nft_auction/index.html.erb
<h2>Crear Subasta de NFT</h2>
<label>ID del NFT:</label>
<input type="text" data-nft-auction-target="tokenId">
<label>Precio Inicial (ETH):</label>
<input type="text" data-nft-auction-target="startingPrice">
<button data-controller="nft-auction" data-action="click->nft-auction#createAuction">
  Crear Subasta
</button>
<br><br>
<h2>Realizar una Puja</h2>
<label>ID del NFT:</label>
<input type="text" data-nft-auction-target="tokenId">
<label>Monto de la Puja (ETH):</label>
<input type="text" data-nft-auction-target="bidAmount">
<button data-controller="nft-auction" data-action="click->nft-auction#placeBid">
  Pujar
</button>
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(nft-auctions): agrega UI para crear y pujar en subastas de NFT en la DAO con Zora"
üìù Explicaci√≥n y C√≥digo Generado
Ejemplo de Crear Subasta en API
curl -X POST "http://localhost:3000/nft_auction/create" \
  -H "Content-Type: application/json" \
  -d '{ "tokenId": 12, "startingPrice": "0.5" }'
‚úÖ Se crea una subasta para el NFT #12 con un precio de 0.5 ETH.
Ejemplo de Realizar una Puja en API
curl -X POST "http://localhost:3000/nft_auction/bid" \
  -H "Content-Type: application/json" \
  -d '{ "tokenId": 12, "bidAmount": "0.7" }'
‚úÖ El usuario puja 0.7 ETH por el NFT #12.
Ejemplo de Ver Subastas en Zora
https://zora.co/
‚úÖ Los usuarios pueden ver y participar en subastas de NFT de la DAO.
