# ✅ Paso 105: Integrar Generación de Reportes On-Chain con Dune Analytics

Ahora agregaremos Dune Analytics, permitiendo que la DAO tenga reportes en tiempo real sobre su actividad on-chain, incluyendo tesorería, gobernanza y participación.
✅ Análisis de Datos On-Chain → Se consulta información directamente desde la blockchain.
✅ Visualización en Tiempo Real → Dashboards con gráficos de tesorería, gobernanza y liquidez.
✅ Soporte para Ethereum y L2s → Compatible con redes como Optimism, Arbitrum y Polygon.
✅ Web3.js + Stimulus.js → Para integrar consultas de Dune desde la UI.
📌 Commit 105.1: Configurar Dune Analytics para la DAO
🔹 Mensaje de commit:
feat(dune-analytics): configura integración con Dune Analytics para reportes de la DAO
🔹 Contenido del commit:
1️⃣ Registrar la DAO en Dune Analytics
    Crear una cuenta y definir consultas SQL para obtener métricas on-chain.
2️⃣ Añadir Configuración en config/dune.yml
dune:
  api_key: "YOUR_DUNE_API_KEY"
  dao_contract: "0xDAOContractAddress"
  queries:
    treasury_balance: 123456  # ID de la consulta en Dune
    governance_participation: 654321
    defi_investments: 789123
🔹 Añadir archivos al commit:
git add .
git commit -m "feat(dune-analytics): configura integración con Dune Analytics para reportes de la DAO"
📌 Commit 105.2: Implementar Servicio de Consultas a Dune Analytics
🔹 Mensaje de commit:
feat(dune-api): agrega servicio para consultar métricas de la DAO en Dune Analytics
🔹 Contenido del commit:
Definir DuneAnalyticsService.rb en app/services/dune_analytics_service.rb
require "httparty"
class DuneAnalyticsService
  DUNE_API_URL = "https://api.dune.com/api/v1/query"
  API_KEY = ENV["DUNE_API_KEY"]
  def self.fetch_report(query_id)
    response = HTTParty.get("#{DUNE_API_URL}/#{query_id}/results", headers: { "X-Dune-API-Key" => API_KEY })
    return JSON.parse(response.body) if response.success?
    nil
  end
  def self.treasury_balance
    fetch_report(ENV["DUNE_TREASURY_QUERY"])
  end
  def self.governance_participation
    fetch_report(ENV["DUNE_GOVERNANCE_QUERY"])
  end
end
🔹 Añadir archivos al commit:
git add .
git commit -m "feat(dune-api): agrega servicio para consultar métricas de la DAO en Dune Analytics"
📌 Commit 105.3: Integrar UI para Visualización de Datos On-Chain
🔹 Mensaje de commit:
feat(dune-ui): agrega UI para visualizar reportes on-chain de la DAO con Dune Analytics
🔹 Contenido del commit:
Modificar app/javascript/controllers/dune_controller.js
import { Controller } from "@hotwired/stimulus";
export default class extends Controller {
  static targets = ["treasury", "governance"];
  async loadTreasuryReport() {
    const response = await fetch("/dune/treasury");
    const data = await response.json();
    this.treasuryTarget.innerText = JSON.stringify(data, null, 2);
  }
  async loadGovernanceReport() {
    const response = await fetch("/dune/governance");
    const data = await response.json();
    this.governanceTarget.innerText = JSON.stringify(data, null, 2);
  }
}
Modificar app/views/dune/index.html.erb
<h2>Reportes On-Chain con Dune Analytics</h2>
<h3>Balance de Tesorería</h3>
<button data-controller="dune" data-action="click->dune#loadTreasuryReport">
  Cargar Reporte
</button>
<pre data-dune-target="treasury">No disponible</pre>
<h3>Participación en Gobernanza</h3>
<button data-controller="dune" data-action="click->dune#loadGovernanceReport">
  Cargar Reporte
</button>
<pre data-dune-target="governance">No disponible</pre>
🔹 Añadir archivos al commit:
git add .
git commit -m "feat(dune-ui): agrega UI para visualizar reportes on-chain de la DAO con Dune Analytics"
📝 Explicación y Código Generado
Ejemplo de Consulta de Balance de Tesorería en API
curl -X GET "http://localhost:3000/dune/treasury"
✅ Retorna el balance de la DAO en tiempo real desde Dune.
Ejemplo de Consulta de Participación en Gobernanza en API
curl -X GET "http://localhost:3000/dune/governance"
✅ Muestra las tasas de participación en votaciones on-chain.
Ejemplo de Panel de Reportes en Dune Analytics
https://dune.com/
✅ Los miembros de la DAO pueden ver y analizar métricas on-chain en tiempo real.
