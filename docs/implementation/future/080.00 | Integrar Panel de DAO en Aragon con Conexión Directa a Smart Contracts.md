# ‚úÖ Paso 80: Integrar Panel de DAO en Aragon con Conexi√≥n Directa a Smart Contracts

Ahora agregaremos un panel de DAO en Aragon, permitiendo que la comunidad interact√∫e directamente con los contratos inteligentes y gestione la DAO sin intermediarios.
‚úÖ Aragon Client ‚Üí Interfaz descentralizada para gestionar la DAO.
‚úÖ M√≥dulo de Votaci√≥n ‚Üí Permite a los miembros votar en propuestas.
‚úÖ Web3.js + Stimulus.js ‚Üí Para interactuar con los contratos de gobernanza desde la UI.
‚úÖ Smart Contracts en Solidity ‚Üí Para manejar propuestas, votos y decisiones.
üìå Commit 80.1: Configurar DAO en Aragon y Definir Smart Contract de Gobernanza
üîπ Mensaje de commit:
feat(aragon-dao): agrega smart contract para gobernanza de DAO en Aragon
üîπ Contenido del commit:
Definir AragonDAO.sol en contracts/AragonDAO.sol
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;
import "@openzeppelin/contracts/access/Ownable.sol";
contract AragonDAO is Ownable {
    struct Proposal {
        string description;
        uint256 yesVotes;
        uint256 noVotes;
        mapping(address => bool) voted;
        bool executed;
    }
    mapping(uint256 => Proposal) public proposals;
    uint256 public proposalCount;
    event ProposalCreated(uint256 indexed proposalId, string description);
    event Voted(uint256 indexed proposalId, address indexed voter, bool vote);
    event ProposalExecuted(uint256 indexed proposalId);
    function createProposal(string memory description) external onlyOwner {
        proposalCount++;
        proposals[proposalCount] = Proposal(description, 0, 0, false);
        emit ProposalCreated(proposalCount, description);
    }
    function vote(uint256 proposalId, bool voteYes) external {
        require(!proposals[proposalId].voted[msg.sender], "Ya votaste en esta propuesta");
        proposals[proposalId].voted[msg.sender] = true;
        if (voteYes) {
            proposals[proposalId].yesVotes++;
        } else {
            proposals[proposalId].noVotes++;
        }
        emit Voted(proposalId, msg.sender, voteYes);
    }
    function executeProposal(uint256 proposalId) external onlyOwner {
        require(!proposals[proposalId].executed, "Propuesta ya ejecutada");
        require(proposals[proposalId].yesVotes > proposals[proposalId].noVotes, "No hay suficientes votos");
        proposals[proposalId].executed = true;
        emit ProposalExecuted(proposalId);
    }
}
Compilar y Desplegar Contrato
npx hardhat compile
npx hardhat run scripts/deploy.js --network goerli
‚úÖ Guardar la direcci√≥n del contrato para la integraci√≥n en la UI.
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(aragon-dao): agrega smart contract para gobernanza de DAO en Aragon"
üìå Commit 80.2: Integrar Creaci√≥n de Propuestas en UI con Web3.js
üîπ Mensaje de commit:
feat(aragon-dao): integra UI para crear propuestas en la DAO usando Web3.js
üîπ Contenido del commit:
Modificar app/javascript/controllers/aragon_proposals_controller.js
import { Controller } from "@hotwired/stimulus";
import Web3 from "web3";
export default class extends Controller {
  static targets = ["description"];
  async createProposal() {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    const web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    const description = this.descriptionTarget.value;
    const contract = new web3.eth.Contract(
      [
        { name: "createProposal", type: "function", inputs: [{ name: "description", type: "string" }] }
      ],
      "0xYourAragonDAOContractAddress"
    );
    await contract.methods.createProposal(description).send({ from: window.ethereum.selectedAddress });
    alert("Propuesta creada con √©xito");
  }
}
Modificar app/views/aragon_proposals/index.html.erb
<h2>Crear Propuesta en la DAO</h2>
<label>Descripci√≥n de la Propuesta:</label>
<input type="text" data-aragon-proposals-target="description">
<button data-controller="aragon-proposals" data-action="click->aragon-proposals#createProposal">
  Crear Propuesta
</button>
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(aragon-dao): integra UI para crear propuestas en la DAO usando Web3.js"
üìå Commit 80.3: Implementar Votaci√≥n en la DAO desde la UI
üîπ Mensaje de commit:
feat(aragon-dao): agrega UI para votar en la DAO usando Web3.js
üîπ Contenido del commit:
Modificar app/javascript/controllers/aragon_voting_controller.js
import { Controller } from "@hotwired/stimulus";
import Web3 from "web3";
export default class extends Controller {
  static targets = ["proposalId"];
  async voteYes() {
    await this.vote(true);
  }
  async voteNo() {
    await this.vote(false);
  }
  async vote(voteYes) {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    const web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    const proposalId = this.proposalIdTarget.value;
    const contract = new web3.eth.Contract(
      [
        { name: "vote", type: "function", inputs: [{ name: "proposalId", type: "uint256" }, { name: "voteYes", type: "bool" }] }
      ],
      "0xYourAragonDAOContractAddress"
    );
    await contract.methods.vote(proposalId, voteYes).send({ from: window.ethereum.selectedAddress });
    alert("Voto registrado con √©xito");
  }
}
Modificar app/views/aragon_voting/index.html.erb
<h2>Votar en la DAO</h2>
<label>ID de la Propuesta:</label>
<input type="text" data-aragon-voting-target="proposalId">
<button data-controller="aragon-voting" data-action="click->aragon-voting#voteYes">
  Votar S√≠
</button>
<button data-controller="aragon-voting" data-action="click->aragon-voting#voteNo">
  Votar No
</button>
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(aragon-dao): agrega UI para votar en la DAO usando Web3.js"
üìù Explicaci√≥n y C√≥digo Generado
Ejemplo de Creaci√≥n de Propuesta en API
curl -X POST "http://localhost:3000/aragon_proposals/create" \
  -H "Content-Type: application/json" \
  -d '{ "description": "Implementar sistema de recompensas en la DAO" }'
‚úÖ Respuesta esperada:
{ "message": "Propuesta creada con √©xito" }
Ejemplo de Votaci√≥n en API
curl -X POST "http://localhost:3000/aragon_voting/vote" \
  -H "Content-Type: application/json" \
  -d '{ "proposalId": 1, "voteYes": true }'
‚úÖ El usuario ha votado en la DAO.
Ejemplo de Panel de Aragon en Web
https://client.aragon.org/#/yourdao.eth
‚úÖ Los miembros pueden votar y administrar la DAO en Aragon.
