# ✅ Paso 100: Implementar Comercio Web3 con Unlock Protocol

Ahora agregaremos Unlock Protocol, permitiendo que la DAO ofrezca membresías pagas y acceso exclusivo a contenido o servicios con Web3.
✅ Acceso Exclusivo Basado en NFT → Solo los titulares de una membresía pueden acceder.
✅ Pagos Descentralizados → Los usuarios pagan con criptomonedas para desbloquear contenido.
✅ Web3.js + Stimulus.js → Para gestionar compras y accesos desde la UI.
✅ Smart Contracts en Solidity → Para definir membresías y permisos en la DAO.
📌 Commit 100.1: Configurar Unlock Protocol para Membresías de la DAO
🔹 Mensaje de commit:
feat(unlock-protocol): configura Unlock Protocol para gestionar membresías y accesos en la DAO
🔹 Contenido del commit:
1️⃣ Registrar la DAO en Unlock Protocol
    Crear un contrato de membresía (lock).
    Definir precios y duración de la membresía.
2️⃣ Añadir Configuración en config/unlock_protocol.yml
unlock_protocol:
  lock_address: "0xYourLockContractAddress"
  membership_price: "0.1 ETH"
  membership_duration: "30 días"
  accepted_tokens:
    - "ETH"
    - "DAI"
    - "USDC"
🔹 Añadir archivos al commit:
git add .
git commit -m "feat(unlock-protocol): configura Unlock Protocol para gestionar membresías y accesos en la DAO"
📌 Commit 100.2: Implementar Smart Contract de Membresía
🔹 Mensaje de commit:
feat(unlock-membership): agrega smart contract para membresías y accesos exclusivos en la DAO con Unlock Protocol
🔹 Contenido del commit:
Definir UnlockMembership.sol en contracts/UnlockMembership.sol
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;
import "@unlock-protocol/contracts/PublicLock.sol";
import "@openzeppelin/contracts/access/Ownable.sol";
contract UnlockMembership is Ownable {
    PublicLock public lock;
    event MembershipPurchased(address indexed buyer);
    constructor(PublicLock _lock) {
        lock = _lock;
    }
    function purchaseMembership() external payable {
        require(msg.value >= lock.keyPrice(), "Pago insuficiente");
        lock.purchase(
            1, // Número de llaves (membresías)
            msg.sender,
            address(0),
            ""
        );
        emit MembershipPurchased(msg.sender);
    }
}
🔹 Añadir archivos al commit:
git add .
git commit -m "feat(unlock-membership): agrega smart contract para membresías y accesos exclusivos en la DAO con Unlock Protocol"
📌 Commit 100.3: Integrar UI para Comprar y Gestionar Membresías
🔹 Mensaje de commit:
feat(unlock-ui): agrega UI para gestionar membresías en la DAO con Unlock Protocol
🔹 Contenido del commit:
Modificar app/javascript/controllers/unlock_controller.js
import { Controller } from "@hotwired/stimulus";
import Web3 from "web3";
export default class extends Controller {
  async purchaseMembership() {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    const web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    const contract = new web3.eth.Contract(
      [{ name: "purchaseMembership", type: "function", payable: true }],
      "0xYourUnlockMembershipContractAddress"
    );
    await contract.methods.purchaseMembership().send({
      from: window.ethereum.selectedAddress,
      value: Web3.utils.toWei("0.1", "ether"),
    });
    alert("Membresía comprada con éxito");
  }
}
Modificar app/views/unlock/index.html.erb
<h2>Comprar Membresía</h2>
<button data-controller="unlock" data-action="click->unlock#purchaseMembership">
  Comprar Membresía (0.1 ETH)
</button>
🔹 Añadir archivos al commit:
git add .
git commit -m "feat(unlock-ui): agrega UI para gestionar membresías en la DAO con Unlock Protocol"
📝 Explicación y Código Generado
Ejemplo de Compra de Membresía en API
curl -X POST "http://localhost:3000/unlock/purchase" \
  -H "Content-Type: application/json"
✅ El usuario compra una membresía y obtiene acceso exclusivo.
Ejemplo de Verificación de Membresía en Smart Contract
function hasAccess(address user) public view returns (bool) {
    return lock.balanceOf(user) > 0;
}
✅ Solo los miembros con un NFT de Unlock pueden acceder a contenido premium.
Ejemplo de Panel de Unlock Protocol en Web
https://app.unlock-protocol.com/
✅ Los usuarios pueden ver y gestionar sus membresías Web3.
