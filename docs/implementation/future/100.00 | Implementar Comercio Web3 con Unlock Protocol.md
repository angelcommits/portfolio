# âœ… Paso 100: Implementar Comercio Web3 con Unlock Protocol

Ahora agregaremos Unlock Protocol, permitiendo que la DAO ofrezca membresÃ­as pagas y acceso exclusivo a contenido o servicios con Web3.
âœ… Acceso Exclusivo Basado en NFT â†’ Solo los titulares de una membresÃ­a pueden acceder.
âœ… Pagos Descentralizados â†’ Los usuarios pagan con criptomonedas para desbloquear contenido.
âœ… Web3.js + Stimulus.js â†’ Para gestionar compras y accesos desde la UI.
âœ… Smart Contracts en Solidity â†’ Para definir membresÃ­as y permisos en la DAO.
ðŸ“Œ Commit 100.1: Configurar Unlock Protocol para MembresÃ­as de la DAO
ðŸ”¹ Mensaje de commit:
feat(unlock-protocol): configura Unlock Protocol para gestionar membresÃ­as y accesos en la DAO
ðŸ”¹ Contenido del commit:
1ï¸âƒ£ Registrar la DAO en Unlock Protocol
    Crear un contrato de membresÃ­a (lock).
    Definir precios y duraciÃ³n de la membresÃ­a.
2ï¸âƒ£ AÃ±adir ConfiguraciÃ³n en config/unlock_protocol.yml
unlock_protocol:
  lock_address: "0xYourLockContractAddress"
  membership_price: "0.1 ETH"
  membership_duration: "30 dÃ­as"
  accepted_tokens:
    - "ETH"
    - "DAI"
    - "USDC"
ðŸ”¹ AÃ±adir archivos al commit:
git add .
git commit -m "feat(unlock-protocol): configura Unlock Protocol para gestionar membresÃ­as y accesos en la DAO"
ðŸ“Œ Commit 100.2: Implementar Smart Contract de MembresÃ­a
ðŸ”¹ Mensaje de commit:
feat(unlock-membership): agrega smart contract para membresÃ­as y accesos exclusivos en la DAO con Unlock Protocol
ðŸ”¹ Contenido del commit:
Definir UnlockMembership.sol en contracts/UnlockMembership.sol
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;
import "@unlock-protocol/contracts/PublicLock.sol";
import "@openzeppelin/contracts/access/Ownable.sol";
contract UnlockMembership is Ownable {
    PublicLock public lock;
    event MembershipPurchased(address indexed buyer);
    constructor(PublicLock _lock) {
        lock = _lock;
    }
    function purchaseMembership() external payable {
        require(msg.value >= lock.keyPrice(), "Pago insuficiente");
        lock.purchase(
            1, // NÃºmero de llaves (membresÃ­as)
            msg.sender,
            address(0),
            ""
        );
        emit MembershipPurchased(msg.sender);
    }
}
ðŸ”¹ AÃ±adir archivos al commit:
git add .
git commit -m "feat(unlock-membership): agrega smart contract para membresÃ­as y accesos exclusivos en la DAO con Unlock Protocol"
ðŸ“Œ Commit 100.3: Integrar UI para Comprar y Gestionar MembresÃ­as
ðŸ”¹ Mensaje de commit:
feat(unlock-ui): agrega UI para gestionar membresÃ­as en la DAO con Unlock Protocol
ðŸ”¹ Contenido del commit:
Modificar app/javascript/controllers/unlock_controller.js
import { Controller } from "@hotwired/stimulus";
import Web3 from "web3";
export default class extends Controller {
  async purchaseMembership() {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    const web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    const contract = new web3.eth.Contract(
      [{ name: "purchaseMembership", type: "function", payable: true }],
      "0xYourUnlockMembershipContractAddress"
    );
    await contract.methods.purchaseMembership().send({
      from: window.ethereum.selectedAddress,
      value: Web3.utils.toWei("0.1", "ether"),
    });
    alert("MembresÃ­a comprada con Ã©xito");
  }
}
Modificar app/views/unlock/index.html.erb
<h2>Comprar MembresÃ­a</h2>
<button data-controller="unlock" data-action="click->unlock#purchaseMembership">
  Comprar MembresÃ­a (0.1 ETH)
</button>
ðŸ”¹ AÃ±adir archivos al commit:
git add .
git commit -m "feat(unlock-ui): agrega UI para gestionar membresÃ­as en la DAO con Unlock Protocol"
ðŸ“ ExplicaciÃ³n y CÃ³digo Generado
Ejemplo de Compra de MembresÃ­a en API
curl -X POST "http://localhost:3000/unlock/purchase" \
  -H "Content-Type: application/json"
âœ… El usuario compra una membresÃ­a y obtiene acceso exclusivo.
Ejemplo de VerificaciÃ³n de MembresÃ­a en Smart Contract
function hasAccess(address user) public view returns (bool) {
    return lock.balanceOf(user) > 0;
}
âœ… Solo los miembros con un NFT de Unlock pueden acceder a contenido premium.
Ejemplo de Panel de Unlock Protocol en Web
https://app.unlock-protocol.com/
âœ… Los usuarios pueden ver y gestionar sus membresÃ­as Web3.
