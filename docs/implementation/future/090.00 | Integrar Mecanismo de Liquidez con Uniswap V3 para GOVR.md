# ‚úÖ Paso 90: Integrar Mecanismo de Liquidez con Uniswap V3 para GOVR

Ahora agregaremos Uniswap V3, permitiendo que la DAO tenga un mercado de liquidez para el token GOVR, facilitando intercambios sin intermediarios.
‚úÖ Creaci√≥n de Pool de Liquidez ‚Üí Se establece un pool de GOVR en Uniswap V3.
‚úÖ Automatizaci√≥n de Swaps ‚Üí Se permite comprar y vender GOVR sin intermediarios.
‚úÖ Web3.js + Stimulus.js ‚Üí Para interactuar con Uniswap desde la UI.
‚úÖ Smart Contract en Solidity ‚Üí Para gestionar la provisi√≥n de liquidez y los swaps.
üìå Commit 90.1: Crear Smart Contract de Liquidez en Uniswap V3
üîπ Mensaje de commit:
feat(uniswap-v3): agrega smart contract para provisi√≥n de liquidez y swaps en Uniswap V3
üîπ Contenido del commit:
Definir UniswapLiquidity.sol en contracts/UniswapLiquidity.sol
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;
import "@uniswap/v3-periphery/contracts/interfaces/ISwapRouter.sol";
import "@openzeppelin/contracts/token/ERC20/IERC20.sol";
import "@openzeppelin/contracts/access/Ownable.sol";
contract UniswapLiquidity is Ownable {
    ISwapRouter public immutable swapRouter;
    IERC20 public immutable govrToken;
    IERC20 public immutable weth;
    uint24 public constant poolFee = 3000; // 0.3% fee
    constructor(ISwapRouter _swapRouter, IERC20 _govrToken, IERC20 _weth) {
        swapRouter = _swapRouter;
        govrToken = _govrToken;
        weth = _weth;
    }
    function swapExactInputSingle(uint256 amountIn) external returns (uint256 amountOut) {
        govrToken.transferFrom(msg.sender, address(this), amountIn);
        govrToken.approve(address(swapRouter), amountIn);
        ISwapRouter.ExactInputSingleParams memory params = ISwapRouter.ExactInputSingleParams({
            tokenIn: address(govrToken),
            tokenOut: address(weth),
            fee: poolFee,
            recipient: msg.sender,
            deadline: block.timestamp,
            amountIn: amountIn,
            amountOutMinimum: 0,
            sqrtPriceLimitX96: 0
        });
        amountOut = swapRouter.exactInputSingle(params);
    }
}
Compilar y Desplegar Contrato
npx hardhat compile
npx hardhat run scripts/deploy.js --network goerli
‚úÖ Guardar la direcci√≥n del contrato para integraci√≥n en la UI.
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(uniswap-v3): agrega smart contract para provisi√≥n de liquidez y swaps en Uniswap V3"
üìå Commit 90.2: Integrar UI para Swaps y Liquidez en Uniswap
üîπ Mensaje de commit:
feat(uniswap-v3): agrega UI para intercambiar y proveer liquidez de GOVR en Uniswap V3
üîπ Contenido del commit:
Modificar app/javascript/controllers/uniswap_controller.js
import { Controller } from "@hotwired/stimulus";
import Web3 from "web3";
export default class extends Controller {
  static targets = ["amount"];
  async swapTokens() {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    const web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    const amountIn = Web3.utils.toWei(this.amountTarget.value, "ether");
    const contract = new web3.eth.Contract(
      [{ name: "swapExactInputSingle", type: "function", inputs: [{ name: "amountIn", type: "uint256" }] }],
      "0xYourUniswapLiquidityContractAddress"
    );
    await contract.methods.swapExactInputSingle(amountIn).send({ from: window.ethereum.selectedAddress });
    alert("Swap completado en Uniswap");
  }
}
Modificar app/views/uniswap/index.html.erb
<h2>Intercambiar GOVR en Uniswap</h2>
<label>Cantidad en GOVR:</label>
<input type="text" data-uniswap-target="amount">
<button data-controller="uniswap" data-action="click->uniswap#swapTokens">
  Intercambiar en Uniswap
</button>
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(uniswap-v3): agrega UI para intercambiar y proveer liquidez de GOVR en Uniswap V3"
üìù Explicaci√≥n y C√≥digo Generado
Ejemplo de Swap de GOVR a ETH en API
curl -X POST "http://localhost:3000/uniswap/swap" \
  -H "Content-Type: application/json" \
  -d '{ "amountIn": 100 }'
‚úÖ El usuario intercambia 100 GOVR por ETH en Uniswap.
Ejemplo de Ver Liquidez en Uniswap
https://info.uniswap.org/#/pools
‚úÖ Los usuarios pueden ver la liquidez y volumen del pool GOVR/ETH.
