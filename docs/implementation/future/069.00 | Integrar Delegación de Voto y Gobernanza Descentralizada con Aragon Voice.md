# ‚úÖ Paso 69: Integrar Delegaci√≥n de Voto y Gobernanza Descentralizada con Aragon Voice

Ahora agregaremos Aragon Voice, permitiendo que los miembros de la DAO deleguen sus votos y participen en la gobernanza descentralizada.
‚úÖ Aragon Voice ‚Üí Plataforma para votaciones en DAOs sin necesidad de gas (gasless voting).
‚úÖ Delegaci√≥n de Voto (Vote Delegation) ‚Üí Miembros pueden delegar votos a representantes.
‚úÖ Web3.js + Stimulus.js ‚Üí Para interacci√≥n fluida en frontend.
‚úÖ Smart Contract en Solidity ‚Üí Para manejar delegaci√≥n y votaci√≥n en DAO.
üìå Commit 69.1: Crear Smart Contract para Votaci√≥n con Delegaci√≥n
üîπ Mensaje de commit:
feat(aragon-voice): agrega smart contract para votaci√≥n con delegaci√≥n en Aragon Voice
üîπ Contenido del commit:
Definir AragonVoice.sol en contracts/AragonVoice.sol
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;
import "@openzeppelin/contracts/token/ERC20/IERC20.sol";
contract AragonVoice {
    IERC20 public governanceToken;
    struct Proposal {
        string description;
        uint256 yesVotes;
        uint256 noVotes;
        mapping(address => bool) voted;
    }
    mapping(uint256 => Proposal) public proposals;
    mapping(address => address) public voteDelegation;
    uint256 public proposalCount;
    event ProposalCreated(uint256 proposalId, string description);
    event Voted(uint256 proposalId, address voter, bool vote);
    event Delegated(address from, address to);
    constructor(IERC20 _governanceToken) {
        governanceToken = _governanceToken;
    }
    function createProposal(string memory description) external {
        proposalCount++;
        proposals[proposalCount] = Proposal(description, 0, 0);
        emit ProposalCreated(proposalCount, description);
    }
    function delegateVote(address delegatee) external {
        voteDelegation[msg.sender] = delegatee;
        emit Delegated(msg.sender, delegatee);
    }
    function vote(uint256 proposalId, bool voteYes) external {
        require(!proposals[proposalId].voted[msg.sender], "Ya votaste");
        address voter = voteDelegation[msg.sender] != address(0) ? voteDelegation[msg.sender] : msg.sender;
        require(governanceToken.balanceOf(voter) > 0, "Sin tokens para votar");
        proposals[proposalId].voted[msg.sender] = true;
        if (voteYes) {
            proposals[proposalId].yesVotes++;
        } else {
            proposals[proposalId].noVotes++;
        }
        emit Voted(proposalId, voter, voteYes);
    }
}
Compilar y Desplegar Contrato
npx hardhat compile
npx hardhat run scripts/deploy.js --network goerli
‚úÖ Guardar la direcci√≥n del contrato para el backend.
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(aragon-voice): agrega smart contract para votaci√≥n con delegaci√≥n en Aragon Voice"
üìå Commit 69.2: Integrar Creaci√≥n de Propuestas en DAO con Web3.js
üîπ Mensaje de commit:
feat(aragon-voice): agrega interfaz para crear propuestas en DAO usando Web3.js
üîπ Contenido del commit:
Modificar app/javascript/controllers/aragon_voice_controller.js
import { Controller } from "@hotwired/stimulus";
import Web3 from "web3";
export default class extends Controller {
  static targets = ["description"];
  async createProposal() {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    const web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    const description = this.descriptionTarget.value;
    const contract = new web3.eth.Contract(
      [
        { name: "createProposal", type: "function", inputs: [{ name: "description", type: "string" }] }
      ],
      "0xYourAragonVoiceContractAddress"
    );
    await contract.methods.createProposal(description).send({ from: window.ethereum.selectedAddress });
    alert("Propuesta creada en la DAO");
  }
}
Modificar app/views/aragon_voice/index.html.erb
<h2>Crear Propuesta en DAO</h2>
<label>Descripci√≥n de la Propuesta:</label>
<input type="text" data-aragon-voice-target="description">
<button data-controller="aragon-voice" data-action="click->aragon-voice#createProposal">
  Crear Propuesta
</button>
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(aragon-voice): agrega interfaz para crear propuestas en DAO usando Web3.js"
üìå Commit 69.3: Implementar Delegaci√≥n de Voto en DAO
üîπ Mensaje de commit:
feat(aragon-voice): agrega delegaci√≥n de voto en DAO usando Web3.js
üîπ Contenido del commit:
Modificar app/javascript/controllers/vote_delegation_controller.js
import { Controller } from "@hotwired/stimulus";
import Web3 from "web3";
export default class extends Controller {
  static targets = ["delegatee"];
  async delegateVote() {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    const web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    const delegatee = this.delegateeTarget.value;
    const contract = new web3.eth.Contract(
      [
        { name: "delegateVote", type: "function", inputs: [{ name: "delegatee", type: "address" }] }
      ],
      "0xYourAragonVoiceContractAddress"
    );
    await contract.methods.delegateVote(delegatee).send({ from: window.ethereum.selectedAddress });
    alert("Voto delegado con √©xito");
  }
}
Modificar app/views/aragon_voice/delegate.html.erb
<h2>Delegar Voto en DAO</h2>
<label>Direcci√≥n del Delegado:</label>
<input type="text" data-vote-delegation-target="delegatee">
<button data-controller="vote-delegation" data-action="click->vote-delegation#delegateVote">
  Delegar Voto
</button>
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(aragon-voice): agrega delegaci√≥n de voto en DAO usando Web3.js"
üìù Explicaci√≥n y C√≥digo Generado
Ejemplo de Crear Propuesta en DAO en API
curl -X POST "http://localhost:3000/aragon_voice/create" \
  -H "Content-Type: application/json" \
  -d '{ "description": "Financiar nuevo proyecto open-source" }'
‚úÖ Respuesta esperada:
{ "message": "Propuesta creada en la DAO" }
Ejemplo de Delegar Voto en API
curl -X POST "http://localhost:3000/aragon_voice/delegate" \
  -H "Content-Type: application/json" \
  -d '{ "delegatee": "0xDelegateWallet" }'
‚úÖ Voto delegado exitosamente.
Ejemplo de Participaci√≥n en Gobernanza en Aragon Voice
https://voice.aragon.org/#/yourdao.eth
‚úÖ Los usuarios pueden votar en la DAO sin pagar gas.
