# âœ… Paso 101: Integrar MensajerÃ­a On-Chain con XMTP (Web3 Messaging)

Ahora agregaremos XMTP (Extensible Message Transport Protocol), permitiendo que los miembros de la DAO envÃ­en mensajes privados on-chain utilizando sus wallets.
âœ… Mensajes Encriptados â†’ ComunicaciÃ³n privada usando claves de la wallet del usuario.
âœ… Persistencia Descentralizada â†’ Los mensajes se almacenan de forma segura en la red XMTP.
âœ… Web3.js + Stimulus.js â†’ Para que los usuarios envÃ­en y reciban mensajes desde la UI.
âœ… Soporte para ENS y Wallets â†’ Los mensajes pueden enviarse a direcciones ETH o nombres ENS.
ğŸ“Œ Commit 101.1: Configurar XMTP para MensajerÃ­a Web3 en la DAO
ğŸ”¹ Mensaje de commit:
feat(xmtp-messaging): configura XMTP para comunicaciÃ³n descentralizada entre miembros de la DAO
ğŸ”¹ Contenido del commit:
1ï¸âƒ£ Registrar la DAO en XMTP
    Generar una identidad XMTP vinculada a la DAO.
    Habilitar mensajerÃ­a entre wallets y ENS.
2ï¸âƒ£ AÃ±adir ConfiguraciÃ³n en config/xmtp.yml
xmtp:
  dao_wallet: "0xYourDAOAddress"
  messaging_enabled: true
  encryption: "AES-256"
ğŸ”¹ AÃ±adir archivos al commit:
git add .
git commit -m "feat(xmtp-messaging): configura XMTP para comunicaciÃ³n descentralizada entre miembros de la DAO"
ğŸ“Œ Commit 101.2: Implementar MensajerÃ­a con XMTP en la DAO
ğŸ”¹ Mensaje de commit:
feat(xmtp-messaging-contract): agrega integraciÃ³n con XMTP para enviar mensajes en la DAO
ğŸ”¹ Contenido del commit:
Modificar app/javascript/controllers/xmtp_controller.js
import { Controller } from "@hotwired/stimulus";
import { Client } from "@xmtp/xmtp-js";
import Web3 from "web3";
export default class extends Controller {
  static targets = ["recipient", "message", "conversation"];
  async sendMessage() {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    const web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    const recipient = this.recipientTarget.value;
    const message = this.messageTarget.value;
    const xmtp = await Client.create(window.ethereum);
    const conversation = await xmtp.conversations.newConversation(recipient);
    await conversation.send(message);
    alert("Mensaje enviado con Ã©xito a " + recipient);
  }
  async loadMessages() {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    const xmtp = await Client.create(window.ethereum);
    const messages = await xmtp.conversations.list();
    let displayMessages = messages.map(msg => `${msg.sender}: ${msg.content}`).join("\n");
    this.conversationTarget.innerText = displayMessages || "No hay mensajes";
  }
}
Modificar app/views/xmtp/index.html.erb
<h2>MensajerÃ­a Web3 con XMTP</h2>
<label>Enviar a (Wallet o ENS):</label>
<input type="text" data-xmtp-target="recipient">
<label>Mensaje:</label>
<input type="text" data-xmtp-target="message">
<button data-controller="xmtp" data-action="click->xmtp#sendMessage">
  Enviar Mensaje
</button>
<br><br>
<h2>Mensajes Recibidos</h2>
<button data-controller="xmtp" data-action="click->xmtp#loadMessages">
  Cargar Mensajes
</button>
<pre data-xmtp-target="conversation">No hay mensajes</pre>
ğŸ”¹ AÃ±adir archivos al commit:
git add .
git commit -m "feat(xmtp-messaging-ui): agrega UI para mensajerÃ­a Web3 con XMTP en la DAO"
ğŸ“Œ Commit 101.3: Implementar VerificaciÃ³n de Identidad en Mensajes XMTP
ğŸ”¹ Mensaje de commit:
feat(xmtp-verification): agrega verificaciÃ³n de identidad en la mensajerÃ­a XMTP de la DAO
ğŸ”¹ Contenido del commit:
Modificar app/javascript/controllers/xmtp_controller.js
async verifyIdentity() {
  const recipient = this.recipientTarget.value;
  const xmtp = await Client.create(window.ethereum);
  const canMessage = await xmtp.canMessage(recipient);
  if (canMessage) {
    alert("El destinatario tiene XMTP habilitado.");
  } else {
    alert("El destinatario no puede recibir mensajes.");
  }
}
Modificar app/views/xmtp/index.html.erb
<button data-controller="xmtp" data-action="click->xmtp#verifyIdentity">
  Verificar Identidad
</button>
ğŸ”¹ AÃ±adir archivos al commit:
git add .
git commit -m "feat(xmtp-verification): agrega verificaciÃ³n de identidad en la mensajerÃ­a XMTP de la DAO"
ğŸ“ ExplicaciÃ³n y CÃ³digo Generado
Ejemplo de Enviar Mensaje en API
curl -X POST "http://localhost:3000/xmtp/send" \
  -H "Content-Type: application/json" \
  -d '{ "recipient": "0xUserWallet", "message": "Hola desde la DAO!" }'
âœ… El mensaje se envÃ­a on-chain a la wallet o ENS del destinatario.
Ejemplo de Cargar Mensajes en API
curl -X GET "http://localhost:3000/xmtp/messages"
âœ… Muestra el historial de mensajes Web3.
Ejemplo de VerificaciÃ³n de Identidad en API
curl -X GET "http://localhost:3000/xmtp/verify?recipient=0xUserWallet"
âœ… Verifica si el destinatario tiene XMTP habilitado.
Ejemplo de Panel de MensajerÃ­a Web3 en XMTP
https://xmtp.chat/
âœ… Los usuarios pueden ver y gestionar sus mensajes Web3.
