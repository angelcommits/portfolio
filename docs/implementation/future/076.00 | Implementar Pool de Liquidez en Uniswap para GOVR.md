# ‚úÖ Paso 76: Implementar Pool de Liquidez en Uniswap para GOVR

Ahora agregaremos un pool de liquidez en Uniswap, permitiendo que los usuarios intercambien GOVR por ETH y otras criptomonedas directamente en la blockchain. Esto garantizar√° que GOVR tenga liquidez y pueda ser comprado/vendido libremente.
‚úÖ Uniswap V3 Pool ‚Üí Creaci√≥n de un pool para GOVR/ETH.
‚úÖ Contrato de Liquidez ‚Üí Permite a√±adir y retirar liquidez al pool.
‚úÖ Web3.js + Stimulus.js ‚Üí Para interactuar con el pool desde la UI.
‚úÖ Solidity Smart Contract ‚Üí Para manejar la provisi√≥n y retiro de liquidez.
üìå Commit 76.1: Crear Smart Contract de Liquidez para GOVR/ETH en Uniswap
üîπ Mensaje de commit:
feat(uniswap-pool): agrega smart contract para pool de liquidez GOVR/ETH en Uniswap
üîπ Contenido del commit:
Definir GOVRLiquidityPool.sol en contracts/GOVRLiquidityPool.sol
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;
import "@uniswap/v3-periphery/contracts/interfaces/ISwapRouter.sol";
import "@openzeppelin/contracts/token/ERC20/IERC20.sol";
import "@openzeppelin/contracts/access/Ownable.sol";
contract GOVRLiquidityPool is Ownable {
    IERC20 public govrToken;
    ISwapRouter public swapRouter;
    uint24 public constant poolFee = 3000; // 0.3% fee en Uniswap
    event LiquidityAdded(address indexed provider, uint256 govrAmount, uint256 ethAmount);
    event LiquidityRemoved(address indexed provider, uint256 govrAmount, uint256 ethAmount);
    event SwapExecuted(address indexed user, uint256 amountIn, uint256 amountOut);
    constructor(IERC20 _govrToken, ISwapRouter _swapRouter) {
        govrToken = _govrToken;
        swapRouter = _swapRouter;
    }
    function addLiquidity(uint256 govrAmount) external payable {
        require(govrAmount > 0 && msg.value > 0, "Debe aportar GOVR y ETH");
        govrToken.transferFrom(msg.sender, address(this), govrAmount);
        emit LiquidityAdded(msg.sender, govrAmount, msg.value);
    }
    function removeLiquidity(uint256 govrAmount) external onlyOwner {
        require(govrToken.balanceOf(address(this)) >= govrAmount, "Fondos insuficientes");
        uint256 ethAmount = (govrAmount * address(this).balance) / govrToken.balanceOf(address(this));
        govrToken.transfer(msg.sender, govrAmount);
        payable(msg.sender).transfer(ethAmount);
        emit LiquidityRemoved(msg.sender, govrAmount, ethAmount);
    }
    function swapExactInputSingle(uint256 amountIn, address recipient) external returns (uint256 amountOut) {
        govrToken.transferFrom(msg.sender, address(this), amountIn);
        ISwapRouter.ExactInputSingleParams memory params =
            ISwapRouter.ExactInputSingleParams({
                tokenIn: address(govrToken),
                tokenOut: swapRouter.WETH9(),
                fee: poolFee,
                recipient: recipient,
                deadline: block.timestamp + 15 minutes,
                amountIn: amountIn,
                amountOutMinimum: 1,
                sqrtPriceLimitX96: 0
            });
        amountOut = swapRouter.exactInputSingle(params);
        emit SwapExecuted(msg.sender, amountIn, amountOut);
    }
}
Compilar y Desplegar Contrato
npx hardhat compile
npx hardhat run scripts/deploy.js --network goerli
‚úÖ Guardar la direcci√≥n del contrato para el backend.
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(uniswap-pool): agrega smart contract para pool de liquidez GOVR/ETH en Uniswap"
üìå Commit 76.2: Integrar UI para A√±adir Liquidez a GOVR en Uniswap
üîπ Mensaje de commit:
feat(uniswap-pool): integra UI para a√±adir liquidez a GOVR en Uniswap
üîπ Contenido del commit:
Modificar app/javascript/controllers/liquidity_controller.js
import { Controller } from "@hotwired/stimulus";
import Web3 from "web3";
export default class extends Controller {
  static targets = ["govrAmount"];
  async addLiquidity() {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    const web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    const govrAmount = this.govrAmountTarget.value;
    const contract = new web3.eth.Contract(
      [
        { name: "addLiquidity", type: "function", inputs: [{ name: "govrAmount", type: "uint256" }] }
      ],
      "0xYourLiquidityPoolContractAddress"
    );
    await contract.methods.addLiquidity(govrAmount).send({
      from: window.ethereum.selectedAddress,
      value: web3.utils.toWei("0.1", "ether") // Aportar ETH junto con GOVR
    });
    alert("Liquidez a√±adida con √©xito");
  }
}
Modificar app/views/liquidity/index.html.erb
<h2>A√±adir Liquidez a GOVR</h2>
<label>Cantidad de GOVR:</label>
<input type="text" data-liquidity-target="govrAmount">
<button data-controller="liquidity" data-action="click->liquidity#addLiquidity">
  A√±adir Liquidez
</button>
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(uniswap-pool): integra UI para a√±adir liquidez a GOVR en Uniswap"
üìå Commit 76.3: Integrar Swaps de GOVR/ETH en la UI con Web3.js
üîπ Mensaje de commit:
feat(uniswap-pool): agrega UI para intercambiar GOVR por ETH en Uniswap
üîπ Contenido del commit:
Modificar app/javascript/controllers/swap_controller.js
import { Controller } from "@hotwired/stimulus";
import Web3 from "web3";
export default class extends Controller {
  static targets = ["amountIn"];
  async swapGOVR() {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    const web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    const amountIn = this.amountInTarget.value;
    const contract = new web3.eth.Contract(
      [
        { name: "swapExactInputSingle", type: "function", inputs: [{ name: "amountIn", type: "uint256" }, { name: "recipient", type: "address" }] }
      ],
      "0xYourLiquidityPoolContractAddress"
    );
    await contract.methods.swapExactInputSingle(amountIn, window.ethereum.selectedAddress).send({ from: window.ethereum.selectedAddress });
    alert("Swap de GOVR a ETH realizado con √©xito");
  }
}
Modificar app/views/swap/index.html.erb
<h2>Intercambiar GOVR por ETH</h2>
<label>Cantidad de GOVR:</label>
<input type="text" data-swap-target="amountIn">
<button data-controller="swap" data-action="click->swap#swapGOVR">
  Intercambiar
</button>
üîπ A√±adir archivos al commit:
git add .
git commit -m "feat(uniswap-pool): agrega UI para intercambiar GOVR por ETH en Uniswap"
üìù Explicaci√≥n y C√≥digo Generado
Ejemplo de A√±adir Liquidez en API
curl -X POST "http://localhost:3000/liquidity/add" \
  -H "Content-Type: application/json" \
  -d '{ "govrAmount": 100 }'
‚úÖ Los tokens GOVR y ETH se a√±aden al pool de liquidez.
Ejemplo de Swap GOVR/ETH en API
curl -X POST "http://localhost:3000/swap" \
  -H "Content-Type: application/json" \
  -d '{ "amountIn": 50 }'
‚úÖ El usuario intercambia 50 GOVR por ETH en Uniswap.
