# ✅ Paso 86: Integrar Oracle de Datos en la DAO (Chainlink)

Ahora agregaremos Chainlink Oracle, permitiendo que la DAO pueda utilizar datos externos confiables (como precios de mercado, eventos on-chain, etc.) para ejecutar decisiones de gobernanza.
✅ Oráculos Descentralizados → Acceso a datos externos sin intermediarios.
✅ Precios en Tiempo Real → Para votaciones y ejecuciones basadas en datos del mercado.
✅ Web3.js + Stimulus.js → Para visualizar datos del oráculo en la UI.
✅ Smart Contract en Solidity → Para consultar Chainlink y tomar decisiones on-chain.
📌 Commit 86.1: Crear Smart Contract de Consulta de Oráculos en Chainlink
🔹 Mensaje de commit:
feat(chainlink-oracle): agrega smart contract para integración con oráculos de Chainlink
🔹 Contenido del commit:
Definir ChainlinkOracle.sol en contracts/ChainlinkOracle.sol
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;
import "@chainlink/contracts/src/v0.8/interfaces/AggregatorV3Interface.sol";
import "@openzeppelin/contracts/access/Ownable.sol";
contract ChainlinkOracle is Ownable {
    AggregatorV3Interface internal priceFeed;
    event PriceUpdated(int256 price);
    constructor(address _oracleAddress) {
        priceFeed = AggregatorV3Interface(_oracleAddress);
    }
    function getLatestPrice() public view returns (int256) {
        (, int256 price, , , ) = priceFeed.latestRoundData();
        return price;
    }
    function updatePrice() external {
        int256 price = getLatestPrice();
        emit PriceUpdated(price);
    }
}
Compilar y Desplegar Contrato
npx hardhat compile
npx hardhat run scripts/deploy.js --network goerli
✅ Guardar la dirección del contrato para la integración en la UI.
🔹 Añadir archivos al commit:
git add .
git commit -m "feat(chainlink-oracle): agrega smart contract para integración con oráculos de Chainlink"
📌 Commit 86.2: Integrar UI para Consultar Precios en Chainlink
🔹 Mensaje de commit:
feat(chainlink-oracle): integra UI para visualizar precios de Chainlink en la DAO
🔹 Contenido del commit:
Modificar app/javascript/controllers/chainlink_oracle_controller.js
import { Controller } from "@hotwired/stimulus";
import Web3 from "web3";
export default class extends Controller {
  static targets = ["price"];
  async getLatestPrice() {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    const web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    const contract = new web3.eth.Contract(
      [{ name: "getLatestPrice", type: "function", outputs: [{ type: "int256" }] }],
      "0xYourChainlinkOracleContractAddress"
    );
    const price = await contract.methods.getLatestPrice().call();
    this.priceTarget.innerText = `Precio Actual: ${price} USD`;
  }
}
Modificar app/views/chainlink_oracle/index.html.erb
<h2>Consultar Precio de Chainlink</h2>
<p data-chainlink-oracle-target="price">Precio Actual: -- USD</p>
<button data-controller="chainlink-oracle" data-action="click->chainlink-oracle#getLatestPrice">
  Obtener Precio
</button>
🔹 Añadir archivos al commit:
git add .
git commit -m "feat(chainlink-oracle): integra UI para visualizar precios de Chainlink en la DAO"
📌 Commit 86.3: Integrar Condiciones de Gobernanza Basadas en Datos de Chainlink
🔹 Mensaje de commit:
feat(chainlink-oracle): agrega condiciones de gobernanza basadas en datos del mercado
🔹 Contenido del commit:
Modificar TallyGovernor.sol para Usar Chainlink en Decisiones
function executeProposal(uint256 proposalId) external override {
    require(!proposals[proposalId].executed, "Propuesta ya ejecutada");
    int256 marketPrice = priceOracle.getLatestPrice();
    require(marketPrice > 2000 * 1e8, "Precio muy bajo para ejecutar");
    proposals[proposalId].executed = true;
    emit ProposalExecuted(proposalId);
}
🔹 Añadir archivos al commit:
git add .
git commit -m "feat(chainlink-oracle): agrega condiciones de gobernanza basadas en datos del mercado"
📝 Explicación y Código Generado
Ejemplo de Consulta de Precio en API
curl -X GET "http://localhost:3000/chainlink_oracle/price"
✅ El usuario recibe el precio actual del mercado.
Ejemplo de Verificación de Precio en API
curl -X GET "https://data.chain.link/ethereum/mainnet/crypto-usd/eth-usd"
✅ El sistema verifica el precio antes de ejecutar propuestas.
Ejemplo de Panel de Chainlink en Web
https://data.chain.link/
✅ Los miembros pueden verificar los datos usados en la gobernanza.
