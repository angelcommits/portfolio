# âœ… Paso 77: Integrar Recompensas de Yield Farming para Proveedores de Liquidez

Ahora agregaremos yield farming, permitiendo que los usuarios ganen recompensas en GOVR por proveer liquidez al pool de Uniswap. Cuanto mÃ¡s tiempo mantengan su liquidez en el pool, mayor serÃ¡ la recompensa.
âœ… Recompensas en GOVR â†’ Los proveedores de liquidez reciben GOVR proporcional a su aporte.
âœ… Mecanismo de Yield Farming â†’ MÃ¡s tiempo en el pool = mÃ¡s recompensas.
âœ… Web3.js + Stimulus.js â†’ Para interactuar con la UI y visualizar recompensas.
âœ… Solidity Smart Contract â†’ Para distribuir recompensas automÃ¡ticamente.
ğŸ“Œ Commit 77.1: Crear Smart Contract para Yield Farming de GOVR
ğŸ”¹ Mensaje de commit:
feat(yield-farming): agrega smart contract para recompensas de yield farming en Uniswap
ğŸ”¹ Contenido del commit:
Definir GOVRYieldFarming.sol en contracts/GOVRYieldFarming.sol
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;
import "@openzeppelin/contracts/token/ERC20/IERC20.sol";
import "@openzeppelin/contracts/access/Ownable.sol";
contract GOVRYieldFarming is Ownable {
    IERC20 public govrToken;
    IERC20 public lpToken; // Token de liquidez de Uniswap
    struct Staker {
        uint256 amount;
        uint256 rewardDebt;
        uint256 depositTime;
    }
    mapping(address => Staker) public stakers;
    uint256 public rewardRate = 5 * 10 ** 18; // 5 GOVR por bloque
    uint256 public totalStaked;
    event LiquidityStaked(address indexed user, uint256 amount);
    event LiquidityUnstaked(address indexed user, uint256 amount, uint256 reward);
    constructor(IERC20 _govrToken, IERC20 _lpToken) {
        govrToken = _govrToken;
        lpToken = _lpToken;
    }
    function stakeLiquidity(uint256 amount) external {
        require(amount > 0, "Debes aportar liquidez");
        lpToken.transferFrom(msg.sender, address(this), amount);
        stakers[msg.sender].amount += amount;
        stakers[msg.sender].depositTime = block.timestamp;
        totalStaked += amount;
        emit LiquidityStaked(msg.sender, amount);
    }
    function unstakeLiquidity() external {
        Staker storage staker = stakers[msg.sender];
        require(staker.amount > 0, "No tienes liquidez en staking");
        uint256 stakingDuration = block.timestamp - staker.depositTime;
        uint256 rewardAmount = (stakingDuration / 30 days) * rewardRate * staker.amount / totalStaked;
        lpToken.transfer(msg.sender, staker.amount);
        govrToken.transfer(msg.sender, rewardAmount);
        totalStaked -= staker.amount;
        delete stakers[msg.sender];
        emit LiquidityUnstaked(msg.sender, staker.amount, rewardAmount);
    }
}
Compilar y Desplegar Contrato
npx hardhat compile
npx hardhat run scripts/deploy.js --network goerli
âœ… Guardar la direcciÃ³n del contrato para el backend.
ğŸ”¹ AÃ±adir archivos al commit:
git add .
git commit -m "feat(yield-farming): agrega smart contract para recompensas de yield farming en Uniswap"
ğŸ“Œ Commit 77.2: Integrar UI para Staking de Liquidez en Yield Farming
ğŸ”¹ Mensaje de commit:
feat(yield-farming): integra UI para staking de liquidez en yield farming
ğŸ”¹ Contenido del commit:
Modificar app/javascript/controllers/yield_farming_controller.js
import { Controller } from "@hotwired/stimulus";
import Web3 from "web3";
export default class extends Controller {
  static targets = ["lpAmount"];
  async stakeLiquidity() {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    const web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    const lpAmount = this.lpAmountTarget.value;
    const contract = new web3.eth.Contract(
      [
        { name: "stakeLiquidity", type: "function", inputs: [{ name: "amount", type: "uint256" }] }
      ],
      "0xYourYieldFarmingContractAddress"
    );
    await contract.methods.stakeLiquidity(lpAmount).send({ from: window.ethereum.selectedAddress });
    alert("Liquidez enviada a yield farming con Ã©xito");
  }
}
Modificar app/views/yield_farming/index.html.erb
<h2>Hacer Staking de Liquidez en Uniswap</h2>
<label>Cantidad de Liquidez (LP Tokens):</label>
<input type="text" data-yield-farming-target="lpAmount">
<button data-controller="yield-farming" data-action="click->yield-farming#stakeLiquidity">
  Enviar a Staking
</button>
ğŸ”¹ AÃ±adir archivos al commit:
git add .
git commit -m "feat(yield-farming): integra UI para staking de liquidez en yield farming"
ğŸ“Œ Commit 77.3: Implementar Reclamo de Recompensas en la UI
ğŸ”¹ Mensaje de commit:
feat(yield-farming): agrega UI para reclamar recompensas de yield farming en GOVR
ğŸ”¹ Contenido del commit:
Modificar app/javascript/controllers/reward_claim_controller.js
import { Controller } from "@hotwired/stimulus";
import Web3 from "web3";
export default class extends Controller {
  async unstakeLiquidity() {
    if (!window.ethereum) {
      alert("Por favor instala MetaMask");
      return;
    }
    const web3 = new Web3(window.ethereum);
    await window.ethereum.request({ method: "eth_requestAccounts" });
    const contract = new web3.eth.Contract(
      [{ name: "unstakeLiquidity", type: "function", inputs: [] }],
      "0xYourYieldFarmingContractAddress"
    );
    await contract.methods.unstakeLiquidity().send({ from: window.ethereum.selectedAddress });
    alert("Liquidez retirada y recompensas reclamadas con Ã©xito");
  }
}
Modificar app/views/yield_farming/claim.html.erb
<h2>Reclamar Recompensas de Yield Farming</h2>
<button data-controller="reward-claim" data-action="click->reward-claim#unstakeLiquidity">
  Reclamar Recompensas
</button>
ğŸ”¹ AÃ±adir archivos al commit:
git add .
git commit -m "feat(yield-farming): agrega UI para reclamar recompensas de yield farming en GOVR"
ğŸ“ ExplicaciÃ³n y CÃ³digo Generado
Ejemplo de Staking de Liquidez en API
curl -X POST "http://localhost:3000/yield_farming/stake" \
  -H "Content-Type: application/json" \
  -d '{ "lpAmount": 50 }'
âœ… El usuario deposita 50 LP tokens en yield farming.
Ejemplo de Reclamo de Recompensas en API
curl -X POST "http://localhost:3000/yield_farming/claim"
âœ… El usuario recibe GOVR proporcional a su tiempo en staking.
Ejemplo de Ver Balance de GOVR en Etherscan
https://goerli.etherscan.io/token/0xYourGOVRTokenAddress?a=0xUserWallet
âœ… El usuario ve sus recompensas en GOVR en su wallet.
