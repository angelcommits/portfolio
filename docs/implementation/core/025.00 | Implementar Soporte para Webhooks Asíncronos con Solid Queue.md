# âœ… Paso 25: Implementar Soporte para Webhooks AsÃ­ncronos con Solid Queue

Ahora configuraremos Solid Queue para procesar webhooks en segundo plano, evitando bloqueos en la API y mejorando la escalabilidad.
âœ… Solid Queue â†’ Maneja los webhooks como Jobs en segundo plano.
âœ… EjecuciÃ³n asincrÃ³nica â†’ Permite procesar eventos sin ralentizar la API.
âœ… Retrys automÃ¡ticos â†’ Reintenta fallos de entrega automÃ¡ticamente.
ğŸ“Œ Commit 25.1: Crear Job para Enviar Webhooks en Segundo Plano
ğŸ”¹ Mensaje de commit:
feat(webhooks): agrega WebhookJob para procesar webhooks asÃ­ncronamente con Solid Queue
ğŸ”¹ Contenido del commit:
# Generar un Job para enviar webhooks en segundo plano
rails g job webhook
Modificar WebhookJob en app/jobs/webhook_job.rb
class WebhookJob < ApplicationJob
queue_as :default
def perform(event_name, payload, url)
uri = URI.parse(url)
http = Net::HTTP.new(uri.host, uri.port)
http.use_ssl = uri.scheme == "https"
    request = Net::HTTP::Post.new(uri.path, { "Content-Type" => "application/json" })
    request.body = payload.to_json
    response = http.request(request)
    unless response.is_a?(Net::HTTPSuccess)
      Rails.logger.error("Webhook failed: #{response.code} - #{response.body}")
      raise "Webhook delivery failed"
    end
end
end
ğŸ”¹ AÃ±adir archivos al commit:
git add .
git commit -m "feat(webhooks): agrega WebhookJob para procesar webhooks asÃ­ncronamente con Solid Queue"
ğŸ“Œ Commit 25.2: Integrar WebhookJob en WebhookNotifier
ğŸ”¹ Mensaje de commit:
feat(webhooks): modifica WebhookNotifier para usar WebhookJob en procesamiento asÃ­ncrono
ğŸ”¹ Contenido del commit:
Modificar WebhookNotifier en app/services/webhook_notifier.rb
class WebhookNotifier
def self.call(event_name, payload)
WebhookSubscription.where(event_name: event_name, active: true).find_each do |subscription|
WebhookJob.perform_later(event_name, payload, subscription.url)
end
end
end
ğŸ”¹ AÃ±adir archivos al commit:
git add .
git commit -m "feat(webhooks): modifica WebhookNotifier para usar WebhookJob en procesamiento asÃ­ncrono"
ğŸ“Œ Commit 25.3: Configurar Solid Queue en config/application.rb
ğŸ”¹ Mensaje de commit:
feat(queue): configura Solid Queue como backend de Active Job
ğŸ”¹ Contenido del commit:
Modificar config/application.rb
Rails.application.configure do
config.active_job.queue_adapter = :solid_queue
end
ğŸ”¹ AÃ±adir archivos al commit:
git add .
git commit -m "feat(queue): configura Solid Queue como backend de Active Job"
ğŸ“ ExplicaciÃ³n y CÃ³digo Generado
Ejemplo de CreaciÃ³n de una SuscripciÃ³n de Webhook en Rails Console
WebhookSubscription.create!(event_name: "user.created", url: "https://example.com/webhook")
Ejemplo de EnvÃ­o de Webhook en Segundo Plano
WebhookNotifier.call("user.created", { id: 1, email: "test@example.com" })
Ejemplo de SimulaciÃ³n de RecepciÃ³n de Webhook
nc -l -p 8080
Luego, en Rails Console:
WebhookSubscription.create!(event_name: "user.created", url: "http://localhost:8080")
WebhookNotifier.call("user.created", { id: 1, email: "test@example.com" })
