# âœ… Paso 18: Implementar MÃ©tricas y Monitoreo con Grafana + Prometheus

Ahora configuraremos Grafana y Prometheus para monitoreo y visualizaciÃ³n de mÃ©tricas en tiempo real.
âœ… Prometheus â†’ Almacena mÃ©tricas de la aplicaciÃ³n y servidores.
âœ… Grafana â†’ Visualiza y genera dashboards de mÃ©tricas.
âœ… Exporters â†’ Para monitorear PostgreSQL, Redis, y la aplicaciÃ³n Rails.
ðŸ“Œ Commit 18.1: Configurar Prometheus en Docker Compose
ðŸ”¹ Mensaje de commit:
infra(monitoring): agrega configuraciÃ³n de Prometheus en Docker Compose
ðŸ”¹ Contenido del commit:
Definir docker-compose.override.yml para Prometheus
version: '3.8'
services:
prometheus:
image: prom/prometheus:latest
container_name: prometheus
volumes: - ./infra/prometheus/prometheus.yml:/etc/prometheus/prometheus.yml
ports: - "9090:9090"
Crear ConfiguraciÃ³n de Prometheus (infra/prometheus/prometheus.yml)
global:
scrape_interval: 15s
scrape_configs:
- job_name: "rails_app"
  static_configs:
  - targets: ["host.docker.internal:3000"]
ðŸ”¹ AÃ±adir archivos al commit:
git add .
git commit -m "infra(monitoring): agrega configuraciÃ³n de Prometheus en Docker Compose"
ðŸ“Œ Commit 18.2: Configurar Grafana en Docker Compose
ðŸ”¹ Mensaje de commit:
infra(monitoring): agrega configuraciÃ³n de Grafana en Docker Compose
ðŸ”¹ Contenido del commit:
Definir docker-compose.override.yml para Grafana
services:
grafana:
image: grafana/grafana:latest
container_name: grafana
ports: - "3001:3000"
environment: - GF_SECURITY_ADMIN_PASSWORD=admin
depends_on: - prometheus
ðŸ”¹ AÃ±adir archivos al commit:
git add .
git commit -m "infra(monitoring): agrega configuraciÃ³n de Grafana en Docker Compose"
ðŸ“Œ Commit 18.3: Configurar Exporter para MÃ©tricas de Rails
ðŸ”¹ Mensaje de commit:
feat(monitoring): agrega Exporter para monitoreo de mÃ©tricas de Rails con Prometheus
ðŸ”¹ Contenido del commit:
Instalar prometheus_exporter en el Gemfile
echo "gem 'prometheus_exporter', '~> 1.0'" >> Gemfile
bundle install
Configurar Exporter en config/initializers/prometheus.rb
require "prometheus_exporter/middleware"
require "prometheus_exporter/instrumentation"
Rails.application.middleware.use PrometheusExporter::Middleware
PrometheusExporter::Instrumentation::Process.start(type: "web")
ðŸ”¹ AÃ±adir archivos al commit:
git add .
git commit -m "feat(monitoring): agrega Exporter para monitoreo de mÃ©tricas de Rails con Prometheus"
ðŸ“Œ Commit 18.4: Agregar Endpoints de MÃ©tricas en Rails
ðŸ”¹ Mensaje de commit:
feat(monitoring): expone endpoint /metrics para Prometheus
ðŸ”¹ Contenido del commit:
Crear un controlador para mÃ©tricas en app/controllers/metrics_controller.rb
class MetricsController < ApplicationController
def index
render plain: PrometheusExporter::Metric::Base.default.registry.prometheus_metrics_text
end
end
Agregar ruta en config/routes.rb
Rails.application.routes.draw do
get "/metrics", to: "metrics#index"
end
ðŸ”¹ AÃ±adir archivos al commit:
git add .
git commit -m "feat(monitoring): expone endpoint /metrics para Prometheus"
ðŸ“ ExplicaciÃ³n y CÃ³digo Generado
CÃ³mo Acceder a las MÃ©tricas
    Prometheus UI: http://localhost:9090
    Grafana UI: http://localhost:3001
    Endpoint de mÃ©tricas de Rails: http://localhost:3000/metrics
Ejemplo de MÃ©trica en Prometheus
curl http://localhost:3000/metrics
Ejemplo de Query en Prometheus UI
rate(rails_requests_total[5m])
