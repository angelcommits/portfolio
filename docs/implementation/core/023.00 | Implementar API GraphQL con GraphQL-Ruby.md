# âœ… Paso 23: Implementar API GraphQL con GraphQL-Ruby

Ahora configuraremos GraphQL con GraphQL-Ruby para proporcionar una API flexible que permita a los clientes solicitar exactamente los datos que necesiten.
âœ… GraphQL-Ruby â†’ Biblioteca oficial de GraphQL para Rails.
âœ… Consultas optimizadas â†’ Permite seleccionar solo los campos necesarios.
âœ… Soporte para Mutations â†’ Permite crear, actualizar y eliminar datos.
âœ… Compatibilidad con JWT â†’ IntegraciÃ³n con autenticaciÃ³n.
ğŸ“Œ Commit 23.1: Instalar GraphQL-Ruby y Generar la ConfiguraciÃ³n Base
ğŸ”¹ Mensaje de commit:
feat(api): instala GraphQL-Ruby y genera configuraciÃ³n inicial
ğŸ”¹ Contenido del commit:
# AÃ±adir GraphQL-Ruby al Gemfile
echo "gem 'graphql', '~> 2.0'" >> Gemfile
# Instalar la gema
bundle install
# Generar la configuraciÃ³n de GraphQL
rails g graphql:install
ğŸ”¹ AÃ±adir archivos al commit:
git add .
git commit -m "feat(api): instala GraphQL-Ruby y genera configuraciÃ³n inicial"
ğŸ“Œ Commit 23.2: Definir el Esquema y los Tipos para User y Platform
ğŸ”¹ Mensaje de commit:
feat(api): agrega tipos GraphQL para User y Platform
ğŸ”¹ Contenido del commit:
Definir UserType en app/graphql/types/user_type.rb
module Types
class UserType < Types::BaseObject
field :id, ID, null: false
field :name, String, null: false
field :email, String, null: false
field :platforms, [Types::PlatformType], null: true
end
end
Definir PlatformType en app/graphql/types/platform_type.rb
module Types
class PlatformType < Types::BaseObject
field :id, ID, null: false
field :name, String, null: false
field :code, String, null: false
field :owner, Types::UserType, null: false
end
end
Modificar QueryType para Incluir Consultas de User y Platform
module Types
class QueryType < Types::BaseObject
field :users, [UserType], null: false
field :platforms, [PlatformType], null: false
    def users
      Company::Business::User.all
    end
    def platforms
      Company::Business::Platform.all
    end
end
end
ğŸ”¹ AÃ±adir archivos al commit:
git add .
git commit -m "feat(api): agrega tipos GraphQL para User y Platform"
ğŸ“Œ Commit 23.3: Agregar Mutations para Crear Usuarios y Plataformas
ğŸ”¹ Mensaje de commit:
feat(api): agrega mutations para crear Users y Platforms
ğŸ”¹ Contenido del commit:
Definir CreateUser Mutation en app/graphql/mutations/create_user.rb
module Mutations
class CreateUser < Mutations::BaseMutation
argument :name, String, required: true
argument :email, String, required: true
    type Types::UserType
    def resolve(name:, email:)
      Company::Business::User.create!(name: name, email: email)
    end
end
end
Definir CreatePlatform Mutation en app/graphql/mutations/create_platform.rb
module Mutations
class CreatePlatform < Mutations::BaseMutation
argument :name, String, required: true
argument :code, String, required: true
argument :owner_id, ID, required: true
    type Types::PlatformType
    def resolve(name:, code:, owner_id:)
      owner = Company::Business::User.find(owner_id)
      Company::Business::Platform.create!(name: name, code: code, owner: owner)
    end
end
end
Agregar Mutations al MutationType en app/graphql/types/mutation_type.rb
module Types
class MutationType < Types::BaseObject
field :create_user, mutation: Mutations::CreateUser
field :create_platform, mutation: Mutations::CreatePlatform
end
end
ğŸ”¹ AÃ±adir archivos al commit:
git add .
git commit -m "feat(api): agrega mutations para crear Users y Platforms"
ğŸ“Œ Commit 23.4: Agregar Soporte para JWT en GraphQL
ğŸ”¹ Mensaje de commit:
feat(api): integra autenticaciÃ³n JWT en GraphQL
ğŸ”¹ Contenido del commit:
Modificar GraphqlController para Verificar JWT
class GraphqlController < ApplicationController
before_action :authenticate_user
def execute
variables = ensure_hash(params[:variables])
query = params[:query]
operation_name = params[:operationName]
context = { current_user: @current_user }
    result = CompanyAppSchema.execute(query, variables: variables, context: context, operation_name: operation_name)
    render json: result
end
private
def authenticate_user
token = request.headers["Authorization"]&.split(" ")&.last
decoded = JsonWebToken.decode(token)
@current_user = Company::Business::User.find_by(id: decoded["user_id"]) if decoded
end
end
ğŸ”¹ AÃ±adir archivos al commit:
git add .
git commit -m "feat(api): integra autenticaciÃ³n JWT en GraphQL"
ğŸ“ ExplicaciÃ³n y CÃ³digo Generado
Ejemplo de Consulta GraphQL para Obtener Usuarios
query {
users {
id
name
email
}
}
Ejemplo de Mutation para Crear un Usuario
mutation {
createUser(name: "Nuevo Usuario", email: "nuevo@example.com") {
id
name
email
}
}
Ejemplo de PeticiÃ³n a GraphQL con AutenticaciÃ³n
curl -X POST "http://localhost:3000/graphql" \
 -H "Authorization: Bearer <TOKEN>" \
 -H "Content-Type: application/json" \
 -d '{ "query": "{ users { id name email } }" }'
