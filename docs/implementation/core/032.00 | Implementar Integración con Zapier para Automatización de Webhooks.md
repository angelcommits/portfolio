# âœ… Paso 32: Implementar IntegraciÃ³n con Zapier para AutomatizaciÃ³n de Webhooks

Ahora configuraremos Zapier como una integraciÃ³n nativa para conectar los Webhooks con herramientas externas como Slack, Google Sheets, Notion, Trello y mÃ¡s, sin necesidad de escribir cÃ³digo adicional.
âœ… Zapier Webhooks â†’ Permite conectar eventos de nuestra aplicaciÃ³n con cientos de servicios.
âœ… ConfiguraciÃ³n sencilla â†’ No requiere cambios en el cÃ³digo de los clientes.
âœ… Manejo de errores y reintentos â†’ Zapier gestiona automÃ¡ticamente los fallos de entrega.
ğŸ“Œ Commit 32.1: Agregar ConfiguraciÃ³n de Webhooks para Zapier
ğŸ”¹ Mensaje de commit:
feat(integration): agrega configuraciÃ³n de Webhooks para integraciÃ³n con Zapier
ğŸ”¹ Contenido del commit:
Modificar WebhookSubscription para Soporte de Zapier
class WebhookSubscription < ApplicationRecord
validates :event_name, :url, presence: true
before_create :mark_as_zapier_if_needed
private
def mark_as_zapier_if_needed
self.zapier = url.include?("hooks.zapier.com")
end
end
ğŸ”¹ AÃ±adir archivos al commit:
git add .
git commit -m "feat(integration): agrega configuraciÃ³n de Webhooks para integraciÃ³n con Zapier"
ğŸ“Œ Commit 32.2: Exponer Endpoint en Zapier para Suscribir Webhooks
ğŸ”¹ Mensaje de commit:
feat(integration): expone endpoint en la API para suscribir Webhooks con Zapier
ğŸ”¹ Contenido del commit:
Definir ZapierWebhooksController en app/controllers/zapier_webhooks_controller.rb
class ZapierWebhooksController < ApplicationController
def create
subscription = WebhookSubscription.create!(
event_name: params[:event_name],
url: params[:url],
active: true
)
render json: { message: "Zapier Webhook registrado", id: subscription.id }, status: :created
end
end
Agregar Ruta en config/routes.rb
Rails.application.routes.draw do
post "/zapier/webhooks", to: "zapier_webhooks#create"
end
ğŸ”¹ AÃ±adir archivos al commit:
git add .
git commit -m "feat(integration): expone endpoint en la API para suscribir Webhooks con Zapier"
ğŸ“Œ Commit 32.3: Modificar WebhookNotifier para Enviar Eventos a Zapier
ğŸ”¹ Mensaje de commit:
feat(integration): agrega compatibilidad con Zapier en WebhookNotifier
ğŸ”¹ Contenido del commit:
Modificar WebhookNotifier en app/services/webhook_notifier.rb
class WebhookNotifier
SECRET_KEY = Rails.application.credentials.dig(:webhooks, :secret) || "default_secret"
def self.call(event_name, payload)
WebhookSubscription.where(event_name: event_name, active: true).find_each do |subscription|
if subscription.zapier?
send_to_zapier(subscription.url, payload)
else
signature = generate_signature(payload)
WebhookJob.perform_later(event_name, payload, subscription.url, signature)
end
end
    # TambiÃ©n transmitir por WebSockets y GraphQL Subscriptions
    ActionCable.server.broadcast("webhooks", { event: event_name, payload: payload })
    CompanyAppSchema.subscriptions.trigger("webhook_event", { event_name: event_name }, { event_name: event_name, payload: payload })
end
private
def self.send_to_zapier(url, payload)
uri = URI.parse(url)
http = Net::HTTP.new(uri.host, uri.port)
http.use_ssl = uri.scheme == "https"
    request = Net::HTTP::Post.new(uri.path, { "Content-Type" => "application/json" })
    request.body = payload.to_json
    http.request(request)
end
def self.generate_signature(payload)
digest = OpenSSL::Digest.new("sha256")
hmac = OpenSSL::HMAC.digest(digest, SECRET_KEY, payload.to_json)
Base64.strict_encode64(hmac)
end
end
ğŸ”¹ AÃ±adir archivos al commit:
git add .
git commit -m "feat(integration): agrega compatibilidad con Zapier en WebhookNotifier"
ğŸ“Œ Commit 32.4: Agregar DocumentaciÃ³n para IntegraciÃ³n con Zapier
ğŸ”¹ Mensaje de commit:
docs(integration): agrega documentaciÃ³n para conectar Webhooks con Zapier
ğŸ”¹ Contenido del commit:
Crear docs/integracion_zapier.md
# IntegraciÃ³n con Zapier
## 1ï¸âƒ£ Crear un Trigger en Zapier
- Ir a [Zapier Webhooks](https://zapier.com/app/editor/)
- Seleccionar **Webhook â†’ Catch Hook**
- Copiar la URL generada
## 2ï¸âƒ£ Registrar Webhook en Rails
Ejecutar el siguiente comando en la API para suscribirse:
````sh
curl -X POST "http://localhost:3000/zapier/webhooks" \
  -H "Content-Type: application/json" \
  -d '{ "event_name": "user.created", "url": "https://hooks.zapier.com/hooks/catch/123456/" }'
3ï¸âƒ£ Probar Evento
Ejecutar en Rails Console:
WebhookNotifier.call("user.created", { id: 1, email: "user@example.com" })
El evento aparecerÃ¡ en Zapier y podrÃ¡ conectarse con Google Sheets, Slack u otros servicios.
ğŸ”¹ **AÃ±adir archivos al commit:**
```sh
git add .
git commit -m "docs(integration): agrega documentaciÃ³n para conectar Webhooks con Zapier"
ğŸ“ ExplicaciÃ³n y CÃ³digo Generado
Ejemplo de Registro de Webhook en Zapier
curl -X POST "http://localhost:3000/zapier/webhooks" \
  -H "Content-Type: application/json" \
  -d '{ "event_name": "order.completed", "url": "https://hooks.zapier.com/hooks/catch/123456/" }'
Ejemplo de Disparo de Evento Webhook a Zapier
WebhookNotifier.call("order.completed", { order_id: 123, status: "completed" })
Ejemplo de Zapier Enviando Evento a Google Sheets
    Crear Zap en Zapier
    Trigger: Webhook â†’ Catch Hook
    Action: Google Sheets â†’ Add Row
    Ejecutar Webhook desde Rails Console
WebhookNotifier.call("user.created", { id: 10, email: "user@example.com" })
    Se agrega automÃ¡ticamente un nuevo usuario en Google Sheets ğŸš€
