# ✅ Paso 8: Configurar Caché con Solid Cache + Fragment Caching + HTTP Cache

Ahora configuraremos Solid Cache como el sistema de caché principal, combinado con Fragment Caching y HTTP Cache para mejorar el rendimiento.
✅ Solid Cache → Caché basado en Active Record, sin necesidad de Redis.
✅ Fragment Caching → Para optimizar la renderización de vistas.
✅ Russian Doll Caching → Para mejorar eficiencia en componentes anidados.
✅ HTTP Cache (ETag, Last-Modified) → Para reducir carga en la API y mejorar tiempos de respuesta.
📌 Commit 8.1: Instalar Solid Cache y configurar Rails Cache Store
🔹 Mensaje de commit:
feat(cache): instala Solid Cache y configura Rails Cache Store con Active Record
🔹 Contenido del commit:
# Generar migraciones para Solid Cache
rails solid_cache:install:migrations
# Ejecutar migraciones
rails db:migrate
# Configurar Rails para usar Solid Cache
echo "
Rails.application.config.cache_store = :solid_cache_store
" >> config/application.rb
# Añadir archivos al commit
git add .
git commit -m "feat(cache): instala Solid Cache y configura Rails Cache Store con Active Record"
📌 Commit 8.2: Implementar Fragment Caching y Russian Doll Caching
🔹 Mensaje de commit:
feat(cache): agrega Fragment Caching y Russian Doll Caching en vistas
🔹 Contenido del commit:
Ejemplo en una vista (app/views/platforms/show.html.erb):
<% cache @platform do %>
  <h1><%= @platform.name %></h1>
  <% cache @platform.users do %>
    <ul>
      <% @platform.users.each do |user| %>
        <% cache user do %>
          <li><%= user.name %></li>
        <% end %>
      <% end %>
    </ul>
  <% end %>
<% end %>
🔹 Añadir archivos al commit:
git add .
git commit -m "feat(cache): agrega Fragment Caching y Russian Doll Caching en vistas"
📌 Commit 8.3: Implementar HTTP Cache (ETag y Last-Modified)
🔹 Mensaje de commit:
feat(cache): agrega soporte para HTTP Cache con ETag y Last-Modified en API
🔹 Contenido del commit:
# app/controllers/platforms_controller.rb
class PlatformsController < ApplicationController
before_action :set_platform, only: [:show]
def show
fresh_when(@platform) # Rails usa ETag y Last-Modified automáticamente
end
private
def set_platform
@platform = Company::Business::Platform.find(params[:id])
end
end
🔹 Añadir archivos al commit:
git add .
git commit -m "feat(cache): agrega soporte para HTTP Cache con ETag y Last-Modified en API"
📝 Explicación y Código Generado
Ejemplo de Uso en Rails Console
# Guardar datos en caché
Rails.cache.write("platform\_#{platform.id}", platform)
# Leer datos desde caché
Rails.cache.read("platform\_#{platform.id}")
# Limpiar caché
Rails.cache.delete("platform\_#{platform.id}")
Beneficio de HTTP Cache
Cuando un cliente HTTP (navegador o API) hace una solicitud, Rails responde con un ETag o Last-Modified.
Si el contenido no ha cambiado, el servidor devuelve 304 Not Modified, evitando transferir datos innecesarios.
