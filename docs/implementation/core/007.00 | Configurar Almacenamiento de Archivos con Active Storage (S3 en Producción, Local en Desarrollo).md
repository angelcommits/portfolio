# ✅ Paso 7: Configurar Almacenamiento de Archivos con Active Storage (S3 en Producción, Local en Desarrollo)

Ahora configuraremos Active Storage para manejar archivos, utilizando S3 en producción y almacenamiento local en desarrollo/test.
✅ Active Storage → Manejo de archivos integrado en Rails.
✅ S3 en Producción → Para escalabilidad y seguridad.
✅ Almacenamiento Local en Desarrollo/Test → Para facilitar el desarrollo sin dependencias externas.
✅ Compatibilidad con múltiples servicios → Podremos cambiar el backend de almacenamiento según el entorno.
📌 Commit 7.1: Instalar Active Storage y generar las migraciones
🔹 Mensaje de commit:
feat(storage): instala Active Storage y configura S3 en producción
🔹 Contenido del commit:
# Instalar Active Storage (esto genera migraciones)
rails active_storage:install
# Ejecutar migraciones
rails db:migrate
# Añadir archivos al commit
git add .
git commit -m "feat(storage): instala Active Storage y configura S3 en producción"
📌 Commit 7.2: Configurar almacenamiento en config/storage.yml
🔹 Mensaje de commit:
feat(storage): configura Active Storage con S3 en producción y local en desarrollo/test
🔹 Contenido del commit:
# config/storage.yml
local:
service: Disk
root: <%= Rails.root.join("storage") %>
test:
service: Disk
root: <%= Rails.root.join("tmp/storage") %>
amazon:
service: S3
access_key_id: <%= ENV["AWS_ACCESS_KEY_ID"] %>
secret_access_key: <%= ENV["AWS_SECRET_ACCESS_KEY"] %>
region: <%= ENV["AWS_REGION"] %>
bucket: <%= ENV["AWS_BUCKET"] %>
# config/environments/development.rb
config.active_storage.service = :local
# config/environments/test.rb
config.active_storage.service = :test
# config/environments/production.rb
config.active_storage.service = :amazon
🔹 Añadir archivos al commit:
git add .
git commit -m "feat(storage): configura Active Storage con S3 en producción y local en desarrollo/test"
📝 Explicación y Código Generado
Ejemplo de Uso en Rails Console
# Subir una imagen a Active Storage
user.avatar.attach(io: File.open("path/to/image.jpg"), filename: "avatar.jpg", content_type: "image/jpeg")
# Verificar si el usuario tiene un avatar
user.avatar.attached? # => true
# Obtener la URL de la imagen
Rails.application.routes.url_helpers.rails_blob_url(user.avatar, only_path: true)
