# âœ… Paso 7: Configurar Almacenamiento de Archivos con Active Storage (S3 en ProducciÃ³n, Local en Desarrollo)

Ahora configuraremos Active Storage para manejar archivos, utilizando S3 en producciÃ³n y almacenamiento local en desarrollo/test.
âœ… Active Storage â†’ Manejo de archivos integrado en Rails.
âœ… S3 en ProducciÃ³n â†’ Para escalabilidad y seguridad.
âœ… Almacenamiento Local en Desarrollo/Test â†’ Para facilitar el desarrollo sin dependencias externas.
âœ… Compatibilidad con mÃºltiples servicios â†’ Podremos cambiar el backend de almacenamiento segÃºn el entorno.
ğŸ“Œ Commit 7.1: Instalar Active Storage y generar las migraciones
ğŸ”¹ Mensaje de commit:
feat(storage): instala Active Storage y configura S3 en producciÃ³n
ğŸ”¹ Contenido del commit:
# Instalar Active Storage (esto genera migraciones)
rails active_storage:install
# Ejecutar migraciones
rails db:migrate
# AÃ±adir archivos al commit
git add .
git commit -m "feat(storage): instala Active Storage y configura S3 en producciÃ³n"
ğŸ“Œ Commit 7.2: Configurar almacenamiento en config/storage.yml
ğŸ”¹ Mensaje de commit:
feat(storage): configura Active Storage con S3 en producciÃ³n y local en desarrollo/test
ğŸ”¹ Contenido del commit:
# config/storage.yml
local:
service: Disk
root: <%= Rails.root.join("storage") %>
test:
service: Disk
root: <%= Rails.root.join("tmp/storage") %>
amazon:
service: S3
access_key_id: <%= ENV["AWS_ACCESS_KEY_ID"] %>
secret_access_key: <%= ENV["AWS_SECRET_ACCESS_KEY"] %>
region: <%= ENV["AWS_REGION"] %>
bucket: <%= ENV["AWS_BUCKET"] %>
# config/environments/development.rb
config.active_storage.service = :local
# config/environments/test.rb
config.active_storage.service = :test
# config/environments/production.rb
config.active_storage.service = :amazon
ğŸ”¹ AÃ±adir archivos al commit:
git add .
git commit -m "feat(storage): configura Active Storage con S3 en producciÃ³n y local en desarrollo/test"
ğŸ“ ExplicaciÃ³n y CÃ³digo Generado
Ejemplo de Uso en Rails Console
# Subir una imagen a Active Storage
user.avatar.attach(io: File.open("path/to/image.jpg"), filename: "avatar.jpg", content_type: "image/jpeg")
# Verificar si el usuario tiene un avatar
user.avatar.attached? # => true
# Obtener la URL de la imagen
Rails.application.routes.url_helpers.rails_blob_url(user.avatar, only_path: true)
