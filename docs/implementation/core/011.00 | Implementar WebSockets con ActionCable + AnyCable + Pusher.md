# âœ… Paso 11: Implementar WebSockets con ActionCable + AnyCable + Pusher

Ahora agregaremos WebSockets combinando ActionCable, AnyCable y Pusher para manejar notificaciones en tiempo real.
âœ… ActionCable â†’ Soporte nativo de Rails para WebSockets.
âœ… AnyCable â†’ Mejora el rendimiento en producciÃ³n con WebSockets y gRPC.
âœ… Pusher â†’ Alternativa en caso de clientes que no soporten WebSockets o para escalabilidad.
ðŸ“Œ Commit 11.1: Configurar ActionCable en Rails
ðŸ”¹ Mensaje de commit:
feat(websockets): configura ActionCable para notificaciones en tiempo real
ðŸ”¹ Contenido del commit:
# Configurar Redis para manejar conexiones de WebSockets en desarrollo
echo "gem 'redis', '~> 4.8'" >> Gemfile
# Instalar la gema
bundle install
# Configurar ActionCable en `config/cable.yml`
echo "
development:
adapter: redis
url: redis://localhost:6379/1
production:
adapter: any_cable
" > config/cable.yml
# AÃ±adir archivos al commit
git add .
git commit -m "feat(websockets): configura ActionCable para notificaciones en tiempo real"
ðŸ“Œ Commit 11.2: Integrar AnyCable para optimizaciÃ³n de WebSockets
ðŸ”¹ Mensaje de commit:
feat(websockets): agrega AnyCable para mejorar el rendimiento de WebSockets en producciÃ³n
ðŸ”¹ Contenido del commit:
# AÃ±adir la gema AnyCable
echo "gem 'anycable-rails', '~> 1.4'" >> Gemfile
# Instalar la gema
bundle install
# Generar la configuraciÃ³n de AnyCable
rails g anycable:setup
# Configurar AnyCable en `config/anycable.yml`
echo "
production:
rpc_host: redis://localhost:6379/2
redis_channel: '**anycable**'
" >> config/anycable.yml
# AÃ±adir archivos al commit
git add .
git commit -m "feat(websockets): agrega AnyCable para mejorar el rendimiento de WebSockets en producciÃ³n"
ðŸ“Œ Commit 11.3: Configurar Pusher como fallback para WebSockets
ðŸ”¹ Mensaje de commit:
feat(websockets): integra Pusher como alternativa a WebSockets
ðŸ”¹ Contenido del commit:
# AÃ±adir la gema Pusher
echo "gem 'pusher', '~> 3.0'" >> Gemfile
# Instalar la gema
bundle install
# Configurar Pusher en `config/initializers/pusher.rb`
echo "
require 'pusher'
Pusher.app_id = ENV['PUSHER_APP_ID']
Pusher.key = ENV['PUSHER_KEY']
Pusher.secret = ENV['PUSHER_SECRET']
Pusher.cluster = ENV['PUSHER_CLUSTER']
Pusher.logger = Rails.logger
Pusher.encrypted = true
" >> config/initializers/pusher.rb
# AÃ±adir archivos al commit
git add .
git commit -m "feat(websockets): integra Pusher como alternativa a WebSockets"
ðŸ“Œ Commit 11.4: Crear un Canal de Notificaciones en ActionCable
ðŸ”¹ Mensaje de commit:
feat(websockets): agrega un canal de notificaciones en ActionCable
ðŸ”¹ Contenido del commit:
Definir un Canal de Notificaciones (app/channels/notification_channel.rb)
class NotificationChannel < ApplicationCable::Channel
def subscribed
stream*from "notifications*#{params[:user_id]}"
end
end
Broadcast de una NotificaciÃ³n en Rails Console
ActionCable.server.broadcast("notifications\_#{user.id}", { message: "Tienes una nueva notificaciÃ³n" })
ðŸ”¹ AÃ±adir archivos al commit:
git add .
git commit -m "feat(websockets): agrega un canal de notificaciones en ActionCable"
ðŸ“ ExplicaciÃ³n y CÃ³digo Generado
Ejemplo de SuscripciÃ³n en JavaScript (app/javascript/channels/notification_channel.js)
import consumer from "./consumer"
consumer.subscriptions.create({ channel: "NotificationChannel", user_id: CURRENT_USER_ID }, {
received(data) {
alert(data.message);
}
});
Ejemplo de Uso en Rails Console
# Enviar una notificaciÃ³n en tiempo real
ActionCable.server.broadcast("notifications\_#{user.id}", { message: "Tienes una nueva tarea pendiente" })
Alternativa con Pusher
Pusher.trigger("notifications\_#{user.id}", "new_notification", { message: "Nuevo mensaje" })
