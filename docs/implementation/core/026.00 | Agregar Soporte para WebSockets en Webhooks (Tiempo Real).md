# âœ… Paso 26: Agregar Soporte para WebSockets en Webhooks (Tiempo Real)

Ahora configuraremos WebSockets en Webhooks para permitir que los clientes escuchen eventos en tiempo real sin necesidad de realizar peticiones repetitivas (polling).
âœ… ActionCable â†’ Permite manejar WebSockets de forma nativa en Rails.
âœ… Webhook Streaming â†’ Enviar eventos en vivo a los clientes conectados.
âœ… Persistencia de eventos â†’ Registrar eventos en la base de datos para consulta histÃ³rica.
ðŸ“Œ Commit 26.1: Crear Canal WebhookChannel para Transmitir Eventos en Tiempo Real
ðŸ”¹ Mensaje de commit:
feat(webhooks): agrega WebSocket WebhookChannel para transmitir eventos en tiempo real
ðŸ”¹ Contenido del commit:
Definir WebhookChannel en app/channels/webhook_channel.rb
class WebhookChannel < ApplicationCable::Channel
def subscribed
stream_from "webhooks"
end
end
ðŸ”¹ AÃ±adir archivos al commit:
git add .
git commit -m "feat(webhooks): agrega WebSocket WebhookChannel para transmitir eventos en tiempo real"
ðŸ“Œ Commit 26.2: Modificar WebhookNotifier para Transmitir VÃ­a WebSockets
ðŸ”¹ Mensaje de commit:
feat(webhooks): agrega transmisiÃ³n WebSocket en WebhookNotifier
ðŸ”¹ Contenido del commit:
Modificar WebhookNotifier en app/services/webhook_notifier.rb
class WebhookNotifier
def self.call(event_name, payload)
WebhookSubscription.where(event_name: event_name, active: true).find_each do |subscription|
WebhookJob.perform_later(event_name, payload, subscription.url)
end
    # Transmitir el evento en WebSocket
    ActionCable.server.broadcast("webhooks", { event: event_name, payload: payload })
end
end
ðŸ”¹ AÃ±adir archivos al commit:
git add .
git commit -m "feat(webhooks): agrega transmisiÃ³n WebSocket en WebhookNotifier"
ðŸ“Œ Commit 26.3: Agregar Frontend para Escuchar WebSockets en Webhooks
ðŸ”¹ Mensaje de commit:
feat(webhooks): agrega frontend para recibir eventos en vivo desde WebSockets
ðŸ”¹ Contenido del commit:
Modificar app/javascript/channels/webhook_channel.js
import consumer from "./consumer"
consumer.subscriptions.create("WebhookChannel", {
received(data) {
console.log("Evento recibido:", data);
alert(`Nuevo evento: ${data.event}`);
}
});
ðŸ”¹ AÃ±adir archivos al commit:
git add .
git commit -m "feat(webhooks): agrega frontend para recibir eventos en vivo desde WebSockets"
ðŸ“ ExplicaciÃ³n y CÃ³digo Generado
Ejemplo de SuscripciÃ³n a Webhooks en WebSockets (JavaScript)
const socket = new WebSocket("ws://localhost:3000/cable");
socket.onopen = function() {
console.log("Conectado a WebSocket");
socket.send(JSON.stringify({ command: "subscribe", identifier: JSON.stringify({ channel: "WebhookChannel" }) }));
};
socket.onmessage = function(event) {
console.log("Evento WebSocket recibido:", event.data);
};
Ejemplo de SimulaciÃ³n de EnvÃ­o de Webhook en Rails Console
WebhookNotifier.call("order.completed", { order_id: 123, status: "completed" })
Ejemplo de RecepciÃ³n de Webhook en el Cliente
    Se mostrarÃ¡ en la consola del navegador:
    Evento recibido: { event: "order.completed", payload: { order_id: 123, status: "completed" } }
