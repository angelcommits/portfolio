# ✅ Paso 17: Integrar Pulumi en CI/CD para Aprovisionamiento Automático

Ahora configuraremos Pulumi en CI/CD para automatizar la creación y actualización de infraestructura en la nube.
✅ Pulumi + GitHub Actions → Para despliegue en repositorios GitHub.
✅ Pulumi + GitLab CI/CD → Para proyectos en GitLab.
✅ Pulumi + Jenkins → Para servidores on-premise o entornos personalizados.
✅ Soporte para múltiples entornos → Desarrollo, staging y producción.
📌 Commit 17.1: Agregar Pulumi a GitHub Actions
🔹 Mensaje de commit:
ci(pulumi): agrega Pulumi a GitHub Actions para aprovisionamiento automático
🔹 Contenido del commit:
Definir workflow de Pulumi en .github/workflows/pulumi.yml
name: Pulumi Deploy
on:
push:
branches: - main
jobs:
deploy:
runs-on: ubuntu-latest
    steps:
      - name: Checkout código
        uses: actions/checkout@v3
      - name: Instalar Pulumi
        uses: pulumi/actions@v4
        with:
          pulumi-version: "latest"
      - name: Autenticarse en AWS
        run: |
          echo "[default]" > ~/.aws/credentials
          echo "aws_access_key_id=${{ secrets.AWS_ACCESS_KEY_ID }}" >> ~/.aws/credentials
          echo "aws_secret_access_key=${{ secrets.AWS_SECRET_ACCESS_KEY }}" >> ~/.aws/credentials
      - name: Configurar Pulumi
        run: pulumi stack select dev || pulumi stack init dev
      - name: Desplegar Infraestructura
        run: pulumi up --yes
🔹 Añadir archivos al commit:
git add .
git commit -m "ci(pulumi): agrega Pulumi a GitHub Actions para aprovisionamiento automático"
📌 Commit 17.2: Agregar Pulumi a GitLab CI/CD
🔹 Mensaje de commit:
ci(pulumi): agrega Pulumi a GitLab CI/CD para aprovisionamiento en AWS
🔹 Contenido del commit:
Definir pulumi en .gitlab-ci.yml
stages:
- infra
pulumi-deploy:
image: pulumi/pulumi
stage: infra
script: - pulumi stack select dev || pulumi stack init dev - pulumi up --yes
only: - main
🔹 Añadir archivos al commit:
git add .
git commit -m "ci(pulumi): agrega Pulumi a GitLab CI/CD para aprovisionamiento en AWS"
📌 Commit 17.3: Agregar Pulumi a Jenkins
🔹 Mensaje de commit:
ci(pulumi): agrega Pulumi a Jenkins para aprovisionamiento en servidores propios
🔹 Contenido del commit:
Modificar Jenkinsfile para Pulumi
pipeline {
agent any
    stages {
        stage('Pulumi Deploy') {
            steps {
                sh 'pulumi stack select dev || pulumi stack init dev'
                sh 'pulumi up --yes'
            }
        }
    }
}
🔹 Añadir archivos al commit:
git add .
git commit -m "ci(pulumi): agrega Pulumi a Jenkins para aprovisionamiento en servidores propios"
📝 Explicación y Código Generado
¿Qué hará cada CI/CD?
    GitHub Actions: Aprovisionará infraestructura en AWS cuando haya cambios en main.
    GitLab CI/CD: Desplegará infraestructura cuando se haga merge en main.
    Jenkins: Permitirá aprovisionar servidores en entornos on-premise.
Ejemplo de Despliegue Manual con Pulumi
cd infra/pulumi
pulumi up --yes
Ejemplo de Rollback con Pulumi
pulumi destroy --yes
