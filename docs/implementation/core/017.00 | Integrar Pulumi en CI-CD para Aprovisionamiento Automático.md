# âœ… Paso 17: Integrar Pulumi en CI/CD para Aprovisionamiento AutomÃ¡tico

Ahora configuraremos Pulumi en CI/CD para automatizar la creaciÃ³n y actualizaciÃ³n de infraestructura en la nube.
âœ… Pulumi + GitHub Actions â†’ Para despliegue en repositorios GitHub.
âœ… Pulumi + GitLab CI/CD â†’ Para proyectos en GitLab.
âœ… Pulumi + Jenkins â†’ Para servidores on-premise o entornos personalizados.
âœ… Soporte para mÃºltiples entornos â†’ Desarrollo, staging y producciÃ³n.
ğŸ“Œ Commit 17.1: Agregar Pulumi a GitHub Actions
ğŸ”¹ Mensaje de commit:
ci(pulumi): agrega Pulumi a GitHub Actions para aprovisionamiento automÃ¡tico
ğŸ”¹ Contenido del commit:
Definir workflow de Pulumi en .github/workflows/pulumi.yml
name: Pulumi Deploy
on:
push:
branches: - main
jobs:
deploy:
runs-on: ubuntu-latest
    steps:
      - name: Checkout cÃ³digo
        uses: actions/checkout@v3
      - name: Instalar Pulumi
        uses: pulumi/actions@v4
        with:
          pulumi-version: "latest"
      - name: Autenticarse en AWS
        run: |
          echo "[default]" > ~/.aws/credentials
          echo "aws_access_key_id=${{ secrets.AWS_ACCESS_KEY_ID }}" >> ~/.aws/credentials
          echo "aws_secret_access_key=${{ secrets.AWS_SECRET_ACCESS_KEY }}" >> ~/.aws/credentials
      - name: Configurar Pulumi
        run: pulumi stack select dev || pulumi stack init dev
      - name: Desplegar Infraestructura
        run: pulumi up --yes
ğŸ”¹ AÃ±adir archivos al commit:
git add .
git commit -m "ci(pulumi): agrega Pulumi a GitHub Actions para aprovisionamiento automÃ¡tico"
ğŸ“Œ Commit 17.2: Agregar Pulumi a GitLab CI/CD
ğŸ”¹ Mensaje de commit:
ci(pulumi): agrega Pulumi a GitLab CI/CD para aprovisionamiento en AWS
ğŸ”¹ Contenido del commit:
Definir pulumi en .gitlab-ci.yml
stages:
- infra
pulumi-deploy:
image: pulumi/pulumi
stage: infra
script: - pulumi stack select dev || pulumi stack init dev - pulumi up --yes
only: - main
ğŸ”¹ AÃ±adir archivos al commit:
git add .
git commit -m "ci(pulumi): agrega Pulumi a GitLab CI/CD para aprovisionamiento en AWS"
ğŸ“Œ Commit 17.3: Agregar Pulumi a Jenkins
ğŸ”¹ Mensaje de commit:
ci(pulumi): agrega Pulumi a Jenkins para aprovisionamiento en servidores propios
ğŸ”¹ Contenido del commit:
Modificar Jenkinsfile para Pulumi
pipeline {
agent any
    stages {
        stage('Pulumi Deploy') {
            steps {
                sh 'pulumi stack select dev || pulumi stack init dev'
                sh 'pulumi up --yes'
            }
        }
    }
}
ğŸ”¹ AÃ±adir archivos al commit:
git add .
git commit -m "ci(pulumi): agrega Pulumi a Jenkins para aprovisionamiento en servidores propios"
ğŸ“ ExplicaciÃ³n y CÃ³digo Generado
Â¿QuÃ© harÃ¡ cada CI/CD?
    GitHub Actions: AprovisionarÃ¡ infraestructura en AWS cuando haya cambios en main.
    GitLab CI/CD: DesplegarÃ¡ infraestructura cuando se haga merge en main.
    Jenkins: PermitirÃ¡ aprovisionar servidores en entornos on-premise.
Ejemplo de Despliegue Manual con Pulumi
cd infra/pulumi
pulumi up --yes
Ejemplo de Rollback con Pulumi
pulumi destroy --yes
