# ✅ Paso 9: Implementar Elasticsearch + Searchkick para Búsqueda Full-Text

Ahora configuraremos Elasticsearch con Searchkick, lo que nos permitirá realizar búsquedas avanzadas en la aplicación.
✅ Elasticsearch → Motor de búsqueda altamente eficiente.
✅ Searchkick → Wrapper de Elasticsearch para Rails, facilita la indexación y búsqueda.
✅ Autoindexación → Los registros se indexan automáticamente al crearse o actualizarse.
✅ Soporte para filtros, facetas y ranking basado en relevancia.
📌 Commit 9.1: Instalar Elasticsearch y Searchkick
🔹 Mensaje de commit:
feat(search): instala Elasticsearch y configura Searchkick para búsqueda full-text
🔹 Contenido del commit:
# Añadir la gema Searchkick al Gemfile
echo "gem 'searchkick', '~> 5.0'" >> Gemfile
# Instalar la gema
bundle install
# Verificar que Elasticsearch está corriendo (si no, iniciarlo)
curl -X GET "localhost:9200"
# Añadir archivos al commit
git add .
git commit -m "feat(search): instala Elasticsearch y configura Searchkick para búsqueda full-text"
📌 Commit 9.2: Habilitar Indexación en Modelos (User, Platform)
🔹 Mensaje de commit:
feat(search): agrega búsqueda en modelos User y Platform con Searchkick
🔹 Contenido del commit:
Modificar el Modelo User
# app/models/company/business/user.rb
module Company
module Business
class User < ApplicationRecord
searchkick text_middle: [:name, :email]
      def search_data
        {
          name: name,
          email: email
        }
      end
    end
end
end
Modificar el Modelo Platform
# app/models/company/business/platform.rb
module Company
module Business
class Platform < ApplicationRecord
searchkick text_middle: [:name, :code]
      def search_data
        {
          name: name,
          code: code
        }
      end
    end
end
end
🔹 Añadir archivos al commit:
git add .
git commit -m "feat(search): agrega búsqueda en modelos User y Platform con Searchkick"
📌 Commit 9.3: Implementar Búsqueda en Controladores
🔹 Mensaje de commit:
feat(search): agrega endpoints de búsqueda en UsersController y PlatformsController
🔹 Contenido del commit:
Modificar UsersController para permitir búsqueda
# app/controllers/users_controller.rb
class UsersController < ApplicationController
def index
if params[:query].present?
@users = Company::Business::User.search(params[:query])
else
@users = Company::Business::User.all
end
render json: @users
end
end
Modificar PlatformsController para permitir búsqueda
# app/controllers/platforms_controller.rb
class PlatformsController < ApplicationController
def index
if params[:query].present?
@platforms = Company::Business::Platform.search(params[:query])
else
@platforms = Company::Business::Platform.all
end
render json: @platforms
end
end
🔹 Añadir archivos al commit:
git add .
git commit -m "feat(search): agrega endpoints de búsqueda en UsersController y PlatformsController"
📝 Explicación y Código Generado
Ejemplo de Uso en Rails Console
# Indexar todos los registros existentes
Company::Business::User.reindex
Company::Business::Platform.reindex
# Realizar una búsqueda
Company::Business::User.search("admin")
Company::Business::Platform.search("plataforma x")
Ejemplo de Uso en API
# Buscar usuarios por nombre o email
curl -X GET "http://localhost:3000/users?query=admin"
# Buscar plataformas por nombre o código
curl -X GET "http://localhost:3000/platforms?query=plataforma-x"
